!$RDATGR
      SUBROUTINE RDATGR(AA2,IUNT,LALL,AIRCS,ACTIM,NSAG)
!********1*********2*********3*********4*********5*********6*********7**
! RDATGR            00/00/00            0000.0    PGMR - D.PAVLIS
!
! FUNCTION:        READS ATMOSPHERIC COEFFICIENT FILES
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   IUNT     I    S     INPUT FILE NUMBER
!   LALL     I    S    .TRUE.  IF COEFFICIENTS WILL BE READ AND LOADED
!                              IN THIS CALL
!                      .FALSE. IF ONLY TIMES WILL BE READ IN THIS CALL
!   AIRCS    I          ATMOSPHERIC COEFFICIENTS
!   ACTIM    I          TIME ASSOCIATED WITH ATM. COEFF.
!
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z), LOGICAL(L)
      SAVE
!
      COMMON/AGRAV /NACSET,NADEG,NAORD,IAGCB,IAGCE,IDATB,IDATE,INTAG,   &
     &KCOUNT,KSKIP,INTC21,NXAGRA
      COMMON/CORA2 /JPRMV ,JPNAME,JPRMV0,JPRMSG,JPRML0,KPRMTM,KFEPOC,   &
     &              KFESTR,KFESTP,KSTEP ,KSTEPV,KSETOL,KSATAR,KSATMA,   &
     &              KSATEL,KSATAM,KDRCAM,KDDCAM,KAPGMS,KAPLMS,KSECOB,   &
     &              KSECOE,KSECRT,KFBUFR,KTAB  ,KTDEMT,JSTNAM,JSTAIN,   &
     &              KTEMPA,JSTDRG,JSTSRD,JSTACC,JSATCV,JSTACV,JPOLCV,   &
     &              JTIDCV,KBBIA3,KBSIG3,KOBDR3,KNDXX3,JFSTRC,JFSTRE,   &
     &              JDSCTR,JFRQOF,JXYZOF,JFRQST,JFRQSA,JSTDLY,JSADLY,   &
     &              JXYZCG,JSCMRA,JEBVAL,JEBSIG,JEBNAM,JPLTIN,JPLTVL,   &
     &              JPLTDV,JPARVR,JANGFC,JDIAGN,JAESHD,KSDELE,KSURFE,   &
     &              KOBINT,KSDSEC,KSMSD1,KSMSD2,JSTVEL,JSTVDV,JTIMVL,   &
     &              JLVELA,JVELCV,JQUINF,JQRASC,JQDECL,JQRSIG,JQDSIG,   &
     &              JGRVPR,JGRVSD,JGRLAT,JGRLON,JSINCO,JAERLG,JDPHI ,   &
     &              JDLAMD,JBFNOR,JTPSTR,JTPSTP,JTPFYW,JLRARC,          &
     &              KEPTM1,JEAQAT,JEAFSS,JEAINS,JXYOF2,JACS  ,JECS  ,   &
     &              JSOLNA,JSOLNE,JACOEF,JATCS ,JFACTX,JFACTY,JACTIM,   &
     &              JALBCO,JEMMCO,JDLATF,JDLATS,JDLONF,JDLONS,JPF   ,   &
     &              JPS   ,JDNUM ,JCNUM ,JSABIA,JSBTM1,JSBTM2,          &
     &              JSTEL2,JSTEH2,JLSTL2,JLSTH2,JSL2CV,JSH2CV,          &
     &              JSL2DV,JSH2DV,JYAWBS,JVLOUV,JACMAG,JTSLOV,          &
     &              JAPRES,JASCAL,JASOFF,JGLGR1,JGLGR2,JGLFR1,JGLFR2,   &
     &              JARGR1,JARGR2,JARFR1,JARFR2,JFM3CF,JF2CF, JPPER ,   &
     &              JPLNOR,JWTACC,JWTDRG,JWTSLR,JTMACC,JTMDRG,JTMSLR,   &
     &              JANTBL,JANTID,JALTWV,JATIME,JLTAR ,JGNAME,JGRSIZ,   &
     &              JGRCNT,JGRDAT,JDYACT,JACCBT,JACPER,JXACOB,JTXSTA,   &
     &              JANTUV,JANTOR,JANGT ,JSPDT ,JSSN2 ,JANFSD,JSPDSD,   &
     &              JALCOF,JQRAV, JQDECV,JQRASV,JQDESV,JXUGRD,JYUGRD,   &
     &              JZUGRD,JXGGRD,JYGGRD,JZGGRD,JXEGRD,JYEGRD,JZEGRD,   &
     &              JXYOF3,JEXCGX,JEXCGY,JEXCGZ,JSFSOL,JSFDRA,JTATHM,   &
     &              JTAINS,JTAFSS,JSRAT,JTRAT,NXCRA2
      COMMON/DTMGDN/TGTYMD,TMGDN1,TMGDN2,REPDIF,XTMGN
      DIMENSION AIRCS(NSAG)
      DIMENSION ACTIM(1)
      DIMENSION AA2(1)
!
      OPEN(IUNT, STATUS='OLD', ACTION='READ',FORM='UNFORMATTED')
      READ(IUNT) T1Q,AIRCS
      READ(IUNT) T2Q,AIRCS
      XINTV=T2Q-T1Q
      REWIND IUNT
!
!     DEBUG
!     KSKIP=0
      READ(IUNT,END=2000)FMJDS1,AIRCS
      READ(IUNT,END=2000)FMJDS2,AIRCS
      XINTV=FMJDS2-FMJDS1
      REWIND IUNT
      IF(LALL) GO TO 1000
! READ ONLY TIMES SELECT AND COUNT FILES
  500 CONTINUE
!     KSKIP=KSKIP+1
      READ(IUNT,END=2000)FMJDS,AIRCS
      IMJDS1=FMJDS-.5D0*XINTV
      IMJDS2=FMJDS+.5D0*XINTV
      IF(IMJDS2.LT.IDATB)THEN
      KSKIP=KSKIP+1
      GO TO 500
      ENDIF
      IF(IMJDS1.GT.IDATE) GOTO 2000
! IMJD* is the begin and end time for the atg set
! IDATB IDATE are the times from card ATGRAV
      NACSET=NACSET+1
      IF(NACSET.EQ.1)IAGCB=IMJDS1
      IAGCE=IMJDS2
      GOTO 500
!
! READ COEFFICIENTS AND LOAD THEM IN THE APPROPRIATE ARRAYS.
! ONE RECORD CONTAINS ALL THE COEFFICIENTS FROM A 50X50 EXPANSION
 1000 CONTINUE
      IMAX=(NADEG+1)*(NAORD+1)
      DO 1100 JI=1,KSKIP
      READ(IUNT,END=2000)FMJDS,AIRCS
 1100 END DO
      READ(IUNT,END=2000)FMJDS,AIRCS
      IMJDS1=FMJDS-.5D0*XINTV
      IMJDS2=FMJDS+.5D0*XINTV
      IF(IMJDS2.LT.IAGCB) GOTO 1000
      N1=NADEG+1
      N2=NAORD+1
      DO 1500 I=1,NACSET
! DEBUG PRINTOUT
      WRITE(6,*)' ATMOSPHERIC COEFFICIENTS FOR INPUT SET ',I
      ACTIM(I)=FMJDS - REPDIF
      DO 1400 J=1,IMAX
      CALL INDXNM(J,ICS,N,M)
! ICS IS 0 IF THIS IS A  C COEFFICIENT
! ICS IS 1 IF THIS IS AN S COEFFICIENT
      NP1=N+1
      MP1=M+1
      CALL ALLOAD(AA2(JACOEF),NP1,MP1,I,N1,N2,NACSET,AIRCS(J),ICS+1)
 1400 END DO
      READ(IUNT,END=2000)FMJDS,AIRCS
 1500 END DO
      GOTO 3000
 2000 CONTINUE
      IF(NACSET.EQ.0) THEN
      WRITE(6,20000)
      STOP
      ENDIF
 3000 CONTINUE
!
      CLOSE(IUNT)
      RETURN
20000  FORMAT(1X,'****** ERROR ****** ',/,                              &
     & 1X,' ATMOSPHERIC GRAVITY COEFFICIENTS OUT OF TIME BOUNDARIES ',/,&
     & 1X,' OR NOT FOUND. PLEASE CHECK INPUT UNIT')
      END
