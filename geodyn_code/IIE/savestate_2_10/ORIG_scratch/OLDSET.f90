!$OLDSET
      SUBROUTINE OLDSET(ISTAMT,ISTA,NM,STAINF,IPV0OL,NDROLA,KIOLA,      &
     &                  LADJOL,LOLMDS,JABCOF,JPXSPA,JOLPAE,JOLPAN,      &
     &                  JOLPAV,JXLOCV,JABCCM,JPXSP1,JOLPXC,JOLPYC,      &
     &                  JOLPZC       ,JABCEO,JPXSP2,JOLPXP,JOLPYP,      &
     &                  JOLPUP,LALOAD,ISITA,XENV)
!********1*********2*********3*********4*********5*********6*********7**
! OLDSET           00/00/00            8604.0    PGMR - ?
!
!
! FUNCTION:
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   ISTAMT   I    S    STATION NUMBER IN MTXXXX SEQ (1,2 OR 3)
!   ISTA     I    S    INTERNAL STATION NUMBER
!   NM       I    S    NUMBER OF MEASUREMENTS IN A BLOCK
!   STAINF   I    A    ARRAY CONTAINING STATION INFORMATION
!   IPV0OL   I    A    IPVAL0 ARRAY MADE MORE SPECIFIC FOR
!                      OCEAN LOADING
!   NDROLA   I    A    NPVAL0 ARRAY MADE MORE SPECIFIC FOR
!                      OCEAN LOADING
!   KIOLA    I    A    ARRAY CONTAINING INDICES FOR IOLDPA ARRAY
!   LADJOL   I    S    .TRUE. IF OCEAN LOADING IS TO BE ADJUSTED
!   LOLMDS   O    S    .TRUE.IF THIS SITE MODELS OCEAN LOADING
!   JABCOF   O    S    POINTER TO BE USED FOR ABCOF IN THE
!                      NEXT CALL TO OLOAD
!   JPXSPA   O    S    POINTER TO BE USED FOR PXSPAB IN THE
!                      NEXT CALL TO OLOAD
!   JOLPAE   O    S    POINTER TO EAST INFO IN IOLDPA ARRAY
!   JOLPAN   O    S    POINTER TO NORTH INFO IN IOLDPA ARRAY
!   JOLPAV   O    S    POINTER TO VERTICAL INFO IN IOLDPA ARRAY
!   JXLOCV   O    S    POINTER TO BE USED BY XLOCV IN NEXT
!   LALOAD   O    S    .TRUE.IF THIS SITE MODELS ATMOSPHERIC LOADING
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/CORA03/KRFMT ,KROTMT,KSRTCH,KCFSC ,KTHG  ,KCOSTG,KSINTG,   &
     &              KDPSI ,KEPST ,KEPSM ,KETA  ,KZTA  ,KTHTA ,KEQN  ,   &
     &              KDPSR ,KSL   ,KH2   ,KL2   ,KXPUT ,KYPUT ,KUT   ,   &
     &              KSPCRD,KSPSIG,KSTAIN,KSXYZ ,KSPWT ,KDXSDP,KDPSDP,   &
     &              KXLOCV,KSTNAM,KA1UT ,KPLTIN,KPLTVL,KPLTDV,KPUTBH,   &
     &              KABCOF,KSPEED,KANGFC,KSCROL,KSTVEL,KSTVDV,KTIMVL,   &
     &              KSTEL2,KSTEH2,KSL2DV,KSH2DV,                        &
     &              KAPRES, KASCAL, KASOFF,KXDOTP,KSAVST,               &
     &              KANGT , KSPDT , KCONAM,KGRDAN,KUANG ,KFAMP ,        &
     &              KOFACT, KOTSGN,KWRKRS,KANFSD,KSPDSD,KPRMFS,KSCRFR,  &
     &              KCOSAS,KSINAS,KDXTID,KALCOF,KSTANF,KNUTIN,KNUTMD,   &
     &              KPDPSI,KPEPST,KDXDNU,KDPSIE,KEPSTE,NXCA03
      COMMON/CORA04/KABIAS,KABSTR,KABSTP,KCBIAS,KCBSTR,KCBSTP,          &
     &       KRNM  ,KRKM  ,KRKJ  ,KRIJ  ,KRKPM ,                        &
     &       KRRNM ,KRRKM ,KRRKJ ,KRRIJ ,KRRKPM,                        &
     &       KURNM ,KURKM ,KURKJ ,KURIJ ,KURKPM,                        &
     &       KPRRNM,KPRRKM,KPRRKJ,KPRRIJ,KPRRKP,                        &
     &       KPMPXI,KPMPXE,KRA   ,KRELV ,KUHAT ,KWORK ,KTMPCR,KU    ,   &
     &       KS0   ,KS1   ,KXTP  ,KPXSXP,KPXDXP,KXUTDT,KRPOLE,KPXPOL,   &
     &       KXDPOL,KOBBUF,KOBSC ,KRESID,KSIGMA,KRATIO,KELEVS,          &
     &       KPMPA ,KPXSLV,KTPRTL,                                      &
     &       KFRQOF,KXYZOF,KFRQST,KFRQSA,KSTDLY,KSADLY,KXYZCG,KSCMRA,   &
     &       KEBVAL,KEBSIG,KEBNAM,KBTWB ,KTBTWA,KBTWD ,KPMPE ,          &
     &       KFSEB1,KFSEB2,KSTAMT,KPXSPA,KDIAGN,KOBOUT,KGRLT1,KGRLT2,   &
     &       KGRLT3,KGRLT4,KGRLT5,KPSTAT,KRSUNS,KCHEMR,KCHMOR,KEPOSR,   &
     &       KCHEMT,KCHMOT,KEPOST,KCHCBS,KCPOSS,KSCRTM,KXSTT ,KXSTR ,   &
     &       KXSS  ,KRANGT,KRANGR,KCHB1 ,KCHB2 ,KCHBV1,KCHBV2,KCHEB ,   &
     &       KSSTFQ,KSSTCC,KSSTSS,KSSTWT,KRLCOR,KWVLBI,KQUINF,KBRTS ,   &
     &       KBRTSV,KLRARC,KXEPBF,KXEPBR,KPRCBD,KPRTBD,KXPMPA,KXL,      &
     &       KXSIG ,KXEDTS,KXALO1,KXALO2,KXYOF2,KDLATF,KDLATS,KDLONF,   &
     &       KDLONS,KPF   ,KPS   ,                                      &
     &       KXOBSV,KXOBSW,KXEDSW,                                      &
     &       KXSIGW,KPSF  ,KDNUM ,KCNUM ,KFCOR ,KCOSAR,KSINAR,KSABIA,   &
     &       KSBTM1,KSBTM2,KYAWBS,KVLOUV,KACMAG,KOBSTR,                 &
     &       KPRL1 ,KPRL2, KRL1  ,KT1SE ,KTCP  ,                        &
     &       KRATDR,KFQT1S,KFQT1E,KT1STR,KFTTSE,KFRSTR,KFRRAT,KSV1  ,   &
     &       KSV2  ,KTSLOV,                                             &
     &       KGLGR1,KGLGR2,KGLFR1,KGLFR2,                               &
     &       KARGR1,KARGR2,KARFR1,KARFR2,                               &
     &       KRDS1L,KFT1AV,KDFQP ,KFREQ1,KFREQ3,KSAVD1,KSAVD2,          &
     &       KANTOU,KFM3CF,KF2CF,KTMG,KLTMG,KX2TIM,KX2OBS,KXRNDX,KX2SCR,&
     &       KALTWV,KXXBM ,KX2PAR,KATIME,KPMPAT,KPMATT,KX2PAT,          &
     &       KPXEXI,KPXEPA,KPV,KPXEP2,KX2COF,KACOF2,KACOF3,KBCOF,KBCOF2,&
     &       KDDDA ,KX2AUX,KX2VPR,KX2VPA,KEXTRA,KVARAY,KATROT,KATPER,   &
     &       KLTAR ,KXHOLD,KANTBL,KPHC  ,KOFDRV,KGNAME,KGRSIZ,KGRCNT,   &
     &       KGRDAT,KACCDT,KCTBTI,KCTBWE,KCTCTM,KANTUV,KANTOR,KW1PU ,   &
     &       KPYSQH,KSIGSP,KXYOF3,KXVTM1,KXDIST,KXDST0,KTMSE ,KDSDP ,   &
     &       KEXCST,KEXCDT,KEXCGX,KEXCGY,KEXCGZ,KIMNDX,KIMOBS,KIMTIM,   &
     &       KIMSAT,KM2VPA,KDCDD ,KDWNWT,KDPOR ,KC2PAR,KBOUNC,KBPART,   &
     &       NXCA04
      COMMON/CORI03/KICRD ,KICON ,KISTNO,KINDPI,KMJDPL,KIPOLC,          &
     &              KNDOLA,KIOLPA,KKIOLA,KIP0OL,KNDOLM,KIOLPM,          &
     &              KKIOLM,KIPVOL,KICNL2,KICNH2,                        &
     &              KSTMJD, KNUMST, KITAST, KSTNRD, KICNV,              &
     &              KTIDES,KFODEG,KFOORD,KRDEGR,KRORDR,                 &
     &              KPHINC,KDOODS,KOTFLG,KJDN  ,KPTDN ,                 &
     &              KATIND,KPRESP,KMP2RS,KSITE,KPTOLS,NXCI03
      COMMON/LOLOAD/LOLMD,LOLAJ,L2FOLT,LAPLOD
      COMMON/OLDMOD/NTOLFR,NTOLF2,NTOLMD,NSTAOL,NSITOL,NTOLAJ,MXOLSA,   &
     &              NPOLSH,                                             &
     &              NXOLMD
      COMMON/OLDADJ/NPV0OL(3,3),JPV0OL(3,3),NYZ0OL(3,3),JYZ0OL(3,3),    &
     &              NEO0OL(3,3),JEO0OL(3,3)
      COMMON/OLOADA/LXYZCO,LEOPTO
      DIMENSION STAINF(NSTAIN,1)
      DIMENSION IPV0OL(3,1),NDROLA(3,1),KIOLA(3,1)
      DIMENSION XENV(3,3)
      DATA EPS/.000001D0/

      double precision, parameter :: zero = 0.0D0  ! jjm added 20120531

!***********************************************************************
! START OF EXECUTABLE CODE *********************************************
!***********************************************************************
!
!
!     write(6,*)' dbg ENTER OLDSET ISTA ', ISTA
!     write(6,*)' dbg ENTER OLDSET NSTAIN,LAPLOD ', NSTAIN,LAPLOD
! INITIALIZE
      NPV0OL(1,ISTAMT)=0
      NPV0OL(2,ISTAMT)=0
      NPV0OL(3,ISTAMT)=0
      NYZ0OL(1,ISTAMT)=0
      NYZ0OL(2,ISTAMT)=0
      NYZ0OL(3,ISTAMT)=0
      NEO0OL(1,ISTAMT)=0
      NEO0OL(2,ISTAMT)=0
      NEO0OL(3,ISTAMT)=0
!  GET AT THE ATMOSPHERIC PRESSURE LOADING SITE INFORMATION
      LALOAD=.FALSE.
      IF(LAPLOD) THEN
      ISITA=0
      IF(ISTA.GT.0) ISITA=STAINF(17,ISTA)+EPS
      IF(ISTA.GT.0) ISITN=STAINF(18,ISTA)+EPS
!   CALCULATE LOCAL VERTICLE FIRST
      XENV(1,3)=STAINF(2,ISTA)*STAINF(5,ISTA)
      XENV(2,3)=STAINF(2,ISTA)*STAINF(6,ISTA)
      XENV(3,3)=STAINF(3,ISTA)
!   CALCULATE LOCAL NORTH
      XENV(1,2)=-STAINF(3,ISTA)*STAINF(5,ISTA)
      XENV(2,2)=-STAINF(3,ISTA)*STAINF(6,ISTA)
      XENV(3,2)=STAINF(2,ISTA)
!   CALCULATE LOCAL EAST
      XENV(1,1)=-STAINF(6,ISTA)
      XENV(2,1)=STAINF(5,ISTA)
      XENV(3,1)=ZERO

!     write(6,*)' dbg XENV ',XENV(1,1),XENV(1,2),XENV(1,3)
!     write(6,*)' dbg XENV ',XENV(2,1),XENV(2,2),XENV(2,3)
!     write(6,*)' dbg XENV ',XENV(3,1),XENV(3,2),XENV(3,3)
!     write(6,*)' dbg OLDSET ISITA ISITN ', ISITA,ISITN

      IF(ISITA.GT.0) LALOAD=.TRUE.
      ENDIF
!  GET AT THE OCEAN LOADING SITE INFORMATION
      LOLMDS=.FALSE.
      ISITE=0
      IF(ISTA.GT.0) ISITE=STAINF(14,ISTA)+EPS
!     write(6,*)' dbg OLDSET ISITE ', ISITE
      IF(ISITE.GT.0) LOLMDS=.TRUE.
!  GET PONTER FOR ABCOF
      JFACT=0
      IF(LXYZCO) JFACT=JFACT+1
      JABCCM=KABCOF+(JFACT-1)*6*NTOLFR
      IF(LEOPTO) JFACT=JFACT+1
      JABCEO=KABCOF+(JFACT-1)*6*NTOLFR
      IF(.NOT.LOLMDS) GO TO 200
      DO 100 I=1,ISTA
      IF(STAINF(14,I).GT.EPS) JFACT=JFACT+1
  100 END DO
      JABCOF=KABCOF+(JFACT-1)*6*NTOLFR
  200 CONTINUE
      IF(.NOT.LADJOL) RETURN
! FILL THE ARRAYS IN OLDADJ FOR NORMAL MATRIX FORMATION
      IF(ISITE.LE.0) GO TO 250
      NPV0OL(1,ISTAMT)=NDROLA(1,ISITE)
      NPV0OL(2,ISTAMT)=NDROLA(2,ISITE)
      NPV0OL(3,ISTAMT)=NDROLA(3,ISITE)
      JPV0OL(1,ISTAMT)=IPV0OL(1,ISITE)
      JPV0OL(2,ISTAMT)=IPV0OL(2,ISITE)
      JPV0OL(3,ISTAMT)=IPV0OL(3,ISITE)
! CALCULATE POINTER FOR PXSPAB
      JPXSPA=KPXSPA+(ISTAMT-1)*NM*18*MXOLSA
! POINTERS FOR IOLDPA ARRAY
      JOLPAE=KIOLA(1,ISITE)-1+KIOLPA
      JOLPAN=KIOLA(2,ISITE)-1+KIOLPA
      JOLPAV=KIOLA(3,ISITE)-1+KIOLPA
! POINTER FOR XLOCV ARRAY
      JXLOCV=KXLOCV+9*(ISTA-1)
! FILL THE ARRAYS IN OLDADJ FOR NORMAL MATRIX FORMATION
! WHEN IT IS BEING USED FOR CENTER OF MASS
  250 CONTINUE
      ISITE=0
      IF(.NOT.LXYZCO) GO TO 300
      ISITE=ISITE+1
      NYZ0OL(1,ISTAMT)=NDROLA(1,ISITE)
      NYZ0OL(2,ISTAMT)=NDROLA(2,ISITE)
      NYZ0OL(3,ISTAMT)=NDROLA(3,ISITE)
      JYZ0OL(1,ISTAMT)=IPV0OL(1,ISITE)
      JYZ0OL(2,ISTAMT)=IPV0OL(2,ISITE)
      JYZ0OL(3,ISTAMT)=IPV0OL(3,ISITE)
! CALCULATE POINTER FOR PXSPAB
      JPXSP1=KPXSPA+(ISTAMT-1)*NM*18*MXOLSA+NM*6*MXOLSA
! POINTERS FOR IOLDPA ARRAY
      JOLPXC=KIOLA(1,ISITE)-1+KIOLPA
      JOLPYC=KIOLA(2,ISITE)-1+KIOLPA
      JOLPZC=KIOLA(3,ISITE)-1+KIOLPA
  300 CONTINUE
! FILL THE ARRAYS IN OLDADJ FOR NORMAL MATRIX FORMATION
! WHEN IT IS BEING USED FOR CENTER OF MASS
      IF(.NOT.LEOPTO) RETURN
      ISITE=ISITE+1
      NEO0OL(1,ISTAMT)=NDROLA(1,ISITE)
      NEO0OL(2,ISTAMT)=NDROLA(2,ISITE)
      NEO0OL(3,ISTAMT)=NDROLA(3,ISITE)
      JEO0OL(1,ISTAMT)=IPV0OL(1,ISITE)
      JEO0OL(2,ISTAMT)=IPV0OL(2,ISITE)
      JEO0OL(3,ISTAMT)=IPV0OL(3,ISITE)
! CALCULATE POINTER FOR PXSPAB
      JPXSP2=KPXSPA+(ISTAMT-1)*NM*18*MXOLSA+NM*12*MXOLSA
! POINTERS FOR IOLDPA ARRAY
      JOLPXP=KIOLA(1,ISITE)-1+KIOLPA
      JOLPYP=KIOLA(2,ISITE)-1+KIOLPA
      JOLPUP=KIOLA(3,ISITE)-1+KIOLPA
      RETURN
      END
