!$ORBIT
      SUBROUTINE ORBIT(MJDSM,FSECM,S,NM,INDH,NMH,                       &
     &   MJDSEC,FSEC,MJDSV,FSECV,LSETS,IPXPF,IVSATS,                    &
     &   NVSATS,NMAXG,NTOLDV,XI,PXPF,                                   &
     &   LONLYX,LONLYV,                                                 &
     &   IPLPTR,NPANEL,NMOVEP,TPMEAS,LTPMES,LSETDN,TMOS0,TMOS,TMOSP,    &
     &   SUMXOS,SUMPOS,XDDTOS,PDDTOS,KNSTEPS,NEQNI,ISEGM,T1SEG,T2SEG,   &
     &   AA,II,LL)
!********1*********2*********3*********4*********5*********6*********7**
! ORBIT            82/08/02            8208.0    PGMR - TOM MARTIN
!
! FUNCTION:  DRIVE THE INTEGRATION AND INTERPOLATION PROCESS
!            FOR THE ORBIT AND VARIATIONAL EQUATIONS
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   MJDSM    I    S    DATES AND INTEGRAL SECONDS OF MEASUREMENT
!                      TIMES
!   FSECM    I    A    FRACTIONAL SECONDS OF MEASUREMENT TIMES
!   S             A    INTERPOLATION FRACTIONS
!   NM       I    S    NUMBER OF MEASUREMENTS FOR WHICH INTERPOLATION
!                      IS TO BE PERFORMED
!   INDH    I/O   A    INTERPOLATION INDICES
!   NMH     I/O   A    INTERPOLATION COUNTS FOR EACH INDEX
!   MJDSEC   I    A    CURRENT DATES AND INTEGRAL SECONDS OF ORBIT
!                      INTEGRATION TIMES
!   FSEC     I    A    CURRENT FRACTIONAL SECONDS OF ORBIT
!                      INTEGRATION TIMES
!   MJDSV    I    A    CURRENT DATES AND INTEGRAL SECONDS OF VAR.EQ
!                      INTEGRATION TIMES
!   FSECV    I    A    CURRENT FRACTIONAL SECONDS OF VAR. EQ.
!                      INTEGRATION TIMES
!   LSETS    I    A    SWITCHES INDICATING(.TRUE.) WHICH SATELLITE
!                      SETS TO  BE INTERPOLATED
!   IPXPF    O    A    VARIATIONAL EQUATION DYNAMIC ARRAY POINTERS
!   IVSATS   I    S    SATELLITE NUMBERS TO BE INTERPOLATED
!   NVSATS   I    S    NUMBER OF SATELLITES FOR WHICH INTERPOLATIO
!                      TO BE PERFORMED
!   NMAXG    I    A    DEG OF GEOPOTENTIAL
!   NTOLDV   I    A    MAX DEGREE OF GEOPOTENTIAL USED IN VARIATIONAL
!                      EQUATION COMPUTATION
!   XI       I    A    INTERPLOATED ORBIT
!   PXPF     I    A    INTERPOLATED FORCE MODEL PARTIALS
!   LONLYX   I    S    INDICATES(.TRUE.) ONLY-ORBIT INTERPOLATION
!   LONLYV   I    S    INDICATES(.TRUE.) ONLY-VAR. EQ. INTERPOLATI
!   AA      I/O   A    64BIT FLOATING POINT LABEL
!   II      I/O   A    FULL WORD INTEGER LABEL
!   LL      I/O   A    LOGICAL LABEL
!   NVTOLD   I    S    MAX DEG IN VARIATIONAL EQUATIONS
!   NVTOLO   I    S    MAX ORD IN VARIATIONAL EQUATIONS
!   IPLPTR   I    A    BOX-WING PARAMETER POINTER(SET IN 2S)
!   NPANEL   I    A    NUMBER OF "BW" PANELS ON EACH SATELLITE
!   NMOVEP   I    A    # OF MOVING "BW" PANELS ON EACH SATELLITE
!   TPMEAS   O    A    TOPEX ATT VALUES FOR USE IN MEAS. MODEL
!   LTPMES   O    A    TOPEX ATT VALUES FOR USE IN MEAS. MODEL
!
! COMMENTS: WHEN LASTN=.TRUE. THE SUN CENTERED EPHEMERIS OF THE
!           CENTRAL BODY IS BEINF NUMERICALLY INTEGRATED ALONG
!           WITH (AN) ARTIFICIAL SATELLITES. WJEN BOTH LASTSN AND
!           LBINAST ARE TRUE THE EPHEMRIS OF A SECONDARY ASTEROID
!           IS ALSO BEING INTEGTRARD (THREE BODIES TOTAL). WHEN
!           LASTN=.TRUE. THE EHEMERIS AND FORCE MODEL PARTIALS
!           WILL BE OUTPUT IN AA(KASTO) AND AA(KASTP). IN MOST
!           CASES IT IS THE CENTRAL BODY THAT WILL HAVE OUTPUT.
!           HOWEVER, IF LASTSN AND LBINAST ARE TRUE AND TLBOD2
!           (COMMON/RIMAGE) IS GE.2.D0, THEN THE SECONDARY ASTEROID
!           WILL HAVE OUTPUT IN THE AA(KASTO) AND AA(KASTP) ARRAYS.
!           TLBOD2 IS SET BY OBSRD.
!
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      DOUBLE PRECISION, ALLOCATABLE :: XR(:)
      DOUBLE PRECISION, ALLOCATABLE :: XRP(:)
      DOUBLE PRECISION, ALLOCATABLE :: PXA(:)
      SAVE
! DYNAMIC ARRAY POINTERS
      COMMON/HOLDRT/YQR(456),YQRDOT(450000),SUMXRQ(450000),YMNRT(3)
      COMMON/ACCLRM/MDYNPD,MBAPPD,MACOBS,IDYNSC(200),MDYNST,IACCSC(200),&
     &              MACCSC,NACPRM(200),NATPRM(200),NXCLRM
      COMMON/EXATAC/LEXTAC
      COMMON/BWINTG/JBFNRM,JTDNRM,JBWARE,JBWSPC,JBWDIF,JBWEMS,JBWTPA,   &
     &              JBWTPC,JBWTMD,JBWTMF,JBWTHX,JARADJ,JSPADJ,JDFADJ,   &
     &              JEMADJ,JTAADJ,JTCADJ,JTDADJ,JTFADJ,JTXADJ,JARUA ,   &
     &              JSPUA ,JDFUA ,JEMUA ,JTAUA ,JTCUA ,JTDUA ,JTFUA ,   &
     &              JTXUA ,NFACE ,NMOVE,NTFACE,JBFNR2,JBFNR3,JTDNR2,    &
     &              JTDNR3
      COMMON/BWLOGC/LVAREA,LTOPEX,LSPOT2,LGPSVA,LERS1,LMO,LMOC,LTDRSA,  &
     &              LMAGNA,LGFO,LTRMM,LEUVE,LVCL,LENVS,LCRYO,LGRAIL,    &
     &              LHY2A,LSARAL
      COMMON/BWREAL/SHADOW(2),SUNPCT,SCAREA,SCMASS,BWMEAN
      COMMON/CBLOKL/LIGHT ,LNRATE,LNREFR,LPOLAD,LTDRIV,LNANT ,LNTRAK,   &
     &       LASER ,LGPART,LGEOID,LETIDE,LOTIDE,LNTIME,LAVGRR,LRANGE,   &
     &       LSSTMD,LSSTAJ,LNTDRS,LPSBL,LACC,LAPP,LTARG,LTIEOU,LEOTRM,  &
     &       LSURFM,LGEOI2,LSSTM2,LOTID2,LOTRM2,LETID2,LNUTAD
      COMMON/CESTML/LNPNM ,NXCSTL
      COMMON/CGRAV/GM,AE,AESQ,FE,FFSQ32,FSQ32,XK2,XK3,XLAM,SIGXK2,      &
     &      SIGXK3,SIGLAM,RATIOM(2),AU,RPRESS
      COMMON/CIMDST/IDRLTM(200),ITRLTM(200),IRELON,IRLONA,NRLTMC,       &
     & IDRCK4(200),IRKONA,NROCK4,IRKRAD,NXIRTM
      COMMON/CINTI2/IBCKNC,NRATO,IXDDNC,ISMXNC,IDXDDN,IDSMXN,           &
     &              ICPPNC,IPXDDA,NEQNA
      COMMON/CINTJ2/JIBCKN,JNRAT,JIXDDN,JISMXN,JDXDDN,JDSMXN,           &
     &              JICPPN,JPXDDA,JNEQNA,JFHIRT,JSURFF,JPTFBS
      COMMON/CIROCK/IGPSBK,IRKSTN
      COMMON/CINTI/IBACK ,IBACKV,IORDER,IORDRV,NOSTEP,NOCORR,           &
     &      NSAT  ,N3    ,NEQN  ,NEQN3 ,NH    ,NHV   ,NSTEPS,           &
     &      NSTEPV,ICPP  ,ICPV  ,ICCP  ,ICCV  ,ICCPV ,ICCVV ,           &
     &      ISUMX ,IXDDOT,ISUMPX,IPXDDT
      COMMON/CINTJI/JIBACK,JIBAKV,JIORDR,JIORDV,JNOSTP,JNOCOR,          &
     &       JNSAT ,JN3   ,JNEQN ,JNEQN3,JNH   ,JNHV  ,JNSTPS,          &
     &       JNSTPV,JICPP ,JICPV ,JICCP ,JICCV ,JICCPV,JICCVV,          &
     &       JISUMX,JIXDDT,JISMPX,JIPXDD
      COMMON/CNIARC/NSATA,NSATG,NSETA,NEQNG,NMORDR,NMORDV,NSORDR,       &
     &              NSORDV,NSUMX,NXDDOT,NSUMPX,NPXDDT,NXBACK,NXI,       &
     &              NXILIM,NPXPF,NINTIM,NSATOB,NXBCKP,NXTIMB,           &
     &              NOBSBK,NXTPMS,NXCNIA
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/EXATFL/LEXATO
      COMMON/EXATGL/LEXATT,NXEAGL
      COMMON/EXATFI/ISBJ20,NUMPEA,IPMPEA,MJDSEA
      COMMON/EXATFR/FSSCEA,RINTEA
      COMMON/CORA01/KFSEC0,KFSECB,KFSEC ,KFSECV,KH    ,KHV   ,KCTOL ,   &
     &              KRSQ  ,KVMATX,KCPP  ,KCPV  ,KCCP  ,KCCV  ,KCCPV ,   &
     &              KCCVV ,KXPPPP,KX    ,KPX   ,KSUMX ,KXDDOT,KSUMPX,   &
     &              KPXDDT,KAB   ,KPN   ,KAORN ,KSINLM,KCOSLM,KTANPS,   &
     &              KCRPAR,KVRARY,KXM   ,KXNP1 ,KXPRFL,KXM2  ,KXNNP1,   &
     &              KWRK  ,KFI   ,KGE   ,KB0DRG,KBDRAG,KAPGM ,KAPLM ,   &
     &              KCN   ,KSN   ,KSTID ,KTIDE ,KSTDRG,KSTSRD,KSTACC,   &
     &              KLGRAV,KGM   ,KAE   ,KFPL  ,KFEQ  ,KPLNPO,KPLNVL,   &
     &              KXEPOC,KCD   ,KCDDOT,KCR   ,KGENAC,KACN  ,KASN  ,   &
     &              KTHDRG,KCKEP ,KCKEPN,KXNRMZ,KXNRMC,KFSCEP,KFSCND,   &
     &              KAREA ,KXMASS,KRMSPO,KTCOEF,KTXQQ ,KTIEXP,KTXMM ,   &
     &              KTXLL1,KTXSN1,KTS2QQ,KT2M2H,KT2MHJ,KTXKK ,KTSCRH,   &
     &              KPXPK ,KAESHD,KCSAVE,KSSAVE,KCGRVT,KSGRVT,KXDTMC,   &
     &              KDNLT ,KTXSN2,KTNORM,KTWRK1,KTWRK2,KUNORM,KAERLG,   &
     &              KSINCO,KPARLG,KCONST,KBFNRM,KTDNRM,KCSTHT,KTPSTR,   &
     &              KTPSTP,KTPFYW,KPLMGM,KTPXAT,KEAQAT,KEAFSS,KEAINS,   &
     &              KACS  ,KECS  ,KSOLNA,KSOLNE,KSVECT,KSFLUX,KFACTX,   &
     &              KFACTY,KADIST,KGEOAN,KPALB ,KALBCO,KEMMCO,KCNAUX,   &
     &              KSNAUX,KPPER ,KACOSW,KBSINW,KACOFW,KBCOFW,KANGWT,   &
     &              KWT   ,KPLNDX,KPLANC,KTGACC,KTGDRG,KTGSLR,KWTACC,   &
     &              KWTDRG,KWTSLR,KTMACC,KTMDRG,KTMSLR,KATTUD,KDYACT,   &
     &              KACCBT,KACPER,KXDDNC,KXDDAO,KXNC  ,KXPPNC,KSMXNC,   &
     &              KXDDTH,KPDDTH,KXSSBS,KCPPNC,KEXACT,KXACIN,KXACOB,   &
     &              KPXHDT,KTPXTH,KPACCL,KTXSTA,KDELXS,KSMRNC,KPRX  ,   &
     &              KSMRNP,KDSROT,KXUGRD,KYUGRD,KZUGRD,KSUMRC,KXDDRC,   &
     &              KTMOS0,KTMOS, KTMOSP,KSMXOS,KSGTM1,KSGTM2,KSMPNS,   &
     &              KXGGRD,KYGGRD,KZGGRD,KXEGRD,KYEGRD,KZEGRD,KSSDST,   &
     &              KSDINS,KSDIND,KSSDSR,KSSDDG,KTATHM,KTAINS,KTAFSS,   &
     &              KSRAT ,KTRAT ,KHLDV ,KHLDA1,KHLDA4,KHLDA7,KQAST1,   &
     &              KQAST2,KQAST3,KQAST4,KQAST5,KQAST6,NXCA01
      COMMON/CORA02/KFSCTB,KFSCTC,KFSCTE,KDSECT,                        &
     &              KFSECT,KS    ,KCIP  ,KCIV  ,                        &
     &       KXTN  ,KXSM  ,KXTK  ,KXSJ  ,KXTI  ,KXTKP ,                 &
     &       KVTN  ,KVSM  ,KVTK  ,KVSJ  ,KVTI  ,KVTKP ,                 &
     &       KSATLT,KSATLN,KSATH ,KCOSTH,KSINTH,                        &
     &       KPXPFM,KPXPFK,KPXPFJ,KTRBF ,KFSTRC,                        &
     &       KFSTRE,KDSCTR,KFSCVS,KXSMBF,KXSKBF,KXSJBF,                 &
     &       KRSSV1,KRSSV2,KRSSV3,KTPMES,KACOEF,KACTIM,                 &
     &       KXTNPC,KXSMPC,KXTKPC,KXSJPC,KXTIPC,KXTKPP,                 &
     &       KRLRNG,KASTO,KASTP,NXCA02
      COMMON/CORA03/KRFMT ,KROTMT,KSRTCH,KCFSC ,KTHG  ,KCOSTG,KSINTG,   &
     &              KDPSI ,KEPST ,KEPSM ,KETA  ,KZTA  ,KTHTA ,KEQN  ,   &
     &              KDPSR ,KSL   ,KH2   ,KL2   ,KXPUT ,KYPUT ,KUT   ,   &
     &              KSPCRD,KSPSIG,KSTAIN,KSXYZ ,KSPWT ,KDXSDP,KDPSDP,   &
     &              KXLOCV,KSTNAM,KA1UT ,KPLTIN,KPLTVL,KPLTDV,KPUTBH,   &
     &              KABCOF,KSPEED,KANGFC,KSCROL,KSTVEL,KSTVDV,KTIMVL,   &
     &              KSTEL2,KSTEH2,KSL2DV,KSH2DV,                        &
     &              KAPRES, KASCAL, KASOFF,KXDOTP,KSAVST,               &
     &              KANGT , KSPDT , KCONAM,KGRDAN,KUANG ,KFAMP ,        &
     &              KOFACT, KOTSGN,KWRKRS,KANFSD,KSPDSD,KPRMFS,KSCRFR,  &
     &              KCOSAS,KSINAS,KDXTID,KALCOF,KSTANF,KNUTIN,KNUTMD,   &
     &              KPDPSI,KPEPST,KDXDNU,KDPSIE,KEPSTE,NXCA03
      COMMON/CORA04/KABIAS,KABSTR,KABSTP,KCBIAS,KCBSTR,KCBSTP,          &
     &       KRNM  ,KRKM  ,KRKJ  ,KRIJ  ,KRKPM ,                        &
     &       KRRNM ,KRRKM ,KRRKJ ,KRRIJ ,KRRKPM,                        &
     &       KURNM ,KURKM ,KURKJ ,KURIJ ,KURKPM,                        &
     &       KPRRNM,KPRRKM,KPRRKJ,KPRRIJ,KPRRKP,                        &
     &       KPMPXI,KPMPXE,KRA   ,KRELV ,KUHAT ,KWORK ,KTMPCR,KU    ,   &
     &       KS0   ,KS1   ,KXTP  ,KPXSXP,KPXDXP,KXUTDT,KRPOLE,KPXPOL,   &
     &       KXDPOL,KOBBUF,KOBSC ,KRESID,KSIGMA,KRATIO,KELEVS,          &
     &       KPMPA ,KPXSLV,KTPRTL,                                      &
     &       KFRQOF,KXYZOF,KFRQST,KFRQSA,KSTDLY,KSADLY,KXYZCG,KSCMRA,   &
     &       KEBVAL,KEBSIG,KEBNAM,KBTWB ,KTBTWA,KBTWD ,KPMPE ,          &
     &       KFSEB1,KFSEB2,KSTAMT,KPXSPA,KDIAGN,KOBOUT,KGRLT1,KGRLT2,   &
     &       KGRLT3,KGRLT4,KGRLT5,KPSTAT,KRSUNS,KCHEMR,KCHMOR,KEPOSR,   &
     &       KCHEMT,KCHMOT,KEPOST,KCHCBS,KCPOSS,KSCRTM,KXSTT ,KXSTR ,   &
     &       KXSS  ,KRANGT,KRANGR,KCHB1 ,KCHB2 ,KCHBV1,KCHBV2,KCHEB ,   &
     &       KSSTFQ,KSSTCC,KSSTSS,KSSTWT,KRLCOR,KWVLBI,KQUINF,KBRTS ,   &
     &       KBRTSV,KLRARC,KXEPBF,KXEPBR,KPRCBD,KPRTBD,KXPMPA,KXL,      &
     &       KXSIG ,KXEDTS,KXALO1,KXALO2,KXYOF2,KDLATF,KDLATS,KDLONF,   &
     &       KDLONS,KPF   ,KPS   ,                                      &
     &       KXOBSV,KXOBSW,KXEDSW,                                      &
     &       KXSIGW,KPSF  ,KDNUM ,KCNUM ,KFCOR ,KCOSAR,KSINAR,KSABIA,   &
     &       KSBTM1,KSBTM2,KYAWBS,KVLOUV,KACMAG,KOBSTR,                 &
     &       KPRL1 ,KPRL2, KRL1  ,KT1SE ,KTCP  ,                        &
     &       KRATDR,KFQT1S,KFQT1E,KT1STR,KFTTSE,KFRSTR,KFRRAT,KSV1  ,   &
     &       KSV2  ,KTSLOV,                                             &
     &       KGLGR1,KGLGR2,KGLFR1,KGLFR2,                               &
     &       KARGR1,KARGR2,KARFR1,KARFR2,                               &
     &       KRDS1L,KFT1AV,KDFQP ,KFREQ1,KFREQ3,KSAVD1,KSAVD2,          &
     &       KANTOU,KFM3CF,KF2CF,KTMG,KLTMG,KX2TIM,KX2OBS,KXRNDX,KX2SCR,&
     &       KALTWV,KXXBM ,KX2PAR,KATIME,KPMPAT,KPMATT,KX2PAT,          &
     &       KPXEXI,KPXEPA,KPV,KPXEP2,KX2COF,KACOF2,KACOF3,KBCOF,KBCOF2,&
     &       KDDDA ,KX2AUX,KX2VPR,KX2VPA,KEXTRA,KVARAY,KATROT,KATPER,   &
     &       KLTAR ,KXHOLD,KANTBL,KPHC  ,KOFDRV,KGNAME,KGRSIZ,KGRCNT,   &
     &       KGRDAT,KACCDT,KCTBTI,KCTBWE,KCTCTM,KANTUV,KANTOR,KW1PU ,   &
     &       KPYSQH,KSIGSP,KXYOF3,KXVTM1,KXDIST,KXDST0,KTMSE ,KDSDP ,   &
     &       KEXCST,KEXCDT,KEXCGX,KEXCGY,KEXCGZ,KIMNDX,KIMOBS,KIMTIM,   &
     &       KIMSAT,KM2VPA,KDCDD ,KDWNWT,KDPOR ,KC2PAR,KBOUNC,KBPART,   &
     &       NXCA04
      COMMON/CORA06/KPRMV ,KPNAME,KPRMV0,KPRMVC,KPRMVP,KPRMSG,KPARVR,   &
     &              KPRML0,KPDLTA,KSATCV,KSTACV,KPOLCV,KTIDCV,KSUM1 ,   &
     &              KSUM2 ,KGPNRA,KGPNRM,KPRSG0,KCONDN,KVELCV,          &
     &              KSL2CV,KSH2CV,KTIEOU,KPRMDF,NXCA06
      COMMON/CORI01/KMJDS0,KMJDSB,KMJDSC,KMJDSV,KIBACK,KIBAKV,KIORDR,   &
     &              KIORDV,KNOSTP,KNOCOR,KNSAT ,KN3   ,KNEQN ,KNEQN3,   &
     &              KNH   ,KNHV  ,KNSTPS,KNSTPV,KICPP ,KICPV ,KICCP ,   &
     &              KICCV ,KICCPV,KICCVV,KISUMX,KIXDDT,KISMPX,KIPXDD,   &
     &              KNMAX ,KNTOLD,KNTOLO,KICNT ,KISNT ,KMM   ,KKK   ,   &
     &              KJJ   ,KHH   ,KIBDY ,KSIGN1,KSIGN2,KLL   ,KQQ   ,   &
     &              KIORFR,KIPDFR,KITACC,KJSAFR,KJSPFR,KMJDEP,KMJDND,   &
     &              KNVSTP,KNSTRN,KNDARK,KTIPPT,KTJBDY,                 &
     &              KICNTA,KISNTA,KISHDP,KIPTC ,KIPTS ,KIGTSR,KIXTMC,   &
     &              KTIPTT,KTNOSD,KTQNDX,KTLL1 ,KTJJBD,KTITDE,KTCNTR,   &
     &              KTNN  ,KITACX,KNMOVE,KPANEL,KPLPTR,KNADAR,KNADSP,   &
     &              KNADDF,KNADEM,KNADTA,KNADTC,KNADTD,KNADTF,KNADTX,   &
     &              KITPMD,KSCATT,KITPAT,KILTPX,KEASBJ,KEANMP,KEANAN,   &
     &              KEAPMP,KEAPAN,KEAMJS,KEAPPP,KEAAAA,KICNTT,KISNTT,   &
     &              KTPGRC,KTPGRS,KTPC  ,KTPS  ,KALCAP,KEMCAP,KNSEG ,   &
     &              KICNTP,KISNTP,KNRDGA,KNRDDR,KNRDSR,KIRDGA,KIRDRG,   &
     &              KIRSLR,KSTRTA,KSTRTD,KSTRTS,KDYNPE,KACCPE,KIBCKN,   &
     &              KNRAT ,KIXDDN,KISMXN,KDXDDN,KDSMXN,KICPPN,KACSID,   &
     &              KNEQNH,KHRFRC,KPTFBS,KPTFSB,KIPXDA,KIACCP,KXSTAT,   &
     &              KPXST ,KSALST,KMAPLG,KNMBUF,KSTEPS,KSGMNT,KSATIN,   &
     &              KMEMST,KNEQNI,KBUFIN,KWEMGA,KWEMDR,KTPATS,KTANMP,   &
     &              KTAPPP,KTAMJS,KTASID,KGPSID,KNSSVA,KPNALB,KBRAX1,   &
     &              KBRAX2,KBRAX3,NXCI01
      COMMON/CORI02/KNTIME,KMJSTB,KMJSTC,KMJSTE,KISECT,                 &
     &              KINDH ,KNMH  ,KIVSAT,KIPXPF,KNTRTM,KMSTRC,          &
     &              KMSTRE,KISCTR,KISATR,KITRUN,KTRTMB,KTRTMC,          &
     &              KMJDVS,KNTMVM,NXCI02
      COMMON/CORI04/KNMP  ,KINDP ,KNDPAR,KNPVCT,KISATN,KISET ,KIANTO,   &
     &              KISATO,KIANTD,KISATD,KISTAD,KISATC,KMJDCG,KISTAT,   &
     &              KMJDEB,KMJDBN,KNDBIN,KNWTDB,KIXPAR,KNDBUF,KSSTNM,   &
     &              KSSTNA,KMBSAT,KMBSTA,KXKEY ,KXVKEY,KXFLAG,KIPNTF,   &
     &              KIPNTS,KNCON ,KKF   ,KIDATB,KNSTLV,KSLVID,KLLBIA,   &
     &              KTMRA1,KTMRA2,KIND1 ,KTARID,KATARD,KYAWID,KXOBLK,   &
     &              KDSCWV,KATRSQ,KATSAT,KKVLAS,KPARTP,KLTMSC,KLTASC,   &
     &              KCTBST,KSTBST,KANCUT,KANGPS,KANTYP,                 &
     &              KANTOF,                                             &
     &              KYSAT, KMBDEG,                                      &
     &              KMBNOD,KMBSST,KBSPLN,KSSPLN,KXIOBS,KIDLAS,KIAVP ,   &
     &              KXNAVP,KNEXCG,KIDEXC,KNREXC,KTELEO,KIKEY ,KIMKEY,   &
     &              KIMBLK,KIMPRT,KCN110,KCN111,KC110,KC111,KTDSAT,     &
     &              KTDANT,NXCI04
      COMMON/CORI06/KPTRAU,KPTRUA,KNFMG ,KIPTFM,KILNFM,KIGPC ,          &
     &              KIGPS ,KIGPCA,KIGPSA,KIELMT,KMFMG ,KTPGPC,          &
     &              KTPGPS,KTPUC ,KTPUS,                                &
     &              KLINK,KPTFAU,KPTFUA,NXCI06
      COMMON/CORL01/KLORBT,KLORBV,KLNDRG,KLBAKW,KLSETS,KLAFRC,KLSTSN,   &
     &              KLSNLT,KLAJDP,KLAJSP,KLAJGP,KLTPAT,KEALQT,KLRDGA,   &
     &              KLRDDR,KLRDSR,KFHIRT,KLSURF,KHRFON,KLTPXH,KSETDN,   &
     &              KTALTA,NXCL01
      COMMON/CRDDIM/NDCRD2,NDCRD3,NDCRD4,NDCRD5,NDCRD6,NDCRD7,          &
     &              NDCRD8,NDCRD9,NXCRDM
      COMMON/CVIEW /IOUT6 ,ILINE6,IPAGE6,MLINE6,                        &
     &              IOUT8 ,ILINE8,IPAGE8,MLINE8,                        &
     &              IOUT9 ,ILINE9,IPAGE9,MLINE9,                        &
     &              IOUT10,ILIN10,IPAG10,MLIN10,                        &
     &              IOUT15,ILIN15,IPAG15,MLIN15,                        &
     &              IOUT16,ILIN16,IPAG16,MLIN16,                        &
     &              IOUT7 ,NXCVUE
      COMMON/GEODEG/NMAX,NMAXP1,NP,NTOLD,NTOLO,NADJC,NADJS,NADJCS,      &
     &              NPMAX,NXGDEG
      COMMON/IBODPT/IBDCF(999),IBDSF(999),IBDGM(999),IBDAE(999),    &
     &              IBDPF(999),                                     &
     &              ICBDCF,ICBDSF,ICBDGM,ICBDAE,ICBDPF,             &
     &              ITBDCF,ITBDSF,ITBDGM,ITBDAE,ITBDPF,NXBDPT
      COMMON/IOS/ISTOS1,ISTOS2,ISTOS3,ISTLST,INTSUB(3),JNTSUB(3),      &
     &        ILSTSG(80),INTOSP,MAPSAT(3,4)
      COMMON/IDELTX/MXSTAT,NEVENTS,NDSTAT,IDSYST,NDELTX
      COMMON/ITHERM/IDGSTN,NARC0
      COMMON/LASTER/LASTR(2),LBINAST,NXASTR
      COMMON/LDUAL/LASTSN,LSTSNX,LSTSNY
      COMMON/LSTRT/LSTART
      COMMON/NEQINT/NINTOT,MEMTOT,NEQNIM,NXNEQS
      COMMON/NFORCE/NHRATE,NSURF,MPXHDT,MXHRG,MXFMG,NFSCAC,NXFORC
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      COMMON/RAPIDI/LINTF,LBUFOP
      COMMON/RIMAGE/VIMAGE(6),QUCAM(4),QURSYS,TLBOD2
      COMMON/SETADJ/LSADRG(4),LSASRD(4),LSAGA(4),LSAGP,LSATID,LSAGM,    &
     &              LSADPM,LSAKF,LSADNX,LSADJ2,LSAPGM
      COMMON/SETAGP/NAJCA,NAJSA,NAJCG,NAJSG,NAJCT,NAJST
      COMMON/SETAPT/                                                    &
     &       JSADRG(1),JSASRD(1),JSAGA(1),JFAADJ,JTHDRG,JACBIA,JATITD,  &
     &       JDSTAT,JDTUM ,                                             &
     &       JSACS, JSATID,JSALG,JSAGM,JSAKF,JSAXYP,JSADJ2,JSAPGM,      &
     &       JFGADJ,JLTPMU,JLTPAL,JL2CCO,JL2SCO,JL2GM,JLRELT,           &
     &       JLJ2SN,JLGMSN,JLPLFM,JL2AE,JSAXTO,JSABRN
      COMMON/SETIOR/IORDRG,IORSRD,IORGA,IPDDRG,IPDSRD,IPDGA
      COMMON/SETOPT/LSDRG,LSSRD,LSGA,LSORB,LTHDRG,LROCK4
      COMMON/SETPPT/JSPDRG(3),JSPSRD(3),JSPGA(3),JCSAT
      COMMON/STARTV/SSTRTC(200)
      COMMON/STARTT/ESSTRT,FSSTRT
      COMMON/THERMD/DRGSAT,DTHSC,ZETA,SPAXT,SPAXL,THRMFL,XTHERM
      COMMON/VMATFL/LVMTF,LVMTFO
      COMMON/XEPHL2/  L_call_sumcmp   ! jjm 20150413
      COMMON/XEPHMI/IBLKXE,IBLKXL,IBLKXP(2),IXEPRW,IXEPRD,              &
     &              IXEPB1,IXEPB2,IXBFS(2),IXBFE(2),                    &
     &              MJXEPS,IXPSAT(200),NXPSAT,MXPBFR,                   &
     &              NEPPBK,IXEPEF,IUNTXE,NXXEPH
      COMMON/XPCNT /NXTRAC,NXFLAG,NXALLC,NCPPER,NMINRT,NDPOR,NXXTRA
!...Begin TJS
      COMMON/AXIS/LINTAX
!...End TJS

      DIMENSION FSECM(NM),S(NM),                                        &
     &   INDH(MINTVL),NMH(MINTVL),MJDSEC(NSETA),                        &
     &   FSEC(NSETA),MJDSV(NSETA),FSECV(NSETA),NMAXG(NSETA),            &
     &   NTOLDV(NSETA),XI(1),PXPF(1),                                   &
     &   LSETS(NSETA),IPXPF(NVSATS),IVSATS(NVSATS),AA(1),II(1),LL(1)
      DIMENSION IISUB(24),IIVAL(24),IIADDR(24)
      DIMENSION IISUB2(12),IIVAL2(9)
      DIMENSION IPLPTR(NSETA),NPANEL(NSETA),NMOVEP(NSETA)
      DIMENSION TPMEAS(MINTIM,2),LTPMES(MINTIM,3)
      DIMENSION ISTPSV(1)
      DIMENSION LSETDN(NSETA)
      DIMENSION ISATIQ(1)
      DIMENSION TMOS0(1),TMOS(1),TMOSP(1)
      DIMENSION SUMXOS(3,2,1)
      DIMENSION SUMPOS(NEQNI,3,2,1)
      DIMENSION XDDTOS(3,KNSTEPS,1)
      DIMENSION PDDTOS(NEQNI,3,KNSTEPS,1)
      DIMENSION HOS(1)
      DIMENSION T1SEG(10),T2SEG(10)
      EQUIVALENCE (KIBACK,IIADDR(1)),(JIBACK,IISUB(1)),                 &
     &            (IBACK ,IIVAL(1))
      EQUIVALENCE(IISUB2(1),JIBCKN)
      EQUIVALENCE(IIVAL2(1),IBCKNC)
      DATA ZERO/0.0D0/,POSNEG/1.0D0/
!
!***********************************************************************
! START OF EXECUTABLE CODE *********************************************
!***********************************************************************
!
      IAST=1
      IF(TLBOD2.GE.2.D0.AND.LBINAST) IAST=2
      ISETU=1
      IF(LASTSN) THEN
        ISETU=2
        NDPOR2=2*NDPOR
        NQ=NDPOR2
        GM2=1.D0
        NAST=1
        IF(LBINAST) THEN
          ISETU=3
          NAST=2
          NQ=NQ*2
          GM2=AA(KPRMV-1+IPVAL(IX2GM))
        ENDIF
        ALLOCATE(XR(NQ))
        ALLOCATE(XRP(NQ))
      ENDIF
!       write(6,*)' dbg enter ORBIT ',TMOS0(1),TMOS(1),TMOSP(1)
!***** BEGIN DEBUG *****
!      PRINT 12345,MJDSM,NM
12345 FORMAT(' ** ORBIT **  MJDSM,NM=',2I12)
!     PRINT 12346,(FSECM(I),I=1,NM)
12346 FORMAT(' ** ORBIT **  FSECM='/(1X,10G13.6))
!***** END DEBUG *****
! DEP ONE LINE
      JH=KH
      HOS(1)=AA(JH)
      IF(NINTOT.GT.0.AND.LINTF) THEN
      XQBACK=.001D0+(TMOS(1)-TMOS0(1))/HOS(1)
      IQBACK=XQBACK
      ENDIF
      M3SAT=NVSATS
      M3SAT=M3SAT*3
      LTHDRG=.FALSE.
      LROCK4=.FALSE.
! STORE THE II ARRAY SUBSCRIPTS INTO COMMON/CINTJI/
      DO 1000 I=1,24
      IISUB(I)=IIADDR(I)
 1000 END DO
      JIBCKN=KIBCKN
      JNRAT=KNRAT
      JIXDDN=KIXDDN
      JISMXN=KISMXN
      JDXDDN=KDXDDN
      JDSMXN=KDSMXN
      JICPPN=KICPPN
      JPXDDA=KIPXDA
      JNEQNA=KNEQNH
      JFHIRT=KFHIRT
      JSURFF=KLSURF
      JPTFBS=KPTFBS
! DELTA STATE POINTERS
      JNXSTA=KXSTAT
      JTXSTA=KTXSTA
      JDELXS=KDELXS
      JIPXST=KPXST
!
      JLORBT=KLORBT
      JLORBV=KLORBV
      JLNDRG=KLNDRG
      JCTOL=KCTOL
      JH=KH
      JHV=KHV
      JVSATS=1
      JXSATS=1
      JPXPF=1
      JXI=1
      JSAT=0
      NPV=2
      IF(LRANGE.AND..NOT.LVMTFO) NPV=1
      IF(LTIEOU) NPV=2
      NM3=3*NM
      NM6=6*NM
      ICSAT=0
! LOOP THRU EACH SATELLITE SET
      DO 10000 ISET=1,NSETA
      ISET1=ISET-1
      ISQ=ISET-1
      IDEL=(II(KISUMX+ISET1)-II(KISUMX))/3
      JSUMRC=KSUMRC+IDEL
      IDEL=(II(KIXDDT+ISET1)-II(KIXDDT))/3
      JXDDRC=KXDDRC+IDEL
      IF(ISET.GT.1) ICSAT=ICSAT+II(KNSAT+ISET-2)
! SUBSCRIPT THE II ARRAY AND STORE THE VALUES IN COMMON/CINTI/
      DO 2000 I=1,24
      IIVAL(I)=II(IISUB(I))
 2000 END DO
      DO IQP=1,9
         IIVAL2(IQP)=II(IISUB2(IQP))
      ENDDO
      IXDDAC=(IXDDNC-KXDDNC)*NFSCAC+KXDDAO
      NRAT1=NRATO-1
      IF(.NOT.LSETS(ISET).AND..NOT.LASTSN) GO TO 8000
!!!   IF(.NOT.LSETS(ISET).AND.ISET.GT.2) GO TO 8000
      IF(.NOT.LSETS(ISET).AND.ISET.GE.ISETU) GO TO 8000
! SET THE COMMON BLOCK GEODEG
      NTOLD=NTOLDV(ISET)
      NMAX =NMAXG(ISET)
      NMAXP1=NMAX+1
      NP=NMAX*(NMAXP1)/2+3*NMAX
      IGPP=KNEQN+ISET1
      NAJCA=II(IGPP+2*MSETA)
      NAJSA=II(IGPP+3*MSETA)
      NAJCG=II(IGPP+4*MSETA)
      NAJSG=II(IGPP+5*MSETA)
      NAJCT=II(IGPP+6*MSETA)
      NAJST=II(IGPP+7*MSETA)
!  SET FORCE EXECUTIVE COMMON BLOCKS
      ESSTRT=II(KMJDS0+ISET1)+AA(KFSEC0+ISET1)
      SSTRTC(ISET1+1)=ESSTRT
      JIORFR=KIORFR+ISET1*3
      JIPDFR=KIPDFR+ISET1*3
      IORDRG=II(JIORFR)
      IORSRD=II(JIORFR+1)
      IORGA=II(JIORFR+2)
      IPDDRG=II(JIPDFR)
      IPDSRD=II(JIPDFR+1)
      IPDGA=II(JIPDFR+2)
      LSDRG=IORDRG.GT.0
      LSSRD=IORSRD.GT.0
      LSGA=IORGA.GT.0
      LNVEL=LL(JLNDRG)
      IF(LSGA) LNVEL=.FALSE.
      LSORB=LL(JLORBT)
      JJSPFR=KJSPFR+ISET1*9
      JSPDRG(1)=II(JJSPFR)
      JSPDRG(2)=II(JJSPFR+1)
      JSPDRG(3)=II(JJSPFR+2)
      JSPSRD(1)=II(JJSPFR+3)
      JSPSRD(2)=II(JJSPFR+4)
      JSPSRD(3)=II(JJSPFR+5)
      JSPGA(1)=II(JJSPFR+6)
      JSPGA(2)=II(JJSPFR+7)
      JSPGA(3)=II(JJSPFR+8)
      JCSAT=ICSAT
! COMPUTE POINTERS TO TOPEX ATTITUDE PARAMETERS
      JTPXAT=II(KITPAT+ISET1)
      JLPXAT=II(KILTPX+ISET1)
!
!  CALCULATION OF POINTER TO SATELLITE ID ARRAY FOR THE FIRST
!  SATELLITE IN THE SET
! CALCULATE SWITCHES FOR ROCK4 SOLAR RADIATION MODEL
! IF SETS OF SATELLITES ARE USED, ALL SATELLITES IN SET MUST HAVE THE
! SAME MASS.
      ISATID=II(KISATN+IVSATS(1)-1)
      IF((IRKONA.GT.0).OR.(THRMFL.EQ.POSNEG)) THEN
      ISATID=II(KISATN+IVSATS(1)-1)
! ROCK4 MODEL CODE
       IF(IRKONA.GT.0) THEN
        IF(NROCK4.GT.0) THEN
          DO 2010 ISTID=1,NROCK4
            IF(ISATID.EQ.IDRCK4(ISTID)) THEN
             LROCK4=.TRUE.
             IRKSTN=IVSATS(1)
             IGPSBK=MOD(ISATID,10)
             !if( igpsbk == 3 ) igpsbk = 2   ! tct 20151116
             !if( igpsbk >= 3 ) igpsbk = 3   ! jjm 20130617
             GOTO 2015
            ENDIF
 2010     CONTINUE
          GOTO 2015
        ELSE
          LROCK4=.TRUE.
          IRKSTN=IVSATS(1)
          IGPSBK=MOD(ISATID,10)
          !if( igpsbk == 3 ) igpsbk = 2   ! tct 20151166
          !if( igpsbk >= 3 ) igpsbk = 3   ! jjm 20130617
        ENDIF
       ENDIF
 2015 CONTINUE
! THERMAL DRAG CODE
       IF(THRMFL.EQ.POSNEG) THEN
            IF(ISATID.EQ.INT(DRGSAT)) THEN
             LTHDRG=.TRUE.
             IDGSTN=IVSATS(1)
            ENDIF
       ENDIF
      ENDIF
!
! BOX-WING PARAMTER POINTER CONTROL
!*************************************************************
!  THIS CODE ASSUMES ONLY ONE SATELLITE PER SET!!!!!!!
!*************************************************************
! INITIALIZE LVAREA,LTOPEX
      LVAREA = .FALSE.
      LTOPEX = .FALSE.
      LSPOT2 = .FALSE.
      LGPSVA = .FALSE.
      LERS1  = .FALSE.
      LMO    = .FALSE.
      LMOC   = .FALSE.
      LEXATO = .FALSE.
      LTDRSA = .FALSE.
      LMAGNA = .FALSE.
      LGFO   = .FALSE.
      LTRMM  = .FALSE.
      LEUVE  = .FALSE.
      LVCL   = .FALSE.
      LENVS  = .FALSE.
      LCRYO  = .FALSE.
      LGRAIL = .FALSE.
      LEXTAC = .FALSE.
      LHY2A  = .FALSE.
      LSARAL = .FALSE.
      DO IJ=1,NSURF
      IF(LL(JSURFF-1+IJ)) LEXTAC = .TRUE.
      ENDDO
      IF(NPANEL(ISET).GT.0.OR.LEXTAC) THEN
! LOAD EXTERNAL ATTITUDE INFORMATION IF NECESSARY
         IF(LEXATT) THEN
         IF(LL(KEALQT+ISET-1)) THEN
          LEXATO = .TRUE.
          ISBJ20 = II(KEASBJ+ISET-1)
          NUMPEA = II(KEANMP+ISET-1)
          IPMPEA = II(KEAPMP+ISET-1)
          MJDSEA = II(KEAMJS+ISET-1)
          FSSCEA = AA(KEAFSS+ISET-1)
          RINTEA = AA(KEAINS+ISET-1)
         ENDIF
         ENDIF
         ENDIF
      IF(NPANEL(ISET).GT.0.OR.LEXTAC) THEN
!&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
! SET LOGICAL FLAGS FOR SAT ATTITUDE CONTROL
       IF(II(KSCATT+ISET-1) .EQ.1) THEN
         LTOPEX=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 2) THEN
         LSPOT2=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 3) THEN
         LGPSVA=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 4) THEN
         LERS1=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 5) THEN
         LMO=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 6) THEN
         LMOC=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 7) THEN
         LTDRSA=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 8) THEN
         LMAGNA=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 9) THEN
         LGFO=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 10) THEN
         LTRMM=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 11) THEN
         LEUVE=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 12) THEN
         LVCL=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 13) THEN
         LENVS=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 14) THEN
         LCRYO=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 15) THEN
         LGRAIL=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 16) THEN
         LGRAIL=.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 17) THEN
         LHY2A =.TRUE.
       ELSE IF (II(KSCATT+ISET-1) .EQ. 18) THEN
         LSARAL=.TRUE.
       ENDIF
!&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&
      ENDIF
      IF(NPANEL(ISET).GT.0) THEN
! COMPUTE POINTERS TO BOX-WING PARAMTER VALUES
         JBFNRM = KBFNRM+IPLPTR(ISET)-1
         JBFNR2 = JBFNRM + NTFACE
         JBFNR3 = JBFNRM + 2*NTFACE
!        print *,'orbit: NTFACE: ',NTFACE
!        print *,'orbit: jbfnr: ',jbfnrm,jbfnr2,jbfnr3
         JTDNRM = KTDNRM+IPLPTR(ISET)-1
         JTDNR2 = JTDNRM + NTFACE
         JTDNR3 = JTDNRM + 2*NTFACE
!        print *,'orbit: jtdnr: ',jtdnrm,jtdnr2,jtdnr3
         JBWARE = KPRMV+IPVAL(IXAREA)+IPLPTR(ISET)-2
         JBWSPC = KPRMV+IPVAL(IXSPRF)+IPLPTR(ISET)-2
         JBWDIF = KPRMV+IPVAL(IXDFRF)+IPLPTR(ISET)-2
         JBWEMS = KPRMV+IPVAL(IXEMIS)+IPLPTR(ISET)-2
         JBWTPA = KPRMV+IPVAL(IXTMPA)+IPLPTR(ISET)-2
         JBWTPC = KPRMV+IPVAL(IXTMPC)+IPLPTR(ISET)-2
         JBWTMD = KPRMV+IPVAL(IXTIMD)+IPLPTR(ISET)-2
         JBWTMF = KPRMV+IPVAL(IXTIMF)+IPLPTR(ISET)-2
         JBWTHX = KPRMV+IPVAL(IXTHTX)+IPLPTR(ISET)-2
! COMPUTE POINTERS TO UNADJUSTED TO ADJUSTED MAPPING ARRAYS(IPTRUA)
         JARUA  = KPTRUA+IPVAL(IXAREA)+IPLPTR(ISET)-2
         JSPUA  = KPTRUA+IPVAL(IXSPRF)+IPLPTR(ISET)-2
         JDFUA  = KPTRUA+IPVAL(IXDFRF)+IPLPTR(ISET)-2
         JEMUA  = KPTRUA+IPVAL(IXEMIS)+IPLPTR(ISET)-2
         JTAUA  = KPTRUA+IPVAL(IXTMPA)+IPLPTR(ISET)-2
         JTCUA  = KPTRUA+IPVAL(IXTMPC)+IPLPTR(ISET)-2
         JTDUA  = KPTRUA+IPVAL(IXTIMD)+IPLPTR(ISET)-2
         JTFUA  = KPTRUA+IPVAL(IXTIMF)+IPLPTR(ISET)-2
         JTXUA  = KPTRUA+IPVAL(IXTHTX)+IPLPTR(ISET)-2
! DETERMINE # OF PLATES & # OF MOVEABLE PLATES FOR SAT. OF INTEGRATION
         NFACE  = NPANEL(ISET)
         NMOVE  = NMOVEP(ISET)
! DETERMINE AREA AND MASS FOR SAT. OF INTEGRATION
         SCAREA = AA(KAREA+ISET-1)
         SCMASS = AA(KXMASS+ISET-1)
! DETERMINE MEAN MOTION FOR SAT. OF INTEGRATION FOR THERMAL MODEL
         IKEPLR=(ISET-1)*6+KCKEP
       IF(II(KSCATT+ISET-1) .EQ.1) BWMEAN = SQRT(AA(IKEPLR)**3/GM)
! SET LOGICAL FLAG FOR VARIABLE AREA
         LVAREA=.TRUE.
      ENDIF
!
!
      IF(LSORB) GO TO 2030
!
!  SET FORCE MODEL ADJUSTMENT LOGICALS & POINTERS
      JLAFR1=KLAFRC+ISET1*12-1
      JLAFR5=JLAFR1+4
      JLAFR9=JLAFR1+8
      DO 2020 N=1,4
      LSADRG(N)=LL(JLAFR1+N)
      LSASRD(N)=LL(JLAFR5+N)
      LSAGA(N)=LL(JLAFR9+N)
 2020 END DO
      JJSAFR=KJSAFR+ISET1*MXFMG
!
! THE NEXT SECTION OF CODE (UNTIL 2030 CONTINUE)
! UNLOADS THE JSAFRC ARRAY
! INTO TWO COMMON BLOCKS OF POINTERS SETAPT AND BWINTG
! THE POINTERS ARE INDXES OF WHERE EACH FORCE MODEL
! CATEGORY FITS INTO THE EXPLICIT PARTIAL ARRAY FOR
! THE VARIATIONAL EQUATIONS
!
! NOTE THAT THE POINTERS IN JSAFRC, AND SETAPT
! ARE NOT ALWAS IN ASCENDING ORDER. THEY DO, HOWEVER,
! POINT TO THE PROPER LOCATION IN THE VARIATIONAL
! EQUATIONS
!
!
!
!Categories for MXFMG (Currently 39)
!
!(note that JSAFRC is mostly in ascending order with the following 3 exceptions)
!
!1) JSAFRC(39) (finite BURN) is just after JSAFRC(18) (TUM SOLR)
!2) JSAFRC(26) (Dynamic PM contribution to C20) is just after JSAFRC(19) (C & S
!3) JSAFRC(38) (Planetary Orientation) is just after JSAFRC(25) (DynamiC Xp and
!

!
! FOLLOWING 3 POINTERS ARE IN SETADJ
      JSADRG(1)=II(JJSAFR)   ! DRAG
      JSASRD(1)=II(JJSAFR+1) ! SOLAR RAD
      JSAGA(1)=II(JJSAFR+2)  ! GEN ACCEL
! COMPUTE POINTERS TO BOX-WING PARAMETER PARTIALS
! THE FOLLOWING 9 (THROUGH JTXADJ) POINTERS IN BWINTG
      JARADJ = II(JJSAFR+3)
      JSPADJ = II(JJSAFR+4)
      JDFADJ = II(JJSAFR+5)
      JEMADJ = II(JJSAFR+6)
      JTAADJ = II(JJSAFR+7)
      JTCADJ = II(JJSAFR+8)
      JTDADJ = II(JJSAFR+9)
      JTFADJ = II(JJSAFR+10)
      JTXADJ = II(JJSAFR+11)
! REMAINING POINTERS ARE IN SETADJ
      JTHDRG = II(JJSAFR+12) ! LAGEOS THERMAL DRAG SPIN AXIS
      JFAADJ = II(JJSAFR+13) ! FANTOM ARC FORCE PARAMETERS POINTER
      JACBIA = II(JJSAFR+14) ! ACCELEROMETER BIAS
      JATITD = II(JJSAFR+15) ! ARC FORCE ATTITUDE
      JDSTAT = II(JJSAFR+16) ! DELTA STATE
      JDTUM  = II(JJSAFR+17) ! TUM SOLAR RAD
!              JSAFRC(39)   FINITE BURN
      JSACS=II(JJSAFR+18)    ! GLOBAL GEOPTENTIAL POINTER
!              JSAFRC(26)         POLAR MOTION J2 PARTIAL
      JSATID=II(JJSAFR+19)   ! TIDES
      JSALG=II(JJSAFR+20)    ! LOCAL GRAVITY
      JSAKF=II(JJSAFR+21)    ! DYNAMIC POLAR MOTION SCALE
      JSAGM=II(JJSAFR+22)    ! CENTRAL BODY GM
      JSAPGM=II(JJSAFR+23)   ! PLANETARY MOON
      JSAXYP=II(JJSAFR+24)   ! POLAR MOTION (WHEN THERE IS A FORCE EFFECT
!              JSAFRC(38)          PLANETARY ORIENTATION
      JSADJ2=II(JJSAFR+25)   ! POLAR MOTION J2 PARTIAL
      JFGADJ=II(JJSAFR+26)   ! GLOBAL FANTOM FORCE MODEL PARTIALS
      JLTPMU=II(JJSAFR+27)   ! LENSE THIRRING MU PARTIALS
      JLTPAL=II(JJSAFR+28)   ! LENSE THIRRING ALPHA PARTIALS
      JL2CCO=II(JJSAFR+29)   ! C COEFS FOR 2ND ASTEROID
      JL2SCO=II(JJSAFR+30)   ! S COEFS FOR 2ND ASTEROID
      JL2GM =II(JJSAFR+31)   ! GM 2ND ASTEROID
      JL2AE =II(JJSAFR+32)   ! AE 2ND ASTEROID
      JLRELT=II(JJSAFR+33)   ! RELATIVITY PARM FOR SUN
      JLJ2SN=II(JJSAFR+34)   ! J2 SUN
      JLGMSN=II(JJSAFR+35)   ! GM SUN
      JLPLFM=II(JJSAFR+36)   ! 698 PLANETARY FORCE
      JSAXTO=II(JJSAFR+37)   ! PLANETARY ORIENTATION PARTIALS
      JSABRN=II(JJSAFR+38)   !  FINITE BURN PARTIALS
 2030 CONTINUE
!
      LXEPH=.FALSE.
      IF(NXPSAT.GT.0 .AND. .NOT. LSTART ) THEN
        ISATID=II(KISATN+ISET-1)
        DO IQP=1,NXPSAT
          IF(ISATID.EQ.IXPSAT(IQP)) LXEPH=.TRUE.
        ENDDO
      ENDIF
!
      CALL CLRTRG(AA,NSAT)
      H=AA(JH)
      HV=AA(JHV)
! COMPUTE TIME OF LAST OBSERVATION PLUS TWO ORBIT STEPS
      H2=H+H
      ISH2=H2
      FSH2=H2-ISH2
      FSEC2=FSECM(NM)+FSH2
      ISEC=FSEC2
      FSEC2=FSEC2-ISEC
      MJDS2=MJDSM+ISH2+ISEC
! COMPUTE TIME DIFFERENCE WITH ORBIT INTEGRATION TIME
      DIFSEC=(MJDSEC(ISET)-MJDS2)+FSEC(ISET)-FSEC2
      IF(LONLYX) GO TO 3000
! COMPUTE TIME OF LAST OBSERVATION PLUS TWO VAR.EQ.STEPS
      HV2=HV+HV
      ISHV2=HV2
      FSHV2=HV2-ISHV2
      FSECV2=FSECM(NM)+FSHV2
      ISEC=FSECV2
      FSECV2=FSECV2-ISEC
      MJDSV2=MJDSM+ISHV2+ISEC
! COMPUTE DIFFERENCE WITH VAR.EQ. INTEGRATION TIME
      DIFSV=(MJDSV(ISET)-MJDSV2)+FSECV(ISET)-FSECV2
! DETERMINE IF INTEGRATOR MUST BE ADVANCED FOR VAR.EQ.
      IF(DIFSV.GE.ZERO)GO TO 3000
! DETERMINE IF VAR.EQ. TIME IS LATER THAN ORBIT TIME
      DIFS2=(MJDS2-MJDSV2)+FSEC2-FSECV2
      IF(DIFS2.GE.ZERO)GO TO 4000
! IF SO RESET REQUIRED ORBIT TIME EQUAL TO REQUIRED VAR.EQ. TIME
      MJDS2=MJDSV2
      FSEC2=FSECV2
      GO TO 4000
 3000 CONTINUE
! DETERMINE IF INTEGRATION MUST BE ADVANCED FOR ORBIT
      IF(DIFSEC.GE.ZERO)GO TO 5000
 4000 CONTINUE
! INTEGRATE FORWARD TO REQUIRED TIME
      JEQN=MAX(NEQN,1)
      JEQN3=MAX(NEQN3,1)
      IF(LASTSN) THEN
       IF(ISET.EQ.1) THEN
          JEQNA=MAX(NEQN,1)
          JEQNA3=MAX(NEQN3,1)
          NQ=JEQNA3*2
          IF(LBINAST) NQ=NQ*2
          ALLOCATE(PXA(NQ))
       ENDIF
       IF(ISET.GE.ISETU) THEN
          IFCT=1
          JFCT=0
          IF(LBINAST) IFCT=2
          IF(LBINAST.AND.IAST.EQ.2) JFCT=1
          ISUMXA=KQAST1+(ISET-ISETU)*6*NH*IFCT
          IXDDTA=KQAST2+(ISET-ISETU)*3*NSTEPS*IFCT
          ISMPXA=KQAST3+(ISET-ISETU)*JEQNA3*2*NH*IFCT
          IPXDTA=KQAST4+(ISET-ISETU)*JEQNA3*NSTEPS*IFCT
          JSUMXA=ISUMXA+6*NH*JFCT
          JXDDTA=IXDDTA+3*NSTEPS*JFCT
          JSMPXA=ISMPXA+JEQNA3*2*NH*JFCT
          JPXDTA=IPXDTA+JEQNA3*NSTEPS*JFCT
       ENDIF
      ENDIF
      JNVSTP=KNVSTP+ISET1
      LATOT=(NRAT1.LE.0)
      LSAVEA=.FALSE.
      NSTPSV=0
      JPTFSB=KPTFSB+ISET1*MXHRG
      JDYACT=KDYACT+JSAT*MDYNPD*2
      JDYNPE=KDYNPE+JSAT
      JEXACT=KEXACT+JSAT*2
      JXACIN=KXACIN+JSAT
      JXACOB=KXACOB+JSAT*MACOBS
      JACCBT=KACCBT+JSAT*MBAPPD*2
      JACPER=KACPER+JSAT*MBAPPD
      JACCPE=KACCPE+JSAT
      IF(NINTOT.GT.0.AND.LINTF) GO TO 5000
      ISATIQ(1)=ISATID
! INTEGRATE FORWARD TO REQUIRED TIME
      IF(.NOT.LASTSN) THEN
!
!  IN THE CASE OF NOT LASTSN DO NOT INTEGRATE IF THERE IS AN EXTERBAL
!  EPHEMERIS FOR THE SATELITE. THIS ALLOWS RANDOM TIME INTERPOLATION
!
      IF(.NOT.LXEPH) THEN
      CALL COWELL(LL(JLORBT),LNVEL,IBACK,IBACKV,                        &
     &   IORDER,IORDRV,H,HV,POSNEG,NOSTEP,NOCORR,                       &
     &   AA(JCTOL),NSAT,MJDSEC(ISET),FSEC(ISET),                        &
     &   MJDSV(ISET),FSECV(ISET),MJDS2,FSEC2,N3,                        &
     &   JEQN,JEQN3,NH,NHV,NSTEPS,NSTEPV,                               &
     &   AA(ICPP),AA(ICPV),AA(ICCP),AA(ICCV),                           &
     &   AA(KCIP),AA(KCIV),AA(ICCPV),AA(ICCVV),                         &
     &   AA(KVMATX),AA(KRSQ),AA(KXPPPP),AA(KX),                         &
     &   AA(ISUMX),AA(IXDDOT),AA(KPX),AA(KPX),AA(ISUMPX),               &
     &   AA(IPXDDT),AA(IPXDDT),II(JNVSTP),AA(KXDTMC),                   &
     &   AA(KDNLT+ICSAT),AA(JTPXAT),LL(JLPXAT),AA,II,LL,ISATIQ,         &
     &   AA(KXUTDT),                                                    &
     &   NRAT1,LATOT,AA(IXDDNC),IDXDDN,AA(ISMXNC),IBCKNC,IDSMXN,        &
     &   LSAVEA,AA(KXDDTH),AA(KPDDTH),AA(KTPXTH),LL(KLTPXH),NSTPSV,     &
     &   ISTPSV,AA(KXPPNC),AA(KXNC),AA(ICPPNC),AA(KXSSBS),AA(IXDDAC),   &
     &   LL(JFHIRT),LL(JSURFF),AA(IPXDDA),NEQNA,II(JPTFBS),             &
     &   II(JPTFSB),AA(JDYACT),                                         &
     &   II(JDYNPE),AA(JEXACT),AA(JXACIN),AA(JXACOB),LSETDN(ISET),      &
     &   AA(JACCBT),AA(JACPER),II(JACCPE),.FALSE.,II(JNXSTA),           &
     &   AA(JTXSTA),AA(JDELXS),AA(KSMRNC),II(JIPXST),AA(KPRX),          &
     &   AA(KSMRNP),AA(KDSROT),AA(JSUMRC),AA(JXDDRC),                   &
     &   TMOS0,TMOS,TMOSP,SUMPOS,                                       &
     &   SUMXOS,XDDTOS,                                                 &
     &   PDDTOS,KNSTEPS,NEQNI,ISEGM,T1SEG,T2SEG,AA(KSMPNS))
      ENDIF
      ELSE
       IISET=1
       IF(ISET.GE.ISETU) IISET=2
       IF(ISET.EQ.2.AND.LBINAST) IISET=3
       CALL SWTCPT(IISET,.TRUE.)
       IF(ISET.LT.ISETU) GO TO 8000
       KPX2=KPX+JEQN3*2
!!!!!  ISQ=ISET-1
       ISQ=1+ISET-ISETU
       CALL COWELA(LL(JLORBT),LNVEL,IBACK,IBACKV,                       &
     &   IORDER,IORDRV,H,HV,POSNEG,NOSTEP,NOCORR,                       &
     &   AA(JCTOL),NSAT,MJDSEC(ISET),FSEC(ISET),                        &
     &   MJDSV(ISET),FSECV(ISET),MJDS2,FSEC2,N3,                        &
     &   JEQN,JEQN3,NH,NHV,NSTEPS,NSTEPV,                               &
     &   AA(ICPP),AA(ICPV),AA(ICCP),AA(ICCV),                           &
     &   AA(KCIP),AA(KCIV),AA(ICCPV),AA(ICCVV),                         &
     &   AA(KVMATX),AA(KRSQ),AA(KXPPPP),AA(KX),                         &
     &   AA(ISUMX),AA(IXDDOT),AA(KPX),AA(KPX),AA(ISUMPX),               &
     &   AA(IPXDDT),AA(IPXDDT),II(JNVSTP),AA(KXDTMC),                   &
     &   AA(KDNLT+ICSAT),AA(JTPXAT),LL(JLPXAT),AA,II,LL,ISATIQ,         &
     &   AA(KXUTDT),                                                    &
     &   NRAT1,LATOT,AA(IXDDNC),IDXDDN,AA(ISMXNC),IBCKNC,IDSMXN,        &
     &   LSAVEA,AA(KXDDTH),AA(KPDDTH),AA(KTPXTH),LL(KLTPXH),NSTPSV,     &
     &   ISTPSV,AA(KXPPNC),AA(KXNC),AA(ICPPNC),AA(KXSSBS),AA(IXDDAC),   &
     &   LL(JFHIRT),LL(JSURFF),AA(IPXDDA),NEQNA,II(JPTFBS),             &
     &   II(JPTFSB),AA(JDYACT),                                         &
     &   II(JDYNPE),AA(JEXACT),AA(JXACIN),AA(JXACOB),LSETDN(ISET),      &
     &   AA(JACCBT),AA(JACPER),II(JACCPE),.FALSE.,II(JNXSTA),           &
     &   AA(JTXSTA),AA(JDELXS),AA(KSMRNC),II(JIPXST),AA(KPRX),          &
     &   AA(KSMRNP),AA(KDSROT),AA(JSUMRC),AA(JXDDRC),                   &
     &   TMOS0,TMOS,TMOSP,SUMPOS,                                       &
     &   SUMXOS,XDDTOS,                                                 &
     &   PDDTOS,KNSTEPS,NEQNI,ISEGM,T1SEG,T2SEG,AA(KSMPNS),             &
!    &   JEQNA,JEQNA3,AA(ISUMXA),AA(IXDDTA),AA(KPX2),AA(KPX2),          &
!    &   AA(ISMPXA),AA(IPXDTA),AA(IPXDTA),YQRDOT,SUMXRQ,YMNRT)
     &   JEQNA,JEQNA3,AA(KQAST1),AA(KQAST2),PXA,PXA,                    &
     &   AA(KQAST3),AA(KQAST4),AA(KQAST4),AA(KQAST6),AA(KQAST5),YMNRT,  &
     &   ISQ,XR,XRP,NAST,GM2,II(KISATN),II(KISATN+1))
      ENDIF
 5000 CONTINUE
      LXTRP=.FALSE.
      LXTRP1=.FALSE.
      LXTRP2=.FALSE.
!   GET COORDINATE SYSTEM QUANTITIES
!***** BEGIN DEBUG *****
!     PRINT 33333,MJDSM,FSECM(1),MJDSM,FSECM(NM)
!3333 FORMAT(' ** ORBIT **  MJDSM,FSECM(1),MJDSM,FSECM(NM)='/
!    1   (1X,I12,G24.16))
!***** END DEBUG *****
!     CALL BUFSAT(MJDSM,FSECM(1),MJDSM,FSECM(NM),1,MJDR,FSECR,
!    .   LRECAL,AA)
!     IF(LRECAL) GO TO 20000
!     CALL PRCSAT(MJDSM,FSECM,AA(KETA),AA(KZTA),AA(KTHTA),
!    .   AA(KSRTCH),NM)
!     CALL NUVSAT(MJDSM,FSECM,AA(KDPSI),AA(KEPST),AA(KEPSM),
!    .   NM,AA(KSRTCH))
!     CALL NPVSAT(MJDSM,FSECM,AA(KDPSI),AA(KEPST),AA(KEPSM),
!    .   AA(KETA),AA(KTHTA),AA(KZTA),NM,AA(KSRTCH),AA(KROTMT),
!    .   AA(KEQN),NDCRD2,.FALSE.)
!     CALL REFCRV(AA(KSRTCH),AA(KROTMT),NM)
      IF(LONLYV) GO TO 6000
      JXIP=JXI
      JXSATP=JXSATS
!
           IF(.NOT.LXEPH) THEN
!
! COMPUTE INTERPOLATION FRACTIONS FOR ORBIT
      IF(NINTOT.GT.0.AND.LINTF) THEN
         ITRK=TMOS(1)
         TRK=TMOS(1)-DBLE(ITRK)
         CALL INTRPS(MJDSM,FSECM,S,NM,INDH,NMH,                         &
     &               MINTVL,NINTVL,ITRK,TRK,                            &
     &               H,IQBACK)
      ELSE
         CALL INTRPS(MJDSM,FSECM,S,NM,INDH,NMH,                         &
     &               MINTVL,NINTVL,MJDSEC(ISET),FSEC(ISET),             &
     &               H,IBACK)
      ENDIF
!
           ENDIF
!
! INTERPOLATE FOR ORBIT
      DO 5500 KSAT=1,NSAT
      ISAT=JSAT+KSAT
      IF(ISAT.NE.IVSATS(JXSATS)) GO TO 5500
      JSUMX=ISUMX+(KSAT-1)*3
      JXDDOT=IXDDOT+(KSAT-1)*3
!
!
           IF(.NOT.LXEPH) THEN
!
      IF(NINTOT.GT.0.AND.LINTF) THEN
         CALL JNTRPO(S,AA(KAB),NM,AA(KCIP),AA(KCIV),                    &
     &      IORDER,H,INDH,NMH,NINTVL,AA(JSUMX),                         &
     &      AA(JXDDOT),N3,NH,NSTEPS,XI(JXI),MINTIM,18,3,AA(KSRTCH),     &
     &      AA(KROTMT),AA(KDNLT-1+ISAT),AA(JTPXAT),LL(JLPXAT),          &
     &      TPMEAS,LTPMES,SUMXOS,XDDTOS,KNSTEPS,ISAT,ISATID)
      ELSE
      N1Q=N3/3
         CALL INTRPO(S,AA(KAB),NM,AA(KCIP),AA(KCIV),                    &
     &      IORDER,H,INDH,NMH,NINTVL,AA(JSUMX),                         &
     &      AA(JXDDOT),N3,NH,NSTEPS,XI(JXI),MINTIM,18,3,AA(KSRTCH),     &
     &      AA(KROTMT),AA(KDNLT-1+ISAT),AA(JTPXAT),LL(JLPXAT),          &
     &      TPMEAS,LTPMES,N1Q,AA(JSUMRC),AA(JXDDRC),AA(KRLRNG),ISATID)
      ENDIF
!
           ENDIF
!
! INTERPOLATE FOR EXTERMAL EPHEMERIS IF OPTION IS INVOKED
! AND NOT IN THE STARTER
      IF(LXEPH) THEN
        ISATID=II(KISATN+IVSATS(KSAT)-1)
        CALL XEPHEM(AA,ISATID,MJDSM,XI(JXI),AA(KXEPBF),NM,              &
     &              FSECM,AA(KXEPBR),18,  L_error,LFIND)
!
! IF NOT LASTSN, ZERO OUT FORCE MODEL PARTIALS
!
        IF(.NOT.LONLYX.AND..NOT.LASTSN) THEN
           NZ=NM3*NEQN*NPV
           DO IZ=1,NZ
              PXPF(JPXPF-1+IZ)=0.D0
           ENDDO
        ENDIF
        IF(LFIND) LXTRP=.TRUE.
        IF(LFIND) LXTRP1=.TRUE.


        if( L_call_sumcmp )then

            if( L_error ) then
                return
            endif ! L_error

        endif !   L_call_sumcmp

! INCREMENT JXI BY 3 IF VELOCITY IS ALSO INTERPOLATED
        JXI=JXI+3*MINTIM
        ENDIF
      JXI=JXI+3*MINTIM
      JXSATS=JXSATS+1
 5500 END DO
      IF(LASTSN) THEN
         CALL INTRPO(S,AA(KAB),NM,AA(KCIP),AA(KCIV),                    &
     &      IORDER,H,INDH,NMH,NINTVL,AA(JSUMXA),                        &
     &      AA(JXDDTA),N3,NH,NSTEPS,AA(KASTO),MINTIM,3,3,AA(KSRTCH),    &
     &      AA(KROTMT),AA(KDNLT-1+ISAT),AA(JTPXAT),LL(JLPXAT),          &
     &      TPMEAS,LTPMES,N1Q,AA(JSUMRC),AA(JXDDRC),AA(KRLRNG),ISATID)
!
              IF(LSTSNX.AND.IAST.EQ.1)   THEN
         CALL XEPHEM(AA,II(KISATN),MJDSM,AA(KASTO),AA(KXEPBF),NM,       &
     &               FSECM,AA(KXEPBR),3,  L_error,LFIND)
         IF(LFIND) LXTRP=.TRUE.
         IF(LFIND) LXTRP2=.TRUE.

              ENDIF
              IF(LSTSNY.AND.IAST.EQ.2)   THEN
         CALL XEPHEM(AA,II(KISATN+1),MJDSM,AA(KASTO),AA(KXEPBF),NM,     &
     &               FSECM,AA(KXEPBR),3,  L_error,LFIND )
         IF(LFIND) LXTRP=.TRUE.
         IF(LFIND) LXTRP2=.TRUE.
              ENDIF
!

!...Begin TJS
!
! interpolate omega, axis, d{orie}/d(orie_0}, and d{orei}/d{inertia} to
! measurement times
         IF (LINTAX) THEN
            CALL INTROR(MJDSM,FSECM,S,AA(KAB),NM,AA(KCIP),AA(KCIV),     &
     &         IORDER,H,INDH,NMH,NINTVL,AA(KQAST5),                     &
!... &         YQRDOT,NH,NSTEPS,AA(KASTOR),MINTIM)
     &         AA(KQAST6),NH,NSTEPS,AA(KDPOR),MINTIM,ISQ,NAST)
!...
         END IF
!...End TJS
      ENDIF
! IF ONLY THE ORBIT IS REQUIRED BY PASS INTERPOLATION FOR VAR.EQ.
      IF(LONLYX) GO TO 7900
! IF ORDER AND STEPSIZE ARE THE SAME FOR ORBIT AND VAR.EQ.
!        DO NOT RECOMPUTE INTERPOLATION COEFFICIENTS
      IF(LL(JLORBV))GO TO 7000
! IF STEPSIZE IS THE SAME FOR ORBIT AND VAR.EQ.
!        DO NOT RECOMPUTE INTERPOLATION FRACTIONS
      IF(H.EQ.HV)GO TO 6500
 6000 CONTINUE
      CALL INTRPS(MJDSM,FSECM,S,NM,INDH,NMH,                            &
     &   MINTVL,NINTVL,MJDSV(ISET),FSECV(ISET),                         &
     &   HV,IBACKV)
 6500 CONTINUE
! RECOMPUTE INTERPOLATION COEFFICIENTS
      CALL COEFV(S,AA(KAB),NM,IORDRV,AA(KCIP),AA(KCIV))
 7000 CONTINUE
! INTERPOLATE FOR VAR.EQ.
      IEQN3=3*NEQN
      DO 7500 KSAT=1,NSAT
      ISAT=JSAT+KSAT
      IF(ISAT.NE.IVSATS(JVSATS)) GO TO 7500
      IF(LXEPH.AND..NOT.LASTSN) GO TO 7300
      JSUMPX=ISUMPX+(KSAT-1)*IEQN3
      JPXDDT=IPXDDT+(KSAT-1)*IEQN3
      IF(LNPNM) GO TO 7200
      IF(NINTOT.GT.0.AND.LINTF) THEN
         CALL JNTRPV(S,AA(KAB),AA(KAB),NM,NPV,AA(KCIP),AA(KCIV),        &
     &      IORDRV,HV,INDH,NMH,NINTVL,AA(JSUMPX),                       &
     &      AA(JPXDDT),NEQN3,NHV,NSTEPV,PXPF(JPXPF),IEQN3,AA(KSRTCH),   &
     &      AA(KROTMT),NEQN,SUMPOS,PDDTOS,KNSTEPS,NEQNI,ISAT)
      ELSE
         CALL INTRPV(S,AA(KAB),NM,NPV,AA(KCIP),AA(KCIV),                &
     &      IORDRV,HV,INDH,NMH,NINTVL,AA(JSUMPX),                       &
     &      AA(JPXDDT),NEQN3,NHV,NSTEPV,PXPF(JPXPF),IEQN3,AA(KSRTCH),   &
     &      AA(KROTMT),NEQN)
       IF(LASTSN) THEN
         CALL INTRPV(S,AA(KAB),NM,NPV,AA(KCIP),AA(KCIV),                &
     &      IORDRV,HV,INDH,NMH,NINTVL,AA(JSMPXA),                       &
     &      AA(JPXDTA),JEQNA3,NHV,NSTEPV,AA(KASTP),JEQNA3,AA(KSRTCH),   &
     &      AA(KROTMT),JEQNA)
       ENDIF
      ENDIF
      IF(II(JNXSTA).GT.0) THEN
         CALL FILDST(PXPF(JPXPF),NM,NEQN,3,NM,LNPNM,II(JIPXST),         &
     &               II(JNXSTA),AA(JTXSTA),MJDSM,FSECM)
      ENDIF
      GO TO 7300
 7200 CONTINUE
      IF(NINTOT.GT.0.AND.LINTF) THEN
         CALL JNTRV2(S,AA(KAB),AA(KAB),NM,NPV,AA(KCIP),AA(KCIV),        &
     &      IORDRV,HV,INDH,NMH,NINTVL,AA(JSUMPX),                       &
     &      AA(JPXDDT),NEQN3,NHV,NSTEPV,PXPF(JPXPF),IEQN3,AA(KSRTCH),   &
     &      AA(KROTMT),NEQN,SUMPOS,PDDTOS,KNSTEPS,NEQNI,ISAT)
      ELSE
         CALL INTRV2(S,AA(KAB),NM,NPV,AA(KCIP),AA(KCIV),                &
     &      IORDRV,HV,INDH,NMH,NINTVL,AA(JSUMPX),                       &
     &      AA(JPXDDT),NEQN3,NHV,NSTEPV,PXPF(JPXPF),IEQN3,AA(KSRTCH),   &
     &      AA(KROTMT),NEQN)
       IF(LASTSN) THEN
         CALL INTRV2(S,AA(KAB),NM,NPV,AA(KCIP),AA(KCIV),                &
     &      IORDRV,HV,INDH,NMH,NINTVL,AA(JSMPXA),                       &
     &      AA(JPXDTA),JEQNA3,NHV,NSTEPV,AA(KASTP),JEQNA3,AA(KSRTCH),   &
     &      AA(KROTMT),JEQNA)
       ENDIF
      ENDIF
      IF(II(JNXSTA).GT.0) THEN
         CALL FILDST(PXPF(JPXPF),NEQN,3,NM,NM,LNPNM,II(JIPXST),         &
     &               II(JNXSTA),AA(JTXSTA),MJDSM,FSECM)
      ENDIF
 7300 CONTINUE
      IF(LXTRP1) THEN
        NZQ=NM*NEQN3*NPV
        CALL CLEARA(PXPF(JPXPF),NZQ)
      ENDIF
      IF(LXTRP2) THEN
        NZQ=NM*JEQNA3*NPV
        CALL CLEARA(AA(KASTP),NZQ)
      ENDIF
      IPXPF(JVSATS)=JPXPF
      JPXPF=JPXPF+NM3*NEQN*NPV
      JVSATS=JVSATS+1
      IPXPF(JVSATS)=JPXPF
 7500 END DO
      IF(LONLYV) GO TO 8000
 7900 CONTINUE
      IF(LXEPH) GO TO 8000
      IF(NRAT1.LE.0) GO TO 8000
      IF(LXTRP) GO TO 8000
      HS=H/DBLE(NRATO)
      MINTV2=(NRAT1+1)*MINTVL
! COMPUTE INTERPOLATION FRACTIONS FOR  HIGH RATE PORTION OF ORBIT
      CALL INTRPS(MJDSM,FSECM,S,NM,INDH,NMH,                            &
     &   MINTV2,NINTVL,MJDSEC(ISET),FSEC(ISET),                         &
     &   HS,IBCKNC)
! INTERPOLATE FOR ORBIT
      DO 7950 KSAT=1,NSAT
      ISAT=JSAT+KSAT
      IF(ISAT.NE.IVSATS(JXSATP)) GO TO 7950
      JSUMX=ISMXNC+(KSAT-1)*3
      JXDDOT=IXDDNC+(KSAT-1)*3
      CALL INTRP2(S,AA(KAB),NM,AA(KCIP),AA(KCIV),                       &
     &   IORDER,HS,INDH,NMH,NINTVL,AA(JSUMX),                           &
     &   AA(JXDDOT),N3,IDSMXN,IDXDDN,XI(JXIP),MINTIM,18,3)
      JXIP=JXIP+3*MINTIM
      JXSATP=JXSATP+1
 7950 END DO
 8000 CONTINUE
! RESTORE UPDATED COMMON/CINTI/ BACK INTO II ARRAY
! INCREMENT THE II ARRAY SUBSCRIPTS IN COMMON/CINTJI/
      DO 9000 I=1,24
      II(IISUB(I))=IIVAL(I)
      IISUB(I)=IISUB(I)+1
 9000 END DO
      II(IISUB2(1))=IIVAL2(1)
      DO IQP=1,9
         IISUB2(IQP)=IISUB2(IQP)+1
      ENDDO
      IISUB2(10)=IISUB2(10)+NHRATE
      IISUB2(11)=IISUB2(11)+NSURF
      IISUB2(12)=IISUB2(12)+MXFMG
      JLORBT=JLORBT+1
      JLORBV=JLORBV+1
      JLNDRG=JLNDRG+1
      JCTOL=JCTOL+1
      JH=JH+1
      JHV=JHV+1
      JSAT=JSAT+NSAT
      JNXSTA=JNXSTA+1
      JTXSTA=JTXSTA+MXSTAT
!     JDELXS=JDELXS+6*MXSTAT*MXSSET
      JDELXS=JDELXS+6*MXSTAT*MSATG
      JIPXST=JIPXST+MXSTAT
10000 END DO
      IF(LASTSN) THEN
        DEALLOCATE(XR)
        DEALLOCATE(XRP)
        DEALLOCATE(PXA)
      ENDIF
      RETURN
!20000 CONTINUE
!      WRITE(IOUT6,30000)
!      WRITE(IOUT6,30100) MJDSM,FSECM(1),MJDSM,FSECM(NM)
!      STOP
!30000 FORMAT(' ** ORBIT **  INVALID INTERPOLATION INTERVAL REQUEST')
!30100 FORMAT(' ** ORBIT **  MJDSM,FSECM(1),MJDSM,FSECM(NM)='/
!     1   (1X,I12,G24.16))
      END
