!$D71
      FUNCTION D71(RASAT)
!********1*********2*********3*********4*********5*********6*********7**
!        DENSTY    00/00/00            0000.0    PGMR - ?
!
! FUNCTION:  THE FUNCTION DENSTY COMPUTES AN ATMOSPHERIC DENSITY
!            WHICH IS DEPENDENT UPON HEIGHT, TEMPERATURE, AND
!            SEASONAL LATITUDINAL VARIATIONS.  TEMPERATURE IS
!            DERIVED FROM THE JACCHIA 1971 MODEL AND IS
!            DEPENDENT UPON THE FOLLOWING:
!                1.  SOLAR ACTIVITY
!                2.  GEOMAGNETIC ACTIVITY AND
!                3.  DIURNAL BULGE
!            SEMIANNUAL VARIATIONS OF DENSITY ARE EXPRESSED AS
!            A PRODUCT FUNCTION OF HEIGHT AND TIME.  THERE ARE
!            SEASONAL LATITUDINAL VARIATIONS OF THE LOWER
!            THERMOSPHERE AND HELIUM
!            CALLING SEQUENCE  X=DENSITY(RASAT)
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   RASAT    I         RIGHT ASCENSION OF SATELLITE
!   X        O         ATMOSPHERIC DENSITY - KILOGRAMS/METERS**3
!
! COMMENTS:  SUBROUTINES USED  EPHEM     YMDAY
!            COMMON BLOCKS     CONSTS     D71CUR
!                              DRGBLK
!            INPUT FILES       NONE
!            OUTPUT FILES      NONE
!
! RESTRICTIONS:  D71TM MUST BE CALLED FIRST
!
! REFERENCES:  'GEODYN SYSTEMS DESCRIPTION'
!              VOLUME 1 - GEODYN DOCUMENTATION
!
!
!***********************************************************************
! UPDATED AS OF APRIL 1972
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
      INTEGER ORDER,START
      LOGICAL NOT1ST
      COMMON/CONSTR/PI,TWOPI,DEGRAD,SECRAD,SECDAY
      COMMON/D71CUR/DECS,RAS,T3,PHASE,XKP3,EXPKP3
      COMMON/DRGBLK/HT,SINPSD,SPSISQ,C(4),RHO
      DIMENSION A(116),B(68),AA(52),BB(20)
      DIMENSION AAA(64),BBB(48)
      EQUIVALENCE (A(1),AAA(1)),(B(1),BBB(1))
      EQUIVALENCE (AA(1),A(65)),(BB(1),B(49))
      EQUIVALENCE (PDPHDD,C(1))
      DATA BETA,GAMA,RX,P/-0.6457718232377D0,0.7504915783574D0,         &
     &   0.3D0,0.1047197551196D0/
      DATA EPSIL,HEAVOG/0.40910516667D0,0.6645999963D-23/
      DATA PI4,SIN3/0.78539816339745D0,0.35355339059327D0/
      DATA ANGLAT/0.261799387798D0/
      DATA NOT1ST/.FALSE./
! TEMPERATURE COEFFICIENTS FOR DENSITY AT DIFFERENT HEIGHT RANGES   DENS
      DATA AAA/                                                         &
     &0.422084965D+01,0.983928344D-02,-.649521233D-05,0.147153354D-08,  &
     &-.201342056D+00,-.234118844D-03,0.153367112D-06,-.346749274D-10,  &
     &0.785919150D-03,0.169661389D-05,-.110604189D-08,0.250068533D-12,  &
     &-.120874362D-05,-.343599982D-08,0.224570833D-11,-.510691411D-15,  &
     &-.128383533D+02,0.407089820D-02,0.970740661D-05,-.106425186D-07,  &
     &0.822820970D-01,-.312150292D-03,0.265426483D-06,-.551933238D-10,  &
     &-.689505146D-03,0.244015217D-05,-.270581417D-08,0.990034967D-12,  &
     &0.112627529D-05,-.418071733D-08,0.506171212D-11,-.204837314D-14,  &
     &-.845952322D+01,-.150004660D-03,-.626401948D-06,0.246118509D-09,  &
     &-.283949131D-01,0.177601433D-06,0.613977139D-08,-.233615412D-11,  &
     &0.559978736D-05,0.774612230D-07,-.594920440D-10,0.149206033D-13,  &
     &0.394341846D-08,-.764352159D-10,0.583325559D-13,-.145951773D-16,  &
     &-.776587002D+02,0.167271198D+00,-.565701826D-04,-.504239940D-07,  &
     &0.306380993D+00,-.989363990D-03,0.749319718D-06,-.531782724D-10,  &
     &-.389348557D-03,0.129726193D-05,-.107764650D-08,0.141909307D-12,  &
     &0.159620096D-06,-.540489521D-09,0.467085971D-12,-.718864688D-16/
! 90<HT<200    500<T<1900
! 200<HT<500   500<T<800
! 200<HT<500   800<T<1900
! 500<HT<1000   500<T<800
      DATA AA/                                                          &
     &0.500814708D+02,-.126002361D+00,0.838957294D-04,-.182762489D-07,  &
     &-.305716210D+00,0.617057455D-03,-.414428867D-06,0.910959298D-10,  &
     &0.417665660D-03,-.887429188D-06,0.610397456D-09,-.136339086D-12,  &
     &-.179649018D-06,0.393862918D-09,-.276392692D-12,0.626491439D-16,  &
     &0.365320863D+02,-.261563250D+00,0.419633964D-03,-.216612111D-06,  &
     &-.483521326D-01,0.268014614D-03,-.482136558D-06,0.270952542D-09,  &
     &0.111412513D-04,-.774997750D-07,0.160423077D-09,-.990549857D-13,  &
     &-.250589005D-10,0.447247686D-11,-.140853837D-13,0.104429402D-16,  &
     &0.524100209D+02,-.206524686D+00,0.216415617D-03,-.906228761D-07,  &
     &0.130541323D-10,                                                  &
     &-.143545587D+00,0.431133459D-03,-.461365240D-06,0.201788671D-09,  &
     &-.308882663D-13,                                                  &
     &0.876929605D-04,-.271568590D-06,0.297452608D-09,-.134249885D-12,  &
     &0.213696842D-16,                                                  &
     &-.157162434D-07,0.496306683D-10,-.552974078D-13,0.254318298D-16,  &
     &-.413037974D-20/
! 500<HT<1000   800<T<1900
! 1000<HT<2500   500<T<800
! 1000<HT<2500   800<T<1900
! TEMPERATURE COEFFICIENTS FOR HELIUM NUMBER DENSITIES
      DATA BBB/                                                         &
     &0.937120654D+01,-.526336337D-02,0.529828002D-05,-.204706482D-08,  &
     &-.131407605D-01,0.312183264D-04,-.325976944D-07,0.125725120D-10,  &
     &0.260709871D-05,-.757300493D-08,0.930575623D-11,-.406693907D-14,  &
     &-.521562252D-09,0.190563227D-11,-.265782390D-14,0.125348645D-17,  &
     &0.839137641D+01,-.164333851D-02,0.780319872D-06,-.143227388D-09,  &
     &-.690494191D-02,0.841382944D-05,-.445771845D-08,0.856271187D-12,  &
     &0.105103473D-05,-.126628705D-08,0.711336611D-12,-.141795218D-15,  &
     &-.122220789D-09,0.147452862D-12,-.976579395D-16,0.214583150D-19,  &
     &0.910459126D+01,-.434095713D-02,0.402920450D-05,-.145215436D-08,  &
     &-.122592469D-01,0.279509098D-04,-.279720268D-07,0.103709664D-10,  &
     &0.158929878D-05,-.358625514D-08,0.354761274D-11,-.129853194D-14,  &
     &-.118288308D-09,0.261378003D-12,-.252265763D-15,0.897136100D-19/
! 500<HT<1000   500<T<800     HELIUM
! 500<HT<1000   800<T<1900     HELIUM
! 1000<HT<2500   500<T<800       HELIUM
      DATA BB/                                                          &
     &0.861202904D+01,-.253633341D-02,0.189793214D-05,-.736961519D-09,  &
     &0.113879768D-12,                                                  &
     &-.848470542D-02,0.140836693D-04,-.113857415D-07,0.448705468D-11,  &
     &-.690642077D-15,                                                  &
     &0.115431761D-05,-.198838962D-08,0.166354361D-11,-.676277769D-15,  &
     &0.107063450D-18,                                                  &
     &-.945207301D-10,0.173870019D-12,-.153679377D-15,0.654016903D-19,  &
     &-.107604801D-22/
! 1000<HT<2500   800<T<1900      HELIUM
!
!***********************************************************************
! START OF EXECUTABLE CODE *********************************************
!***********************************************************************
!
!  INITIALIZE DENSITY CORRECTIONS
      HELIUM=0.0D0
      DENS=0.0D0
      DO 500 J=1,4
  500 C(J)=0.0D0
      C3=0.D0
      C1=0.D0
      VEL=0.D0
      YDOTR=0.D0
      IF(NOT1ST) GO TO 1
      FORPI=4.0D0*PI
      XLN10=LOG(10.0D0)
      NOT1ST=.TRUE.
    1 HT2=HT*1.0D-3
      HT=HT*1.D-5
      IF(HT.LT.25.0D0) GO TO 10
      D71=0.0D0
      RETURN
   10 CONTINUE
      IF(HT.LT.2.0D0) GO TO 30
      GEOMAG=28.0D0*XKP3+0.03D0*EXPKP3
      GO TO 32
   30 GEOMAG=14.0D0*XKP3+0.02D0*EXPKP3
      DENMAG=0.012D0*XKP3+1.2D-5*EXPKP3
      DENS=DENS+DENMAG
   32 CONTINUE
!  COMPUTE DIURNAL VARIATION OF TEMPERATURE
      HRANG=RASAT-RAS
      IF(HRANG.LT.0.D0)HRANG=HRANG+TWOPI
      PHI=SINPSD
      PHI=ASIN(PHI)
      THETA=ABS(PHI+DECS)*0.5D0
      ETA=ABS(PHI-DECS)*0.5D0
      TAU=HRANG+BETA+P*SIN(HRANG+GAMA)
      CE=COS(ETA)**2.2D0
      ST=SIN(THETA)**2.2D0
      STT=1.0D0+RX*ST
      TAU=MOD(TAU+TWOPI,TWOPI)
      IF(TAU.GT.PI) TAU=TAU-TWOPI
      CT=COS(TAU*0.5D0)
      CT=CT**3
!  CORRECTION FOR A GIVEN HOUR AND GEOGRAPHIC LOCATION
      TL=(T3*STT)*(1.0D0+RX*(CE-ST)/STT*CT)
      TEM=TL+GEOMAG
      TEM4=TEM**4
!  CORRECTION TO LOG OF DENSITY DUE TO SEMIANNUAL VARIATIONS
      FZA=-2.868D-3*HT2
      IF(FZA.LT.-20.0D0)GO TO 33
      EXPFZA=EXP(FZA)
      H1331=HT2**1.331D0
      FZ=(5.876D-7*(HT2*H1331)+0.06328D0)*EXPFZA
      DFZDZ=-2.868D-3*FZ+5.876D-7*2.331D0*H1331*EXPFZA
      PH=TWOPI*PHASE+6.035D0
      PH=MOD(PH,TWOPI)
      SP=(0.5D0+0.5D0*SIN(PH))**1.65D0-.5D0
      TAUT=PHASE+0.09544D0*SP
      TT2=TWOPI*TAUT+4.137D0
      TT2=MOD(TT2,TWOPI)
      TT4=FORPI*TAUT+4.259D0
      TT4=MOD(TT4,TWOPI)
      GT=0.02835D0+0.3817D0*(1.D0+0.4671D0*SIN(TT2))*SIN(TT4)
!  SEMIANNUAL EFFECTS ON LOG DENSITY
      C1=GT*DFZDZ
      DENS=DENS+FZ*GT
!  SEASONAL LATITUDINAL VARIATIONS OF THE LOWER THERMOSPHERE
   33 IF(HT.GT.1.6D0) GO TO 40
      HT90=HT2-90.0D0
      HT90SQ=HT90**2
      EXS=-0.0013D0*HT90SQ
      IF(EXS.LT.-20.D0) GO TO 40
      SS=0.014D0*EXP(EXS)
      PH=TWOPI*PHASE+1.72D0
      PH=MOD(PH,TWOPI)
      PP=SIN(PH)
      PHIABS=SIGN(1.0D0,PHI)
      DENLAT=SS*PHIABS*PP*SPSISQ
      VEL=DENLAT*(1.0D0-0.0026D0*HT90SQ)
      DENLAT=DENLAT*HT90
      DENS=DENS+DENLAT
   40 CONTINUE
!  SEASONAL LATITUDINAL VARIATIONS OF HELIUM
!        CORRECTIONS TO LOG HELIUM NUMBER DENSITY
      IF(HT.LT.5.0D0) GO TO 50
      IF(HT.GT.5.0D0.AND.HT.LT.8.0D0.AND.ABS(PHI).LT.ANGLAT)           &
     &    GO TO 50
      ARG=PI4-PHI*0.5D0*SIGN(1.0D0,DECS)
      SN=SIN(ARG)
      SN3=SN**3
      DECLP=DECS/EPSIL
      HELOG=0.65D0*ABS(DECLP)*(SN3-SIN3)
! CALCULATION OF LOG OF HELIUM NUMBER DENSITY
      START=0
      ORDER=4
      IF(TEM.GT.8.0D2) GO TO 42
      IF(HT.LE.10.0D0) GO TO 45
      START=32
      GO TO 45
   42 START=16
      IF(HT.LE.10.0D0) GO TO 45
      START=48
      ORDER=5
   45 K=START-ORDER
      DO 55 J=1,4
      K=K+ORDER
   55 C(J)=B(K+1)+TEM*(B(K+2)+TEM*(B(K+3)+TEM*B(K+4)))
      IF(ORDER.LT.5) GO TO 59
      K=START
      DO 56 J=1,4
      K=K+ORDER
   56 C(J)=C(J)+TEM4*B(K)
   59 HEFNCT=C(1)+HT2*(C(2)+HT2*(C(3)+HT2*C(4)))
      YDOTR=C(2)+(2.0D0*C(3)+3.0D0*C(4)*HT2)*HT2
      HELOG=HELOG+HEFNCT
      HELIUM=(10.0D0**(HELOG)-10.0D0**(HEFNCT))*HEAVOG
   50 CONTINUE
!  USE NEW POLYNOMIAL FIT TO JACCHIA'S DENSITY TABLES 1971
      START=0
      ORDER=4
      IF(HT.LE.2.0D0) GO TO 65
      IF(TEM.GT.8.0D2) GO TO 62
      START=16
      IF(HT.LE.5.0D0) GO TO 65
      START=48
      IF(HT.LE.1.0D1) GO TO 65
      START=80
      GO TO 65
   62 START=32
      IF(HT.LE.5.0D0) GO TO 65
      START=64
      IF(HT.LE.1.0D1) GO TO 65
      START=96
      ORDER=5
   65 K=START-ORDER
      DO 70 J=1,4
      K=K+ORDER
   70 C(J)=A(K+1)+TEM*(A(K+2)+TEM*(A(K+3)+TEM*A(K+4)))
      IF(ORDER.LT.5) GO TO 80
      K=START
      DO 75 J=1,4
      K=K+ORDER
   75 C(J)=C(J)+TEM4*A(K)
   80 EXPT=C(1)+HT2*(C(2)+HT2*(C(3)+HT2*C(4)))
      C3=C(2)+(2.0D0*C(3)+3.0D0*C(4)*HT2)*HT2
! COMPUTE DENSITY IN GM/CM**3 LESS DIRECT HELIUM CORRECTION
      EXSUMP=10.0D0**(EXPT+DENS)
! ADD HELIUM CORRECTION AND CONVERT TO KG/M**3
      D71   =1.0D3*(EXSUMP+HELIUM)
! COMPUTE PARTIAL OF DENSITY WRT SPHEROID HEIGHT IN KG/M**4
      PDPH=XLN10*(EXSUMP*(C3+C1+VEL)+HELIUM*YDOTR)
! NORMALIZE DENSITY PARTIAL BY DIVIDING BY DENSITY
      PDPHDD=PDPH/D71
      RETURN
      END
