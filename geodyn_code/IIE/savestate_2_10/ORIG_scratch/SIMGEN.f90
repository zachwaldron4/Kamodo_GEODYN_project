!$SIMGEN
      SUBROUTINE SIMGEN(AA,II,LL,NSAT1,NSAT2,NSAT3,NSTA1,NSTA2,NSTA3,   &
     &                 NTYP,MJDS1,MJDS2,FSECSM,CUTANG,SRFELV,OBTINT,    &
     &                 LFND,FSCSDM,MJDSDM,LPTS,XTIME,                   &
     &                 INDSAT,INDSTA,INDSET,INPSTA,INPSAT,LELEVS,       &
     &                 SMSD1,SMSD2,RNOISE,                              &
     &                 ILCORR )
!********1*********2*********3*********4*********5*********6*********7**
! SIMGEN           87/04/00            0000.0    PGMR - DESPINA PAVLIS
!
! FUNCTION:  GENERATES PSEUDO-BLOCKS FOR SIMULATED DATA
!
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   AA      I/O   A    REAL    DYNAMIC ARRAY
!   II      I/O   A    INTEGER DYNAMIC ARRAY
!   LL      I/O   A    LOGICAL DYNAMIC ARRAY
!
!      SCHEDULING INFORMATION ARRAYS LOADED
!
!   NSAT1    I    A    FIRST SATELLITE IN THE CONFIGURATION
!   NSAT2    I    A    SECOND SATELLITE IN THE CONFIGURATION
!   NSAT3    I    A    THIRD SATELLITE IN THE CONFIGURATION
!   NSTA1    I    A    FIRST STATION IN THE CONFIGURATION
!   NSTA2    I    A    SECOND STATION IN THE CONFIGURATION
!   NSTA3    I    A    THIRD STATION IN THE CONFIGURATION
!   NTYP     I    A    MEASUREMENT TYPE
!   MJDS1    I    A    START TIMES FOR SIMULATION
!   MJDS2    I    A    END TIMES FOR SIMULATION
!   FSECSM   I    A    FRACTIONAL SECONDS FOR START TIMES
!   CUTANG   I    A    ELEVATION CUTOFF ANGLES
!   SRFELV   I    A    SURFACE ELEVATION (FOR ALTIMETRY)
!   OBTINT   I    A
!
!      END OF SCHEDULING INFORMATION ARRAYS
!
!   LFND     O         .TRUE.=PSEUDO BLOCK PASSED VISIBILITY
!                      CHECK
!   FSCSDM  I/O   A    FRACTIONAL SECONDS FOR MJDSDM
!   MJDSDM  I/O   S    TIME FOR SIMULATED DATA CAPABILITY
!   LPTS     O    A    LOGICAL ARRAY FOR PSEUDO OBSERVATIONS
!                      .TRUE. = ACCEPTED OBSERVATION
!                      .FALSE. = NON-ACCEPTED OBSERVATION
!   XTIME   I/O        PRESENT TIME FOR SIMULATION CAPABILITY
!   INDSAT   I    A    FOR A GIVEN INTERNAL SAT NO (1,2,3) INDSAT
!                      GIVES THE ACTUAL LOCATION IN THE SATELLITE
!                      RELATED ARRAYS FOR THIS SATELLITE.
!                      (EG.   SAT ID=ISATNO(INDSAT(1,2,OR 3))
!   INDSTA   I    A    FOR A GIVEN INTERNAL STA NO (1,2,3) INDSTA
!                      GIVES THE ACTUAL LOCATION IN THE STATION
!                      RELATED ARRAYS FOR THIS STATION.
!                      (EG.   STA NO=ISTANO(INDSTA(1,2,OR 3))
!   INDSET   I    A    FOR A GIVEN INTERNAL SATELLITE NUMBER INDSET TELL
!                      WHICH SAT SET THAT THE GIVEN SAT BELONGS TO.
!   INPSTA   I    A    POINTER ARRAY THAT RELATES THE INTERNAL STATION
!                      NUMBER (1,2,3) TO THE STATIONS DEFINED IN THE
!                      DATA HEADER RECORDS (N=1,2,3). (EG.
!                      ISTAP=INPSTA(1) WOULD TELL WHICH OF THE THREE
!                      POSSIBLE STATIONS DEFINED IN THE DATA HEADER
!                      RECORDS PERTAINED TO INTERNAL STATION NO. 1)
!   INPSAT   I    A    POINTER ARRAY THAT RELATES THE INTERNAL SATELLITE
!                      NUMBER (1,2,3) TO THE SATELLITES DEFINED IN THE
!                      DATA HEADER RECORDS (N=1,2,3). (EG.
!                      ISATP=INPSAT(1) WOULD TELL WHICH OF THE THREE
!                      POSSIBLE SATELLITES DEFINED IN THE DATA HEADER
!                      RECORDS PERTAINED TO INTERNAL SATELLITE NO. 1)
!   LELEVS   I    A    LOGICAL ARRAY FOR ELEVATION CUTOFF ANGLE CHECK
!                      .TRUE = DO ELEVATION CHECK FOR THIS SATELLITE AND
!                      THIS LINK
!                      .FALSE = SKIP ELEVATION CHECK FOR THIS SATELLITE
!                      AND THIS LINK
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
      COMMON/SAVLTC/RLTCOR
      COMMON/BINBUF/NBUFIN,NLENI ,MAXBUF,MAXOBS,NBUFOT,NLENO ,NMAXOT,   &
     &              KBUFOT,MXBLEN,MAXTDD,NLENDR,MOBSBK,MXTIMB,          &
     &              MXOBSB,IIOBDR,IPSMAX,ILIMBK,NPASS ,MVERSN,NXBINB
      COMMON/CBLOKA/FSECBL,SIGNL ,VLITEC,SECEND,BLKDAT(6,4),DOPSCL(5,4)
      COMMON/CBLOKI/MJDSBL,MTYPE ,NM    ,JSTATS,NPSEG ,JSATNO(3),ITSYS ,&
     &       NHEADB,NELEVS,ISTAEL(12),INDELV(3,4),JSTANO(3),ITARNO,     &
     &       KTARNO
      COMMON/CBLOKL/LIGHT ,LNRATE,LNREFR,LPOLAD,LTDRIV,LNANT ,LNTRAK,   &
     &       LASER ,LGPART,LGEOID,LETIDE,LOTIDE,LNTIME,LAVGRR,LRANGE,   &
     &       LSSTMD,LSSTAJ,LNTDRS,LPSBL,LACC,LAPP,LTARG,LTIEOU,LEOTRM,  &
     &       LSURFM,LGEOI2,LSSTM2,LOTID2,LOTRM2,LETID2,LNUTAD
      COMMON/CKOUNT/KNTBLK,KSEGMN,KNTOBS,KZROBS
      COMMON/CLIGHT/VLIGHT,ERRLIM,XCLITE
      COMMON/CNIARC/NSATA,NSATG,NSETA,NEQNG,NMORDR,NMORDV,NSORDR,       &
     &              NSORDV,NSUMX,NXDDOT,NSUMPX,NPXDDT,NXBACK,NXI,       &
     &              NXILIM,NPXPF,NINTIM,NSATOB,NXBCKP,NXTIMB,           &
     &              NOBSBK,NXTPMS,NXCNIA
      COMMON/COBGLO/MABIAS,MCBIAS,MPVECT,MINTPL,MPARAM,MSTA,MOBBUF,     &
     &       MNPITR,MWIDTH,MSIZE ,MPART ,MBUF  ,NXCOBG
      COMMON/COBLOC/KXMN  (3,4)  ,KENVN (3,4)  ,KSTINF(3,4)  ,          &
     &       KOBS  ,KDTIME,KSMCOR,KSMCR2,KTMCOR,KOBTIM,KOBSIG,KOBSG2,   &
     &       KIAUNO,KOBCOR(9,7)  ,KFSECS(6,8)  ,KOBSUM(8)    ,          &
     &       KEDSIG,KEDSG2
      COMMON/COBREL/KDELCT(6,8)
      COMMON/CONTRL/LSIMDT,LOBS  ,LORB  ,LNOADJ,LNADJL,LORFST,LORLST,   &
     &              LORALL,LORBOB,LOBFST,LOBLST,LOBALL,LPREPO,LORBVX,   &
     &              LORBVK,LACC3D,LSDATA,LCUTOT,LACCEL,LDYNAC,LFRCAT,   &
     &              LNIAU, NXCONT
      COMMON/CORA01/KFSEC0,KFSECB,KFSEC ,KFSECV,KH    ,KHV   ,KCTOL ,   &
     &              KRSQ  ,KVMATX,KCPP  ,KCPV  ,KCCP  ,KCCV  ,KCCPV ,   &
     &              KCCVV ,KXPPPP,KX    ,KPX   ,KSUMX ,KXDDOT,KSUMPX,   &
     &              KPXDDT,KAB   ,KPN   ,KAORN ,KSINLM,KCOSLM,KTANPS,   &
     &              KCRPAR,KVRARY,KXM   ,KXNP1 ,KXPRFL,KXM2  ,KXNNP1,   &
     &              KWRK  ,KFI   ,KGE   ,KB0DRG,KBDRAG,KAPGM ,KAPLM ,   &
     &              KCN   ,KSN   ,KSTID ,KTIDE ,KSTDRG,KSTSRD,KSTACC,   &
     &              KLGRAV,KGM   ,KAE   ,KFPL  ,KFEQ  ,KPLNPO,KPLNVL,   &
     &              KXEPOC,KCD   ,KCDDOT,KCR   ,KGENAC,KACN  ,KASN  ,   &
     &              KTHDRG,KCKEP ,KCKEPN,KXNRMZ,KXNRMC,KFSCEP,KFSCND,   &
     &              KAREA ,KXMASS,KRMSPO,KTCOEF,KTXQQ ,KTIEXP,KTXMM ,   &
     &              KTXLL1,KTXSN1,KTS2QQ,KT2M2H,KT2MHJ,KTXKK ,KTSCRH,   &
     &              KPXPK ,KAESHD,KCSAVE,KSSAVE,KCGRVT,KSGRVT,KXDTMC,   &
     &              KDNLT ,KTXSN2,KTNORM,KTWRK1,KTWRK2,KUNORM,KAERLG,   &
     &              KSINCO,KPARLG,KCONST,KBFNRM,KTDNRM,KCSTHT,KTPSTR,   &
     &              KTPSTP,KTPFYW,KPLMGM,KTPXAT,KEAQAT,KEAFSS,KEAINS,   &
     &              KACS  ,KECS  ,KSOLNA,KSOLNE,KSVECT,KSFLUX,KFACTX,   &
     &              KFACTY,KADIST,KGEOAN,KPALB ,KALBCO,KEMMCO,KCNAUX,   &
     &              KSNAUX,KPPER ,KACOSW,KBSINW,KACOFW,KBCOFW,KANGWT,   &
     &              KWT   ,KPLNDX,KPLANC,KTGACC,KTGDRG,KTGSLR,KWTACC,   &
     &              KWTDRG,KWTSLR,KTMACC,KTMDRG,KTMSLR,KATTUD,KDYACT,   &
     &              KACCBT,KACPER,KXDDNC,KXDDAO,KXNC  ,KXPPNC,KSMXNC,   &
     &              KXDDTH,KPDDTH,KXSSBS,KCPPNC,KEXACT,KXACIN,KXACOB,   &
     &              KPXHDT,KTPXTH,KPACCL,KTXSTA,KDELXS,KSMRNC,KPRX  ,   &
     &              KSMRNP,KDSROT,KXUGRD,KYUGRD,KZUGRD,KSUMRC,KXDDRC,   &
     &              KTMOS0,KTMOS, KTMOSP,KSMXOS,KSGTM1,KSGTM2,KSMPNS,   &
     &              KXGGRD,KYGGRD,KZGGRD,KXEGRD,KYEGRD,KZEGRD,KSSDST,   &
     &              KSDINS,KSDIND,KSSDSR,KSSDDG,KTATHM,KTAINS,KTAFSS,   &
     &              KSRAT ,KTRAT ,KHLDV ,KHLDA1,KHLDA4,KHLDA7,KQAST1,   &
     &              KQAST2,KQAST3,KQAST4,KQAST5,KQAST6,NXCA01
      COMMON/CORA02/KFSCTB,KFSCTC,KFSCTE,KDSECT,                        &
     &              KFSECT,KS    ,KCIP  ,KCIV  ,                        &
     &       KXTN  ,KXSM  ,KXTK  ,KXSJ  ,KXTI  ,KXTKP ,                 &
     &       KVTN  ,KVSM  ,KVTK  ,KVSJ  ,KVTI  ,KVTKP ,                 &
     &       KSATLT,KSATLN,KSATH ,KCOSTH,KSINTH,                        &
     &       KPXPFM,KPXPFK,KPXPFJ,KTRBF ,KFSTRC,                        &
     &       KFSTRE,KDSCTR,KFSCVS,KXSMBF,KXSKBF,KXSJBF,                 &
     &       KRSSV1,KRSSV2,KRSSV3,KTPMES,KACOEF,KACTIM,                 &
     &       KXTNPC,KXSMPC,KXTKPC,KXSJPC,KXTIPC,KXTKPP,                 &
     &       KRLRNG,KASTO,KASTP,NXCA02
      COMMON/CORA03/KRFMT ,KROTMT,KSRTCH,KCFSC ,KTHG  ,KCOSTG,KSINTG,   &
     &              KDPSI ,KEPST ,KEPSM ,KETA  ,KZTA  ,KTHTA ,KEQN  ,   &
     &              KDPSR ,KSL   ,KH2   ,KL2   ,KXPUT ,KYPUT ,KUT   ,   &
     &              KSPCRD,KSPSIG,KSTAIN,KSXYZ ,KSPWT ,KDXSDP,KDPSDP,   &
     &              KXLOCV,KSTNAM,KA1UT ,KPLTIN,KPLTVL,KPLTDV,KPUTBH,   &
     &              KABCOF,KSPEED,KANGFC,KSCROL,KSTVEL,KSTVDV,KTIMVL,   &
     &              KSTEL2,KSTEH2,KSL2DV,KSH2DV,                        &
     &              KAPRES, KASCAL, KASOFF,KXDOTP,KSAVST,               &
     &              KANGT , KSPDT , KCONAM,KGRDAN,KUANG ,KFAMP ,        &
     &              KOFACT, KOTSGN,KWRKRS,KANFSD,KSPDSD,KPRMFS,KSCRFR,  &
     &              KCOSAS,KSINAS,KDXTID,KALCOF,KSTANF,KNUTIN,KNUTMD,   &
     &              KPDPSI,KPEPST,KDXDNU,KDPSIE,KEPSTE,NXCA03
      COMMON/CORA04/KABIAS,KABSTR,KABSTP,KCBIAS,KCBSTR,KCBSTP,          &
     &       KRNM  ,KRKM  ,KRKJ  ,KRIJ  ,KRKPM ,                        &
     &       KRRNM ,KRRKM ,KRRKJ ,KRRIJ ,KRRKPM,                        &
     &       KURNM ,KURKM ,KURKJ ,KURIJ ,KURKPM,                        &
     &       KPRRNM,KPRRKM,KPRRKJ,KPRRIJ,KPRRKP,                        &
     &       KPMPXI,KPMPXE,KRA   ,KRELV ,KUHAT ,KWORK ,KTMPCR,KU    ,   &
     &       KS0   ,KS1   ,KXTP  ,KPXSXP,KPXDXP,KXUTDT,KRPOLE,KPXPOL,   &
     &       KXDPOL,KOBBUF,KOBSC ,KRESID,KSIGMA,KRATIO,KELEVS,          &
     &       KPMPA ,KPXSLV,KTPRTL,                                      &
     &       KFRQOF,KXYZOF,KFRQST,KFRQSA,KSTDLY,KSADLY,KXYZCG,KSCMRA,   &
     &       KEBVAL,KEBSIG,KEBNAM,KBTWB ,KTBTWA,KBTWD ,KPMPE ,          &
     &       KFSEB1,KFSEB2,KSTAMT,KPXSPA,KDIAGN,KOBOUT,KGRLT1,KGRLT2,   &
     &       KGRLT3,KGRLT4,KGRLT5,KPSTAT,KRSUNS,KCHEMR,KCHMOR,KEPOSR,   &
     &       KCHEMT,KCHMOT,KEPOST,KCHCBS,KCPOSS,KSCRTM,KXSTT ,KXSTR ,   &
     &       KXSS  ,KRANGT,KRANGR,KCHB1 ,KCHB2 ,KCHBV1,KCHBV2,KCHEB ,   &
     &       KSSTFQ,KSSTCC,KSSTSS,KSSTWT,KRLCOR,KWVLBI,KQUINF,KBRTS ,   &
     &       KBRTSV,KLRARC,KXEPBF,KXEPBR,KPRCBD,KPRTBD,KXPMPA,KXL,      &
     &       KXSIG ,KXEDTS,KXALO1,KXALO2,KXYOF2,KDLATF,KDLATS,KDLONF,   &
     &       KDLONS,KPF   ,KPS   ,                                      &
     &       KXOBSV,KXOBSW,KXEDSW,                                      &
     &       KXSIGW,KPSF  ,KDNUM ,KCNUM ,KFCOR ,KCOSAR,KSINAR,KSABIA,   &
     &       KSBTM1,KSBTM2,KYAWBS,KVLOUV,KACMAG,KOBSTR,                 &
     &       KPRL1 ,KPRL2, KRL1  ,KT1SE ,KTCP  ,                        &
     &       KRATDR,KFQT1S,KFQT1E,KT1STR,KFTTSE,KFRSTR,KFRRAT,KSV1  ,   &
     &       KSV2  ,KTSLOV,                                             &
     &       KGLGR1,KGLGR2,KGLFR1,KGLFR2,                               &
     &       KARGR1,KARGR2,KARFR1,KARFR2,                               &
     &       KRDS1L,KFT1AV,KDFQP ,KFREQ1,KFREQ3,KSAVD1,KSAVD2,          &
     &       KANTOU,KFM3CF,KF2CF,KTMG,KLTMG,KX2TIM,KX2OBS,KXRNDX,KX2SCR,&
     &       KALTWV,KXXBM ,KX2PAR,KATIME,KPMPAT,KPMATT,KX2PAT,          &
     &       KPXEXI,KPXEPA,KPV,KPXEP2,KX2COF,KACOF2,KACOF3,KBCOF,KBCOF2,&
     &       KDDDA ,KX2AUX,KX2VPR,KX2VPA,KEXTRA,KVARAY,KATROT,KATPER,   &
     &       KLTAR ,KXHOLD,KANTBL,KPHC  ,KOFDRV,KGNAME,KGRSIZ,KGRCNT,   &
     &       KGRDAT,KACCDT,KCTBTI,KCTBWE,KCTCTM,KANTUV,KANTOR,KW1PU ,   &
     &       KPYSQH,KSIGSP,KXYOF3,KXVTM1,KXDIST,KXDST0,KTMSE ,KDSDP ,   &
     &       KEXCST,KEXCDT,KEXCGX,KEXCGY,KEXCGZ,KIMNDX,KIMOBS,KIMTIM,   &
     &       KIMSAT,KM2VPA,KDCDD ,KDWNWT,KDPOR ,KC2PAR,KBOUNC,KBPART,   &
     &       NXCA04
      COMMON/CORA07/KELEVT,KSRFEL,KTINT,KFSCSD,KXTIM,KFSDM,             &
     & KSGM1,KSGM2,KNOISE,KEPHMS,NXCA07
      COMMON/CORI01/KMJDS0,KMJDSB,KMJDSC,KMJDSV,KIBACK,KIBAKV,KIORDR,   &
     &              KIORDV,KNOSTP,KNOCOR,KNSAT ,KN3   ,KNEQN ,KNEQN3,   &
     &              KNH   ,KNHV  ,KNSTPS,KNSTPV,KICPP ,KICPV ,KICCP ,   &
     &              KICCV ,KICCPV,KICCVV,KISUMX,KIXDDT,KISMPX,KIPXDD,   &
     &              KNMAX ,KNTOLD,KNTOLO,KICNT ,KISNT ,KMM   ,KKK   ,   &
     &              KJJ   ,KHH   ,KIBDY ,KSIGN1,KSIGN2,KLL   ,KQQ   ,   &
     &              KIORFR,KIPDFR,KITACC,KJSAFR,KJSPFR,KMJDEP,KMJDND,   &
     &              KNVSTP,KNSTRN,KNDARK,KTIPPT,KTJBDY,                 &
     &              KICNTA,KISNTA,KISHDP,KIPTC ,KIPTS ,KIGTSR,KIXTMC,   &
     &              KTIPTT,KTNOSD,KTQNDX,KTLL1 ,KTJJBD,KTITDE,KTCNTR,   &
     &              KTNN  ,KITACX,KNMOVE,KPANEL,KPLPTR,KNADAR,KNADSP,   &
     &              KNADDF,KNADEM,KNADTA,KNADTC,KNADTD,KNADTF,KNADTX,   &
     &              KITPMD,KSCATT,KITPAT,KILTPX,KEASBJ,KEANMP,KEANAN,   &
     &              KEAPMP,KEAPAN,KEAMJS,KEAPPP,KEAAAA,KICNTT,KISNTT,   &
     &              KTPGRC,KTPGRS,KTPC  ,KTPS  ,KALCAP,KEMCAP,KNSEG ,   &
     &              KICNTP,KISNTP,KNRDGA,KNRDDR,KNRDSR,KIRDGA,KIRDRG,   &
     &              KIRSLR,KSTRTA,KSTRTD,KSTRTS,KDYNPE,KACCPE,KIBCKN,   &
     &              KNRAT ,KIXDDN,KISMXN,KDXDDN,KDSMXN,KICPPN,KACSID,   &
     &              KNEQNH,KHRFRC,KPTFBS,KPTFSB,KIPXDA,KIACCP,KXSTAT,   &
     &              KPXST ,KSALST,KMAPLG,KNMBUF,KSTEPS,KSGMNT,KSATIN,   &
     &              KMEMST,KNEQNI,KBUFIN,KWEMGA,KWEMDR,KTPATS,KTANMP,   &
     &              KTAPPP,KTAMJS,KTASID,KGPSID,KNSSVA,KPNALB,KBRAX1,   &
     &              KBRAX2,KBRAX3,NXCI01
      COMMON/CORI02/KNTIME,KMJSTB,KMJSTC,KMJSTE,KISECT,                 &
     &              KINDH ,KNMH  ,KIVSAT,KIPXPF,KNTRTM,KMSTRC,          &
     &              KMSTRE,KISCTR,KISATR,KITRUN,KTRTMB,KTRTMC,          &
     &              KMJDVS,KNTMVM,NXCI02
      COMMON/CORI03/KICRD ,KICON ,KISTNO,KINDPI,KMJDPL,KIPOLC,          &
     &              KNDOLA,KIOLPA,KKIOLA,KIP0OL,KNDOLM,KIOLPM,          &
     &              KKIOLM,KIPVOL,KICNL2,KICNH2,                        &
     &              KSTMJD, KNUMST, KITAST, KSTNRD, KICNV,              &
     &              KTIDES,KFODEG,KFOORD,KRDEGR,KRORDR,                 &
     &              KPHINC,KDOODS,KOTFLG,KJDN  ,KPTDN ,                 &
     &              KATIND,KPRESP,KMP2RS,KSITE,KPTOLS,NXCI03
      COMMON/CORI04/KNMP  ,KINDP ,KNDPAR,KNPVCT,KISATN,KISET ,KIANTO,   &
     &              KISATO,KIANTD,KISATD,KISTAD,KISATC,KMJDCG,KISTAT,   &
     &              KMJDEB,KMJDBN,KNDBIN,KNWTDB,KIXPAR,KNDBUF,KSSTNM,   &
     &              KSSTNA,KMBSAT,KMBSTA,KXKEY ,KXVKEY,KXFLAG,KIPNTF,   &
     &              KIPNTS,KNCON ,KKF   ,KIDATB,KNSTLV,KSLVID,KLLBIA,   &
     &              KTMRA1,KTMRA2,KIND1 ,KTARID,KATARD,KYAWID,KXOBLK,   &
     &              KDSCWV,KATRSQ,KATSAT,KKVLAS,KPARTP,KLTMSC,KLTASC,   &
     &              KCTBST,KSTBST,KANCUT,KANGPS,KANTYP,                 &
     &              KANTOF,                                             &
     &              KYSAT, KMBDEG,                                      &
     &              KMBNOD,KMBSST,KBSPLN,KSSPLN,KXIOBS,KIDLAS,KIAVP ,   &
     &              KXNAVP,KNEXCG,KIDEXC,KNREXC,KTELEO,KIKEY ,KIMKEY,   &
     &              KIMBLK,KIMPRT,KCN110,KCN111,KC110,KC111,KTDSAT,     &
     &              KTDANT,NXCI04
      COMMON/CORI07/KSMSA1,KSMSA2,KSMSA3,KSMST1,KSMST2,KSMST3,KSMTYP,   &
     &              KSMT1,KSMT2,KMSDM,KIOUT,KISUPE,NXCI07
      COMMON/CORL07/KLPTS,NXCL07
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/SIMLM/OBSINT,VINT,ELCUTO,XSMLM
      COMMON/SIMPAR/MAXCON,NCON,MXLEN,NSDLEN,NSDLER,NPATRN,ISTATS,      &
     &              NXSIML
      COMMON/CTSIMA/FSCSIM
      COMMON/CTSIMI/MJDSIM,MJDEND
      COMMON/CVIEW /IOUT6 ,ILINE6,IPAGE6,MLINE6,                        &
     &              IOUT8 ,ILINE8,IPAGE8,MLINE8,                        &
     &              IOUT9 ,ILINE9,IPAGE9,MLINE9,                        &
     &              IOUT10,ILIN10,IPAG10,MLIN10,                        &
     &              IOUT15,ILIN15,IPAG15,MLIN15,                        &
     &              IOUT16,ILIN16,IPAG16,MLIN16,                        &
     &              IOUT7 ,NXCVUE
      COMMON/IBODPT/IBDCF(999),IBDSF(999),IBDGM(999),IBDAE(999),    &
     &              IBDPF(999),                                     &
     &              ICBDCF,ICBDSF,ICBDGM,ICBDAE,ICBDPF,             &
     &              ITBDCF,ITBDSF,ITBDGM,ITBDAE,ITBDPF,NXBDPT
      COMMON/IOBTYP/NDXST(2,35),NDXSAT(2,35),                           &
     &      NDRSTA(50),NDRSAT(50),NDRST2(50),NDRSA2(50),                &
     &      ITMBIT(999),IOETR(999),MTYPED(11),NTYPES,                   &
     &      NM0112(4),NM1314(4),NM1522(4),NM2330(4),                    &
     &      NM3138(4),NM3997(4),NM4098(4),NM9900(4),NMT199(4),NMT203(4),&
     &      NS0112(4),NS1314(4),NS1522(4),NS2330(4),                    &
     &      NS3138(4),NS3997(4),NS4098(4),NS9900(4),NST199(4),NST203(4),&
     &      ITYPD(12,2),ITYPDD(7,2),ILINKF(5),ISTAFN(5,3),              &
     &      ISATFN(5,3),ILINKT(5),ISTATN(5,3),ISATTN(5,3),              &
     &      MGOTO(12),MENTER(12),MEXIT(12),                             &
     &      NDST60(3,24),NDST82(6,12),NDST92(12,7),NTDRSS,              &
     &      NDSA60(3,24),NDSA82(6,12),NDSA92(12,7),                     &
     &      MTDRSS(7),KTDRSS(7),ITDRSS(4,7),JTDRSS(4,7),                &
     &      NLLC60(5,24),NLLC82(10,12),NLLC98(20,7),NNBIA,              &
     &      NXMTYP
      COMMON/IEPHM2/ISUPL,ICBODY,ISEQB(2),MAXDEG,ITOTSE,IREPL(988), &
     &              NXEPH2
      COMMON/LEPHM2/LXEPHM
!
      DIMENSION AA(1),II(1),LL(1),NSAT1(MXLEN),NSAT2(MXLEN),NSAT3(MXLEN)&
     &          ,NSTA1(MXLEN),NSTA2(MXLEN),NSTA3(MXLEN),NTYP(MXLEN),    &
     &          MJDS1(MXLEN),MJDS2(MXLEN),FSECSM(MXLEN),CUTANG(MXLEN),  &
     &          SRFELV(MXLEN),OBTINT(MXLEN),XTIME(MXLEN),SMSD1(MXLEN),  &
     &          SMSD2(MXLEN),RNOISE(1)
      DIMENSION LPTS(MINTIM),MJDSDM(MINTIM),FSCSDM(MINTIM)
      DIMENSION INDSTA(3,4),INDSAT(3,4),INDSET(3,4),                    &
     &   LELEVS(3,4),INPSTA(3,4),INPSAT(3,4),                           &
     &   ILCORR(5,4)
      DIMENSION RNUM(1)
!
      DATA XLARGE/99999999999999.D0/
!*********************************************************************
! START OF EXECUTABLE CODE
!*********************************************************************
!
! SET LNOISE FALSE
!
      LNOISE=.FALSE.
!
! SET  LPTS TRUE
!
      DO 98 I=1,MINTIM
      LPTS(I)=.TRUE.
   98 END DO
!
! MINTIM IS DETERMINED IN G2S AS THE MAXMUM NUMBER OF OBSERVATIONS
! AN INTERNAL BLOCK CAN HAVE FOR THIS ARC. IT TAKES THE VALUE OF
! MOBSBK OF COMMON/BINBUF/ UNLESS IT IT OVERRIDEN BY A STEP CARD.
! IN THIS CASE MINTIM IS 500
!
      DO 1001 I=1,MINTIM
      MJDSDM(I)=0
      FSCSDM(I)=0.D0
 1001 END DO
!
! LFND=.TRUE. MEANS THE POTENTIAL PSEUDO-BLOCK HAS BEEN ACCEPTED
      LFND=.FALSE.
! LALL=.TRUE. MEANS THE ENTIRE BLOCK HAS BEEN ACCEPTED
      LALL=.FALSE.
!
! DETERMINE START TIMES FOR ALL REQUESTED TIME INTERVALS FOR WHICH
! SIMULATED DATA ARE TO BE GENERATED.
!
      DO 10 I=1,MXLEN
      XTIME(I)=DBLE(MJDS1(I))+FSECSM(I)
   10 END DO
      CALL EARLY(XTIME,MXLEN,XLARGE,IEARLY)
!
      MJDSIM=XTIME(IEARLY)
      SIGLV1=SMSD1(IEARLY)
      SIGLV2=SMSD2(IEARLY)
      IF(SIGLV1.GT.0.D0)LNOISE=.TRUE.
!     WRITE(IOUT6,99444)MJDSIM,MJDS1(IEARLY),MJDS2(IEARLY),SIGLV1
!9444 FORMAT(2X,'SIMGEN MJDSIM',3I13,F5.2)
      MJDEND=MJDS2(IEARLY)
      IF(MJDSIM.LT.MJDEND)GOTO 11
      XTIME(IEARLY)=XTIME(IEARLY)+60.D0
      MJDS1(IEARLY)=MJDS1(IEARLY)+60
      MJDSIM=MJDSIM+60
      RETURN
   11 CONTINUE
      FSCSIM=FSECSM(IEARLY)
! CALCULATE THE NUMBER OF POINTS FOR WHICH VISIBILITY CHECKING IS
! REQUIRED WITHIN THE BLOCK
      IVINT=VINT
      NPTS=NXTIMB/VINT
      NPTS=NPTS+1
!
      DTIME=DBLE(MJDEND-MJDSIM)
      NPTTM=(DTIME+0.1)/VINT
      IF(NPTS.GT.MINTIM)THEN
       IF(NPTTM.GT.MINTIM)THEN
      NPTS=MINTIM
       ELSE
      NPTS=NPTTM
       ENDIF
       ELSE
       IF(NPTTM.LT.NPTS)NPTS=NPTTM
       ENDIF
!
      DO 2001 N=1,NPTS
      N1=N-1
! FSCSDM CONTAINS THE FRACTIONAL SECONDS OF MEASUREMENT TIMES
      FSCSDM(N)=FSECSM(IEARLY)+DBLE(N1)*VINT
! FSECSM ARE THE FRACTIONAL SECONDS OF THE OBSERVATION BLOCK
! START TIMES
 2001 END DO
      FSELAP=DBLE(N1)*VINT
!
! EVALUATE EVENT TIMES AND THE START TIME OF THE NEXT POTENTIAL
! PSEUDO-BLOCK WHICH BELONGS TO THE SAME PASS AS THE PRESENT
!
      MJDSDM(1)=MJDS1(IEARLY)
! IDSEC IS THE INTEGER PART OF THE OBSERVATION TIME INTERVAL
      IDSEC=VINT
! ISEC IS THE INTEGER NUMBER OF SECONDS ELAPSED UNTIL THE BEGINNING
! OF THE NEXT POTENTIAL PSEUDO-BLOCK
      ISEC=NPTS*IDSEC
      DO 2003 I=1,NPTS
!
      FSENXT=FSCSIM+I*VINT
      ISECTN=FSENXT
!
      JJJ=I+1
!     FSCSDM(JJJ)=FSENXT-DFLOAT(ISECTN)
      MJDSDM(JJJ)=MJDSIM+ISECTN
 2003 END DO
!
! MJDSDM AND FSCSDM CONTAIN THE TIMES IN MJD SECONDS AND THE FRACTIONAL
! SECONDS FOR THE EVENT TIMES OF THE PRESENT BLOCK
!
      FSENXT=FSCSDM(JJJ)
      MJDNXT=MJDSDM(JJJ)
!
! AT THIS POINT CALL SIMREC TO CREATE A DUMMY DIRECTORY RECORD AND
! A DUMMY OBSERVATION RECORD FOR THE PRESENT BLOCK
!
! MOBBUF IS THE NUMBER OF WORDS IN THE DATA RECORD (MOBBUF IN 2S)
      IF(ICBDGM.EQ.ITBDGM) GOTO 2004
      CALL COEFF(MJDSDM(1),FSCSDM(1),FSCSDM(NPTS),AA)
      CALL LITPRX(MJDSDM(1),ZERO,MJDSST,FSECST,AA,II)
            TIMEBL=DBLE(MJDSDM(1))+FSCSDM(1)
            TIME=DBLE(MJDSST)+FSECST+FSCSDM(1)
            RLTCOR=TIMEBL-TIME
              IF(LXEPHM) THEN
              CALL COEFFX(MJDSDM(1),FSCSDM(1),FSCSDM(NPTS),AA,II,       &
     &                    II(KISUPE),AA(KEPHMS))
              ENDIF
 2004 CONTINUE
      CALL SIMREC(MOBBUF,AA(KOBBUF),NSAT1(IEARLY),NSAT2(IEARLY),        &
     &            NSAT3(IEARLY),                                        &
     &            NSTA1(IEARLY),NSTA2(IEARLY),NSTA3(IEARLY),            &
     &            NTYP(IEARLY),MJDS1(IEARLY),MJDS2(IEARLY),             &
     &            FSECSM(IEARLY),IEARLY,NPTS,FSELAP,FSCSDM,             &
     &            INDSAT,INDSTA,INDSET,INPSTA,INPSAT,LELEVS,AA,II,LL,   &
     &            ILCORR)
      IF(LACC.AND.LNOISE) THEN
! NOISE
! AT THIS POINT CALL URAND TO GENERATE NPTS RANDOM NUMBERS
! MULTIPLY THEM BY SIGLV1 AND LOAD THEM INTO RNOISE(I)
!
      IY = MJDSIM
! CALL IMSL RANDOM # SEED GENERATOR
      DO 10101 I=1,NPTS
! RNOR and RAN are system subroutines for random number generation,
! currently not used.
!CRAY\      Z=RNOR(IY)
!CHP\      Z=RAN(IY)
!     RNOISE(I)=(Z-0.5D0)*SIGLV1
! URAND is a GEODYN II subroutine for random number generation and
! GAUSS is a GEODYN II subroutine for gaussian distribution.
      RNUM(1)=URAND(IY)
      ONOISE=0.D0
      CALL GAUSS(RNUM(1),ONOISE)
      RNOISE(I)=ONOISE*SIGLV1
!     WRITE(6,91919)RNOISE(I),I
!91919 FORMAT(2X,'SIMGEN OBSERVATION NOISE',F10.5,I5)
10101 END DO
      ENDIF
!
      CALL OBSGEN(AA,II,LL,INDSTA,INDSAT,INDSET,INPSTA,INPSAT,LELEVS,   &
     &            ILCORR)
      IF(NTYP(IEARLY).EQ.99.AND..NOT.LACC)GOTO 40
      IF(NTYP(IEARLY).EQ.199.AND..NOT.LACC)GOTO 40
      IF(LACC) GOTO 41
!
      IREC=0
      DO 544 I=1,NPTS
      IF(LPTS(I))IREC=IREC+1
  544 END DO
      IF(IREC.GT.0)LFND=.TRUE.
      IF(IREC.EQ.NPTS)LALL=.TRUE.
      IF(.NOT.LFND) GOTO 30
      IF (LALL) GOTO 40
      IACC=1
      DO 546 I=1,NPTS
      IF(.NOT.LPTS(I))GOTO 546
! SHOULD SUBTRACT THE INTEGER SECONDS FROM FSCSDM
      FSCSDM(IACC)=FSCSDM(I)
      IACC=IACC+1
  546 END DO
      NPTS=IREC
      JJ=IACC
      DO 567 I=JJ,MINTIM
      FSCSDM(I)=0.D0
  567 END DO
      N2=NPTS-1
      FSELAP=DBLE(N2)*VINT
! AT THIS POINT REEVALUATE MJDS1(IEARLY),MJDS2(IEARLY)
! SEE PREVIOUS COMMENT
      IFSEC1=FSCSDM(1)
      MJDS1(IEARLY)=MJDS1(IEARLY)+IFSEC1
      DO 568 I=1,NPTS
      FSCSDM(I)=FSCSDM(I)-DBLE(IFSEC1)
  568 END DO
      IFSEC2=FSCSDM(NPTS)
      MJDEND=MJDS2(IEARLY)
      MJDS2C=MJDS1(IEARLY)+IFSEC2
      IF(MJDS2C.GE.MJDEND)MJDS2C=MJDEND
!     WRITE(IOUT6,12346)MJDS1(IEARLY),MJDS2(IEARLY)
!     WRITE(IOUT6,12346)MJDSIM,MJDEND
!2346 FORMAT('  SIMGEN BEGIN AND END TIMES',I10,2X,I10)
!     WRITE(IOUT6,82299)
!2299 FORMAT('  PART OF THE BLOCK HAS BEEN ACCEPTED')
!     GOTO 40
      KNTBLK=KNTBLK+1
!
      LACC=.TRUE.
      GOTO 2004
!
   40 CONTINUE
! PSEUDO-BLOCK PARTIALLY OR TOTALLY ACCEPTED
! INCREASE THE NUMBER OF BLOCKS BY ONE
      KNTBLK=KNTBLK+1
      LACC=.TRUE.
!     WRITE(IOUT6,11224)
!11224 FORMAT(2X,'AT THIS POINT THE PSEUDO BLOCK HAS BEEN ACCEPTED,
!    . NEVERTHELESS REJECT IT AND CHECK THE NEXT ONE')
!     WRITE(IOUT6,11224)
!11224 FORMAT(2X,'AT THIS POINT THE PSEUDO BLOCK HAS BEEN ACCEPTED')
      GOTO 2004
!     GOTO 41
!
! THE POTENTIAL PSEUDO-BLOCK HAS BEEN REJECTED
   30 CONTINUE
!     WRITE(IOUT6,36677)
!6677 FORMAT('  THE BLOCK HAS BEEN REJECTED')
   41 CONTINUE
!11225 STOP
      MJDS1(IEARLY)=MJDNXT
      FSECSM(IEARLY)=FSENXT
      XTIME(IEARLY)=DBLE(MJDS1(IEARLY))+FSECSM(IEARLY)
!     DO 1822 I=1,MXLEN
!     WRITE(IOUT6,18222)MJDS1(I),MJDS2(I)
!822  CONTINUE
!8222 FORMAT(2X,'MJDS1(I),MJDS2(I),I',3I20)
!     WRITE(IOUT6,88223)MJDS1(IEARLY),FSECSM(IEARLY),XTIME(IEARLY),
!    .IEARLY
!8223 FORMAT(2X,'MJDS1 FSECSM XTIME IEARLY',I15,2F20.8,I10)
      CALL EARLY(XTIME,MXLEN,XLARGE,IEARLY)
      MJDSIM=MJDS1(IEARLY)
      FSCSIM=FSECSM(IEARLY)
!     WRITE(IOUT6,88224)MJDSIM,FSCSIM
!8224 FORMAT(2X,'MJDSIM,FSCSIM',I15,F20.8)
!     WRITE(IOUT6,88222)MJDSIM
!8222 FORMAT(2X,'RETURNING TO EXEC2E AFTER HAVING REJECTED A BLOCK',
!    .I20,'IS MJDSIM')
!
      RETURN
      END
