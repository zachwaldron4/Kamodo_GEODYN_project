      SUBROUTINE SMPRT3(PMPP,ATPA,SCRTCH)
!********1*********2*********3*********4*********5*********6*********7**
! SMPRT3                                         PGMR - D. ROWLANDS
!
!
! FUNCTION:  CONTROLS THE WRITING OF ONE EMATRIX MEMORY PARTITION
!            THIS IS DONE IN A EAY TO EXPLOIT PARALLEL PROCESSING
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   PMPP     I    A    ARRAY USED TO HOLD PARTIAL DERIVATIVES AND
!                      WEIGHTS READ FROM SCRATCH FILE
!   ATPA     I    A    ARRAY USED TO HOLD EMAT MEMORY PARTITOIN
!   SCRTCH   I    A    SCRATCH ARRAY
!
! COMMENTS:  THIS ROUTINE EXPLOITS PARALLEL PROCEESING BY SENDING
!            EACH CALL TO SUMWR2 TO A SEPARATE PROCESSOR. THIS
!            REQUIRES MACHINE DEPENDENT COMPILER DIRECTIVES
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      COMMON/CESTIM/MPARM,MAPARM,MAXDIM,MAXFMG,ICLINK,IPROCS,NXCEST
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/CPARTI/MAXLP ,KORSIZ,MAXWRK,                               &
     &              IUNTP1,IUNTP2,IUNTPF,ISIZPF,IRECPF,NRECPF,          &
     &              NPDONE,NP1   ,NP2   ,NRECND,NPDIM ,NXPARI
      COMMON/PARPRC/NPROCS,NPROCI(5,10)
      DIMENSION PMPP(MAPARM),ATPA(1),SCRTCH(MAPARM,NPROCS)
      DIMENSION IL(10),ISROW(10),IQPS(10),IQPSS(10)
      DIMENSION IOBSX(10),IX(10),IIX(10)
!
! ACTUALL TOTAL LENGTH OF PMPP ARARY
      NLPMPP=MAPARM*MINTIM
      N11=MAPARM-NP1+2
      NOBSF=NLPMPP/N11
      N1=N11-1
      NOBSF1=NOBSF+1
   10 CONTINUE
      CALL LDPMPP(NPDIM,N1,NOBSF,SCRTCH,PMPP(1),PMPP(NOBSF1),NOBS)
      IF(NOBS.LE.0) RETURN
!MIC$ PARALLEL SHARED (PMPP,N1,NOBS,ATPA,SCRTCH,NPROCI)
!MIC$*         SHARED (IL,ISROW,IOBSX,IX,IIX)
!MIC$*         SHARED (NPROCS,NOBSF1)
!MIC$*         SHARED (IQPS,IQPSS)
!MIC$*         PRIVATE (IPROC)
!MIC$ DO PARALLEL
      DO 1000 IPROC=1,NPROCS
      CALL SUMRW2(PMPP(NOBSF1),PMPP,NOBS,N1,ATPA,                       &
     &            SCRTCH(1,IPROC),NPROCI(1,IPROC),                      &
     &            NPROCI(2,IPROC),NPROCI(3,IPROC),                      &
     &            NPROCI(4,IPROC),IPROC,IL(IPROC),                      &
     &            ISROW(IPROC),IOBSX(IPROC),IQPS(IPROC),                &
     &            IQPSS(IPROC),IX(IPROC),IIX(IPROC))
 1000 END DO
!MIC$ END DO
!MIC$ END PARALLEL
      IF(NOBS.LT.NOBSF) RETURN
      GO TO 10
      END
