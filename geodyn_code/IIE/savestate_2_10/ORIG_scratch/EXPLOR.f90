!$EXPLOR
      SUBROUTINE EXPLOR(VMAT,NEQN,PXDDOT,CORPAR,VRARAY,ANGWT,WT,PPER,   &
     &                  IBOD)
!********1*********2*********3*********4*********5*********6*********7**
! EXPLOR             93/06/22            9305.0    PGMR - D. ROWLANDS
!
!
! FUNCTION:  GET EXPLCIT PARTIALS OF ACCELERATION WRT PLANET
!            ORIENTATION PARAMETERS.
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   VMAT     I         MATRIX OF PARTIALS OF BODY FIXED CARTESIAN
!                      GRAVITY ACCELERATIONS WRT BODY FIXED CARTESIAN
!                      COORDINATES
!   NEQN     I         NUMBER OF FORCE MODEL EQUATIONS
!   PXDDOT   O         EXPLICIT PARTIALS OF ACCELERATION
!   CORPAR   I         MATRIX OF PARTIALS OF R,PSI,LAMDA
!                      WRT XYZ
!   VRARAY   I         (1-3)=ACCELERATIONS DUE TO
!                        GEOPOTENTIAL IN R,PPSI,LAMDA
!                      (4-8)=R,RSQ,XYSQ,RTXYSQ,GM/R
!                      (9-14)=BODY FIXED STATE VECTOR
!   ANGWT    O   A     ARRAY OF FREQUENCIES FOR PLANETARY ROTATION
!   WT       O   A     ARRAY OF ANGLES WT
!   PPER     I   A     ARRAY OF PERIODS
!   IBOD     I   S     INDICATES WHETHER THIS CAKK IS BEING MADE
!                      FOR CENTRAL BODY EFFECT OR FOR SECONDARY
!                      ASTEROID EFFECT IN A BINARU ASTEROID SYSTEM
!
! COMMENTS: THIS CODE ASSUMES PLANET ORIENTATION PARAMETERS ARE THE
!           LAST FORCE MODEL PARTIALS (IN EMATY ORDER)
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
      COMMON/ARCPAR/MAXSEL,NSEL,MAXDEL,NDEL,MAXMET,NMETDT,NSATID,       &
     &              IATDEN,ISATEQ,ITRMAX,ITRMIN,ITRMX2,                 &
     &              MJDSRF,MREFSY,NTDDR,NBTOTL,IDRAGM,IMRNUT,           &
     &              NXARCP
      COMMON/ARCPR /FSECRF,XARCPR
      COMMON/CONSTR/PI,TWOPI,DEGRAD,SECRAD,SECDAY
      COMMON/CREFMT/REFMT(9)
      COMMON/CRMB/RMB(9), rmb0(9)
      COMMON/CRMI/RMI(9)
      COMMON/CRM5OE/RM5OE(9)
      COMMON/DPLNOR/DXGEO1,DXGEO2,DXFRC1,DXFRC2,XPLNOR
      COMMON/EXPGRV/DGRV(3,4,2)
      COMMON/LASTER/LASTR(2),LBINAST,NXASTR
      COMMON/LDUAL/LASTSN,LSTSNX,LSTSNY
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      COMMON/REFDRV/DREFDA(9),DREFDB(9),DR3TDW(9),RDATR(9),RDBTR(9),    &
     &              DDA(9,2,50),DDB(9,2,50),DDR(9,50)
      COMMON/SETAPT/                                                    &
     &       JSADRG(1),JSASRD(1),JSAGA(1),JFAADJ,JTHDRG,JACBIA,JATITD,  &
     &       JDSTAT,JDTUM ,                                             &
     &       JSACS, JSATID,JSALG,JSAGM,JSAKF,JSAXYP,JSADJ2,JSAPGM,      &
     &       JFGADJ,JLTPMU,JLTPAL,JL2CCO,JL2SCO,JL2GM,JLRELT,           &
     &       JLJ2SN,JLGMSN,JLPLFM,JL2AE,JSAXTO,JSABRN
      COMMON/STARTT/ESSTRT,FSSTRT
      COMMON/STPTHG/COSSTG,SINSTG
      COMMON/XTRAOR/T0XTRO,T0XTRO2,CVENUS,CLIBMN,CMARS,CMERC,XXTRAO
      COMMON/XPCNT /NXTRAC,NXFLAG,NXALLC,NCPPER,NMINRT,NDPOR,NXXTRA
      COMMON/XPCNT2/NXTRAC2,NXFLAG2,NXALLC2,NCPPER2,NMINRT2,NDPOR2,     &
     &              NXXTR2
!... Begin TJS...
      COMMON/AXIS/LINTAX
! NEW NAMED COMMON BLOCK "PORINF" (found also in EXPLOR and STARTD)
! introduce new named common block for planetary orientation information in
! order to get current omega and R states (PLOR(1:12)), current partials of
! omega and R with respect to omega_0 and R_0 (PLOR(13:156)), partials of
! omega and R with respect to six independent moments of inertia
! (PLOR(157:228)), and partials of omega_0 and R_0 with respect to RA_0,
! DEC_0, W_0, RA_t_0, DEC_t_0, and W_t_0 (DO0DA0)
      COMMON/PORINF/PLOR(228,2),DO0DA0(12,6,2)
!... End TJS...

      DIMENSION PXDDOT(NEQN,3),CORPAR(9),VRARAY(14),VMAT(3,3)
      DIMENSION DRM5DA(9),DRM5DB(9),DRMBDA(9),DRMBDB(9),DRMBDW(9)
      DIMENSION R3THG(9),R3THDW(9),SCR1(9),SCR2(9),SCR3(9)
      DIMENSION XDDBF(3),XTR(3),DXBFDA(3,2),DXBFDB(3,2),DXBFDW(3)
      DIMENSION DBFADA(3,2),DBFADB(3,2),DBFADW(3)
      DIMENSION EXDA1(3),EXDB1(3),EXDW1(3)
      DIMENSION EXDA2(3),EXDB2(3),EXDW2(3)
      DIMENSION ANGWT(1),WT(1),PPER(1)
      DIMENSION DRMDAD(9),DRMDBD(9)
      DIMENSION EXDAD1(3),EXDBD1(3)
      DIMENSION EXDAD2(3),EXDBD2(3)
!... Begin TJS...
      DIMENSION DADO(3,12),PXDDO(3,12),PXDDO0(3,12)
!... End TJS...
      DATA ZERO/0.D0/,ONE/1.D0/
!
!
      IXALLC=NXALLC
      ISTART=JSAXTO
      IF(LBINAST.AND.IBOD.EQ.2) THEN
         IXALLC=NXALLC2
         ISTART=ISTART+7+NXALLC*3
         IF(LINTAX) ISTART=ISTART+6
      ENDIF
!
!
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!
! THE SECTION OF COMMENTED OUT CODE BELOW (UNTIL NEXT STRING OF %)
! IS THE WAY INDEXING INTO THE PXDDOT ARRAY WAS RECKONED THROUGH
! VERSION 1802. IN THAT SCHEME THE END OF THE PLANETARY ORIENTATION
! WAS FOUND. IN THAT SCHEME THE INDEXING NEEDED TO CHANGE EVERY TIME
! A NEW FOURCE MODEL GROUP IS ADDED AT THE END OF PARAMETERS.
! THE NEW SCHEME GETS THE START OF THE PLANETARY ORIENTATION
! FROM THE SETAPT COMMON BLOCK WHICH IS LOADED
! IN ROUTINES INITA, COWLIN AND ORBIT
!
!
! UNTIL SOME MORE WORK IS DONE IX2CCO, IX2SCO AND IX2GM ARE NOT OFFICIAL  FORC E
! SO UNTIL THESE ARE MADE FORCE MODEL PARAMETERS THIS IS WHAT NEBD LOOKS LIKE:
!!!   NEND=NPVAL0(IXFGFM)
!!!! WHEN IX2CCO, IX2SCO AND IX2GM  BECOME OFFICIAL FORCE MODEL PARAMETERS:
!      NEND=NPVAL0(IXFGFM)+NPVAL0(IX2CCO)+NPVAL0(IX2SCO)+NPVAL0(IX2GM)
!      NNEQN=NEQN-NEND
!      IF(LBINAST.AND.IBOD.EQ.1) THEN
!        IF(LINTAX) THEN
!          NNEQN=NNEQN-NPVAL0(IXXTRO)/2
!        ELSE
! WHEN IN ANALYTICAL MOD FOR BINARY ASTEROID THERE ARE 6 MOMENTS AT END OF 2ND A
!          NNEQN=NNEQN-(NPVAL0(IXXTRO)-6)/2-6
!        ENDIF
!      ENDIF
!      IF(LBINAST.AND.IBOD.EQ.2.AND..NOT.LINTAX) THEN
! WHEN IN ANALYTICAL MOD FOR BINARY ASTEROID THERE ARE 6 MOMENTS AT END OF 2ND A
!          NNEQN=NNEQN-6
!      ENDIF
!%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
!
!
!
!
!
!
      DT21=FSSTRT+(ESSTRT-DBLE(MJDSRF)-FSECRF)
      SCAL=ESSTRT+FSSTRT-T0XTRO
      SCALSQ=SCAL**2.D0
!
!
!
!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      GO TO 19
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
!
!
!
      HOLDV1=VMAT(1,2)
      HOLDV2=VMAT(1,3)
      HOLDV3=VMAT(2,3)
      VMAT(1,2)=VMAT(2,1)
      VMAT(1,3)=VMAT(3,1)
      VMAT(2,3)=VMAT(3,2)
!
!  BODY FIXED CARTESIAN COORDIATES, BFX, ARE OBTAINED FROM TRUE OF REF
!  INETRIAL, TRX, VIA   BFX=RMB*TRX
!
!  RMB=R3THG*RM5OE*REFMT = R3THG*RMI
!  RMI=RM5OE*REFMT
!
!
! GET DRMBDA = R3THG*(RM5OE*DREFDA+DRM5DA*REFMT)
!
      COSA=RM5OE(4)
      SINA=-RM5OE(1)
      COSB=RM5OE(8)
      SINB=RM5OE(9)
!
      R3THG(1)=COSSTG
      R3THG(2)=-SINSTG
      R3THG(3)=ZERO
      R3THG(4)=SINSTG
      R3THG(5)=COSSTG
      R3THG(6)=ZERO
      R3THG(7)=ZERO
      R3THG(8)=ZERO
      R3THG(9)=ONE
!
      DRM5DA(1)=-COSA
      DRM5DA(4)=-SINA
      DRM5DA(7)=ZERO
      DRM5DA(2)=SINA*SINB
      DRM5DA(5)=-COSA*SINB
      DRM5DA(8)=ZERO
      DRM5DA(3)=-SINA*COSB
      DRM5DA(6)=COSA*COSB
      DRM5DA(9)=ZERO

!
      CALL MATM(RM5OE,DREFDA,SCR1)
      CALL MATM(DRM5DA,REFMT,SCR2)
      CALL MATA(SCR1,SCR2,SCR3)
      CALL MATM(R3THG,SCR3,DRMBDA)
      CALL MATM(R3THG,SCR1,SCR2)
      DO IQP=1,9
        DRMDAD(IQP)=SCAL*DRMBDA(IQP)-DT21*SCR2(IQP)
      ENDDO
!
! GET DRMBDB = R3THG*(RM5OE*DREFDB+DRM5DB*REFMT)
!
      DRM5DB(1)=ZERO
      DRM5DB(4)=ZERO
      DRM5DB(7)=ZERO
      DRM5DB(2)=-COSA*COSB
      DRM5DB(5)=-SINA*COSB
      DRM5DB(8)=-SINB
      DRM5DB(3)=-COSA*SINB
      DRM5DB(6)=-SINA*SINB
      DRM5DB(9)=COSB
!
      CALL MATM(RM5OE,DREFDB,SCR1)
      CALL MATM(DRM5DB,REFMT,SCR2)
      CALL MATA(SCR1,SCR2,SCR3)
      CALL MATM(R3THG,SCR3,DRMBDB)
      CALL MATM(R3THG,SCR1,SCR2)
      DO IQP=1,9
        DRMDBD(IQP)=SCAL*DRMBDB(IQP)-DT21*SCR2(IQP)
      ENDDO
!
! GET CRMBDW = R3THDW*RMI
!
      R3THDW(1)=-SINSTG
      R3THDW(2)=-COSSTG
      R3THDW(3)=ZERO
      R3THDW(4)=COSSTG
      R3THDW(5)=-SINSTG
      R3THDW(6)=ZERO
      R3THDW(7)=ZERO
      R3THDW(8)=ZERO
      R3THDW(9)=ZERO
!
      CALL MATM(R3THDW,RMI,DRMBDW)
!
! GET TRUE OF REF POS OF SATELLITE
!
      XTR(1)=RMB(1)*VRARAY(9)+RMB(2)*VRARAY(10)+RMB(3)*VRARAY(11)
      XTR(2)=RMB(4)*VRARAY(9)+RMB(5)*VRARAY(10)+RMB(6)*VRARAY(11)
      XTR(3)=RMB(7)*VRARAY(9)+RMB(8)*VRARAY(10)+RMB(9)*VRARAY(11)
!
! GET BODY FIXED CARTESIAN ACCEL OF SATELLITE
!
      XDDBF(1)=CORPAR(1)*VRARAY(1)+CORPAR(2)*VRARAY(2)                  &
     &        +CORPAR(3)*VRARAY(3)
      XDDBF(2)=CORPAR(4)*VRARAY(1)+CORPAR(5)*VRARAY(2)                  &
     &        +CORPAR(6)*VRARAY(3)
      XDDBF(3)=CORPAR(7)*VRARAY(1)+CORPAR(8)*VRARAY(2)                  &
     &        +CORPAR(9)*VRARAY(3)
!
! GET  PARTIALS OF BODY FIXED POSITION WRT A,B,W
!
      DXBFDA(1,1)=DRMBDA(1)*XTR(1)+DRMBDA(4)*XTR(2)+DRMBDA(7)*XTR(3)
      DXBFDA(2,1)=DRMBDA(2)*XTR(1)+DRMBDA(5)*XTR(2)+DRMBDA(8)*XTR(3)
      DXBFDA(3,1)=DRMBDA(3)*XTR(1)+DRMBDA(6)*XTR(2)+DRMBDA(9)*XTR(3)
      DXBFDA(1,2)=DRMDAD(1)*XTR(1)+DRMDAD(4)*XTR(2)+DRMDAD(7)*XTR(3)
      DXBFDA(2,2)=DRMDAD(2)*XTR(1)+DRMDAD(5)*XTR(2)+DRMDAD(8)*XTR(3)
      DXBFDA(3,2)=DRMDAD(3)*XTR(1)+DRMDAD(6)*XTR(2)+DRMDAD(9)*XTR(3)
!
      DXBFDB(1,1)=DRMBDB(1)*XTR(1)+DRMBDB(4)*XTR(2)+DRMBDB(7)*XTR(3)
      DXBFDB(2,1)=DRMBDB(2)*XTR(1)+DRMBDB(5)*XTR(2)+DRMBDB(8)*XTR(3)
      DXBFDB(3,1)=DRMBDB(3)*XTR(1)+DRMBDB(6)*XTR(2)+DRMBDB(9)*XTR(3)
      DXBFDB(1,2)=DRMDBD(1)*XTR(1)+DRMDBD(4)*XTR(2)+DRMDBD(7)*XTR(3)
      DXBFDB(2,2)=DRMDBD(2)*XTR(1)+DRMDBD(5)*XTR(2)+DRMDBD(8)*XTR(3)
      DXBFDB(3,2)=DRMDBD(3)*XTR(1)+DRMDBD(6)*XTR(2)+DRMDBD(9)*XTR(3)
!
      DXBFDW(1)=DRMBDW(1)*XTR(1)+DRMBDW(4)*XTR(2)+DRMBDW(7)*XTR(3)
      DXBFDW(2)=DRMBDW(2)*XTR(1)+DRMBDW(5)*XTR(2)+DRMBDW(8)*XTR(3)
      DXBFDW(3)=DRMBDW(3)*XTR(1)+DRMBDW(6)*XTR(2)+DRMBDW(9)*XTR(3)
!
! GET  PARTIALS OF BODY FIXED ACCEL WRT A,B,W
!
      DO IQP=1,2
      DBFADA(1,IQP)=VMAT(1,1)*DXBFDA(1,IQP)+VMAT(1,2)*DXBFDA(2,IQP)     &
     &             +VMAT(1,3)*DXBFDA(3,IQP)
      DBFADA(2,IQP)=VMAT(2,1)*DXBFDA(1,IQP)+VMAT(2,2)*DXBFDA(2,IQP)     &
     &             +VMAT(2,3)*DXBFDA(3,IQP)
      DBFADA(3,IQP)=VMAT(3,1)*DXBFDA(1,IQP)+VMAT(3,2)*DXBFDA(2,IQP)     &
     &             +VMAT(3,3)*DXBFDA(3,IQP)
!
      DBFADB(1,IQP)=VMAT(1,1)*DXBFDB(1,IQP)+VMAT(1,2)*DXBFDB(2,IQP)     &
     &             +VMAT(1,3)*DXBFDB(3,IQP)
      DBFADB(2,IQP)=VMAT(2,1)*DXBFDB(1,IQP)+VMAT(2,2)*DXBFDB(2,IQP)     &
     &             +VMAT(2,3)*DXBFDB(3,IQP)
      DBFADB(3,IQP)=VMAT(3,1)*DXBFDB(1,IQP)+VMAT(3,2)*DXBFDB(2,IQP)     &
     &             +VMAT(3,3)*DXBFDB(3,IQP)
      ENDDO
!
      DBFADW(1)=VMAT(1,1)*DXBFDW(1)+VMAT(1,2)*DXBFDW(2)                 &
     &         +VMAT(1,3)*DXBFDW(3)
      DBFADW(2)=VMAT(2,1)*DXBFDW(1)+VMAT(2,2)*DXBFDW(2)                 &
     &         +VMAT(2,3)*DXBFDW(3)
      DBFADW(3)=VMAT(3,1)*DXBFDW(1)+VMAT(3,2)*DXBFDW(2)                 &
     &         +VMAT(3,3)*DXBFDW(3)
!
! GET PORTION OF EXPLICIT PARTIALS OF TRUE OF REF ACCEL WRT
! R, A & W  COMING FROM FACT THAT BODY FIXED COORDINATES
! FED INTO GEOPOTENTAL COMPUTATIONS WOULD BE DIFFERENT
!
      EXDA1(1)=RMB(1)*DBFADA(1,1)+RMB(2)*DBFADA(2,1)+RMB(3)*DBFADA(3,1)
      EXDA1(2)=RMB(4)*DBFADA(1,1)+RMB(5)*DBFADA(2,1)+RMB(6)*DBFADA(3,1)
      EXDA1(3)=RMB(7)*DBFADA(1,1)+RMB(8)*DBFADA(2,1)+RMB(9)*DBFADA(3,1)
      EXDAD1(1)=RMB(1)*DBFADA(1,2)+RMB(2)*DBFADA(2,2)+RMB(3)*DBFADA(3,2)
      EXDAD1(2)=RMB(4)*DBFADA(1,2)+RMB(5)*DBFADA(2,2)+RMB(6)*DBFADA(3,2)
      EXDAD1(3)=RMB(7)*DBFADA(1,2)+RMB(8)*DBFADA(2,2)+RMB(9)*DBFADA(3,2)
!
      EXDB1(1)=RMB(1)*DBFADB(1,1)+RMB(2)*DBFADB(2,1)+RMB(3)*DBFADB(3,1)
      EXDB1(2)=RMB(4)*DBFADB(1,1)+RMB(5)*DBFADB(2,1)+RMB(6)*DBFADB(3,1)
      EXDB1(3)=RMB(7)*DBFADB(1,1)+RMB(8)*DBFADB(2,1)+RMB(9)*DBFADB(3,1)
      EXDBD1(1)=RMB(1)*DBFADB(1,2)+RMB(2)*DBFADB(2,2)+RMB(3)*DBFADB(3,2)
      EXDBD1(2)=RMB(4)*DBFADB(1,2)+RMB(5)*DBFADB(2,2)+RMB(6)*DBFADB(3,2)
      EXDBD1(3)=RMB(7)*DBFADB(1,2)+RMB(8)*DBFADB(2,2)+RMB(9)*DBFADB(3,2)
!
      EXDW1(1)=RMB(1)*DBFADW(1)+RMB(2)*DBFADW(2)+RMB(3)*DBFADW(3)
      EXDW1(2)=RMB(4)*DBFADW(1)+RMB(5)*DBFADW(2)+RMB(6)*DBFADW(3)
      EXDW1(3)=RMB(7)*DBFADW(1)+RMB(8)*DBFADW(2)+RMB(9)*DBFADW(3)
!
! GET PORTION OF EXPLICIT PARTIALS OF TRUE OF REF ACCEL WRT
! R, A & W  COMING FROM FACT THAT BODY FIXED ACCELS WOULD
! BR ROTATED DIFFERENTLY
!
      EXDA2(1)=DRMBDA(1)*XDDBF(1)+DRMBDA(2)*XDDBF(2)+DRMBDA(3)*XDDBF(3)
      EXDA2(2)=DRMBDA(4)*XDDBF(1)+DRMBDA(5)*XDDBF(2)+DRMBDA(6)*XDDBF(3)
      EXDA2(3)=DRMBDA(7)*XDDBF(1)+DRMBDA(8)*XDDBF(2)+DRMBDA(9)*XDDBF(3)
      EXDAD2(1)=DRMDAD(1)*XDDBF(1)+DRMDAD(2)*XDDBF(2)+DRMDAD(3)*XDDBF(3)
      EXDAD2(2)=DRMDAD(4)*XDDBF(1)+DRMDAD(5)*XDDBF(2)+DRMDAD(6)*XDDBF(3)
      EXDAD2(3)=DRMDAD(7)*XDDBF(1)+DRMDAD(8)*XDDBF(2)+DRMDAD(9)*XDDBF(3)
!
      EXDB2(1)=DRMBDB(1)*XDDBF(1)+DRMBDB(2)*XDDBF(2)+DRMBDB(3)*XDDBF(3)
      EXDB2(2)=DRMBDB(4)*XDDBF(1)+DRMBDB(5)*XDDBF(2)+DRMBDB(6)*XDDBF(3)
      EXDB2(3)=DRMBDB(7)*XDDBF(1)+DRMBDB(8)*XDDBF(2)+DRMBDB(9)*XDDBF(3)
      EXDBD2(1)=DRMDBD(1)*XDDBF(1)+DRMDBD(2)*XDDBF(2)+DRMDBD(3)*XDDBF(3)
      EXDBD2(2)=DRMDBD(4)*XDDBF(1)+DRMDBD(5)*XDDBF(2)+DRMDBD(6)*XDDBF(3)
      EXDBD2(3)=DRMDBD(7)*XDDBF(1)+DRMDBD(8)*XDDBF(2)+DRMDBD(9)*XDDBF(3)
!
      EXDW2(1)=DRMBDW(1)*XDDBF(1)+DRMBDW(2)*XDDBF(2)+DRMBDW(3)*XDDBF(3)
      EXDW2(2)=DRMBDW(4)*XDDBF(1)+DRMBDW(5)*XDDBF(2)+DRMBDW(6)*XDDBF(3)
      EXDW2(3)=DRMBDW(7)*XDDBF(1)+DRMBDW(8)*XDDBF(2)+DRMBDW(9)*XDDBF(3)
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   19 CONTINUE
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!
!
!     IXALLC IS THE NUMBER OF PAIRS FOR PERIODIC TERMS
!     FOR THE SIMPLE MODEL WITH ONE FREQUENCY IXALLC=1
      DO 20 I=1,IXALLC
      ANGWT(I)=TWOPI/PPER(I)
      WT(I)=ANGWT(I)*SCAL
      WT(I)=MOD(WT(I),TWOPI)
   20 END DO
!
! RIGHT ASCENSION PARMS
!
      N2=IXALLC*2

!... Begin TJS...
      IF (LINTAX) THEN
! store partials of acceleration with respect to RA, DEC, and W
         PXPRA =(DGRV(1,2,IBOD)-DGRV(1,1,IBOD))/DXFRC1
         PYPRA =(DGRV(2,2,IBOD)-DGRV(2,1,IBOD))/DXFRC1
         PZPRA =(DGRV(3,2,IBOD)-DGRV(3,1,IBOD))/DXFRC1
         PXPDEC=(DGRV(1,3,IBOD)-DGRV(1,1,IBOD))/DXFRC1
         PYPDEC=(DGRV(2,3,IBOD)-DGRV(2,1,IBOD))/DXFRC1
         PZPDEC=(DGRV(3,3,IBOD)-DGRV(3,1,IBOD))/DXFRC1
         PXPW  =(DGRV(1,4,IBOD)-DGRV(1,1,IBOD))/DXFRC2
         PYPW  =(DGRV(2,4,IBOD)-DGRV(2,1,IBOD))/DXFRC2
         PZPW  =(DGRV(3,4,IBOD)-DGRV(3,1,IBOD))/DXFRC2
! get partials of RA, DEC, and W with respect to omega and R
         CALL GETDADO (PLOR(4,IBOD),DADO)
! compute partials of acceleration with respect to omega and R
         DO J=1,12
            PXDDO(1,J)=PXPRA*DADO(1,J)+PXPDEC*DADO(2,J)+PXPW*DADO(3,J)
            PXDDO(2,J)=PYPRA*DADO(1,J)+PYPDEC*DADO(2,J)+PYPW*DADO(3,J)
            PXDDO(3,J)=PZPRA*DADO(1,J)+PZPDEC*DADO(2,J)+PZPW*DADO(3,J)
         END DO
! compute partials of acceleration with respect to omega_0 and R_0
         JPLOR=12
         DO J=1,12
            DO I=1,3
               PXDDO0(I,J)=PXDDO(I, 1)*PLOR(JPLOR+ 1,IBOD)+             &
     &                     PXDDO(I, 2)*PLOR(JPLOR+ 2,IBOD)+             &
     &                     PXDDO(I, 3)*PLOR(JPLOR+ 3,IBOD)+             &
     &                     PXDDO(I, 4)*PLOR(JPLOR+ 4,IBOD)+             &
     &                     PXDDO(I, 5)*PLOR(JPLOR+ 5,IBOD)+             &
     &                     PXDDO(I, 6)*PLOR(JPLOR+ 6,IBOD)+             &
     &                     PXDDO(I, 7)*PLOR(JPLOR+ 7,IBOD)+             &
     &                     PXDDO(I, 8)*PLOR(JPLOR+ 8,IBOD)+             &
     &                     PXDDO(I, 9)*PLOR(JPLOR+ 9,IBOD)+             &
     &                     PXDDO(I,10)*PLOR(JPLOR+10,IBOD)+             &
     &                     PXDDO(I,11)*PLOR(JPLOR+11,IBOD)+             &
     &                     PXDDO(I,12)*PLOR(JPLOR+12,IBOD)
            END DO
            JPLOR=JPLOR+12
         END DO
! compute partials of acceleration with respect to RA_0, DEC_0, and W_0
         DO J=1,3
            DO I=1,3
!!!!           PXDDOT(NEQN-N2-14+2*J,I)=PXDDO0(I, 1)*DO0DA0( 1,J,IBOD)+ &
               PXDDOT(ISTART+(J-1)*2,I)=PXDDO0(I, 1)*DO0DA0( 1,J,IBOD)+ &
     &                                  PXDDO0(I, 2)*DO0DA0( 2,J,IBOD)+ &
     &                                  PXDDO0(I, 3)*DO0DA0( 3,J,IBOD)+ &
     &                                  PXDDO0(I, 4)*DO0DA0( 4,J,IBOD)+ &
     &                                  PXDDO0(I, 5)*DO0DA0( 5,J,IBOD)+ &
     &                                  PXDDO0(I, 6)*DO0DA0( 6,J,IBOD)+ &
     &                                  PXDDO0(I, 7)*DO0DA0( 7,J,IBOD)+ &
     &                                  PXDDO0(I, 8)*DO0DA0( 8,J,IBOD)+ &
     &                                  PXDDO0(I, 9)*DO0DA0( 9,J,IBOD)+ &
     &                                  PXDDO0(I,10)*DO0DA0(10,J,IBOD)+ &
     &                                  PXDDO0(I,11)*DO0DA0(11,J,IBOD)+ &
     &                                  PXDDO0(I,12)*DO0DA0(12,J,IBOD)
            END DO
         END DO
! compute partials of acceleration with respect to RA_t_0, DEC_t_0, and W_t_0
         DO J=1,3
          DO I=1,3
!!!!        PXDDOT(NEQN-N2-13+2*J,I)  =PXDDO0(I, 1)*DO0DA0( 1,3+J,IBOD)+&
            PXDDOT(ISTART+1+(J-1)*2,I)=PXDDO0(I, 1)*DO0DA0( 1,3+J,IBOD)+&
     &                                 PXDDO0(I, 2)*DO0DA0( 2,3+J,IBOD)+&
     &                                 PXDDO0(I, 3)*DO0DA0( 3,3+J,IBOD)+&
     &                                 PXDDO0(I, 4)*DO0DA0( 4,3+J,IBOD)+&
     &                                 PXDDO0(I, 5)*DO0DA0( 5,3+J,IBOD)+&
     &                                 PXDDO0(I, 6)*DO0DA0( 6,3+J,IBOD)+&
     &                                 PXDDO0(I, 7)*DO0DA0( 7,3+J,IBOD)+&
     &                                 PXDDO0(I, 8)*DO0DA0( 8,3+J,IBOD)+&
     &                                 PXDDO0(I, 9)*DO0DA0( 9,3+J,IBOD)+&
     &                                 PXDDO0(I,10)*DO0DA0(10,3+J,IBOD)+&
     &                                 PXDDO0(I,11)*DO0DA0(11,3+J,IBOD)+&
     &                                 PXDDO0(I,12)*DO0DA0(12,3+J,IBOD)
          END DO
         END DO
! zero out t^2 partial for W
!!!!     PXDDOT(NEQN-N2-6,1)=0.D0
!!!!     PXDDOT(NEQN-N2-6,2)=0.D0
!!!!     PXDDOT(NEQN-N2-6,3)=0.D0
         PXDDOT(ISTART+6,1)=0.D0
         PXDDOT(ISTART+6,2)=0.D0
         PXDDOT(ISTART+6,3)=0.D0
! compute partials of acceleration with respect to the six independent elements
! of I_c, the moment of inertia tensor in the body-fixed system
         JPLOR=156
         DO J=1,6
            DO I=1,3
!!!!           PXDDOT(NEQN-6+J,I)=PXDDO(I, 1)*PLOR(JPLOR+ 1,IBOD)+      &
               PXDDOT(ISTART+6+3*IXALLC+J,I)=                           &
                                  PXDDO(I, 1)*PLOR(JPLOR+ 1,IBOD)+      &
     &                            PXDDO(I, 2)*PLOR(JPLOR+ 2,IBOD)+      &
     &                            PXDDO(I, 3)*PLOR(JPLOR+ 3,IBOD)+      &
     &                            PXDDO(I, 4)*PLOR(JPLOR+ 4,IBOD)+      &
     &                            PXDDO(I, 5)*PLOR(JPLOR+ 5,IBOD)+      &
     &                            PXDDO(I, 6)*PLOR(JPLOR+ 6,IBOD)+      &
     &                            PXDDO(I, 7)*PLOR(JPLOR+ 7,IBOD)+      &
     &                            PXDDO(I, 8)*PLOR(JPLOR+ 8,IBOD)+      &
     &                            PXDDO(I, 9)*PLOR(JPLOR+ 9,IBOD)+      &
     &                            PXDDO(I,10)*PLOR(JPLOR+10,IBOD)+      &
     &                            PXDDO(I,11)*PLOR(JPLOR+11,IBOD)+      &
     &                            PXDDO(I,12)*PLOR(JPLOR+12,IBOD)
            END DO
            JPLOR=JPLOR+12
         END DO
      ELSE
!... End TJS...
!
! RA PARMS
!!!      PXDDOT(NEQN-N2-6,1)=EXDA1(1)+EXDA2(1)
!!!      PXDDOT(NEQN-N2-6,2)=EXDA1(2)+EXDA2(2)
!!!      PXDDOT(NEQN-N2-6,3)=EXDA1(3)+EXDA2(3)
!!!      PXDDOT(NEQN-N2-5,1)=EXDAD1(1)+EXDAD2(1)
!!!      PXDDOT(NEQN-N2-5,2)=EXDAD1(2)+EXDAD2(2)
!!!      PXDDOT(NEQN-N2-5,3)=EXDAD1(3)+EXDAD2(3)
!!      PXDDOT(NNEQN-N2-6,1)=(DGRV(1,2,IBOD)-DGRV(1,1,IBOD))/DXFRC1
!!      PXDDOT(NNEQN-N2-6,2)=(DGRV(2,2,IBOD)-DGRV(2,1,IBOD))/DXFRC1
!!      PXDDOT(NNEQN-N2-6,3)=(DGRV(3,2,IBOD)-DGRV(3,1,IBOD))/DXFRC1
!!      PXDDOT(NNEQN-N2-5,1)=PXDDOT(NNEQN-N2-6,1)*SCAL
!!      PXDDOT(NNEQN-N2-5,2)=PXDDOT(NNEQN-N2-6,2)*SCAL
!!      PXDDOT(NNEQN-N2-5,3)=PXDDOT(NNEQN-N2-6,3)*SCAL
      PXDDOT(ISTART,1)=(DGRV(1,2,IBOD)-DGRV(1,1,IBOD))/DXFRC1
      PXDDOT(ISTART,2)=(DGRV(2,2,IBOD)-DGRV(2,1,IBOD))/DXFRC1
      PXDDOT(ISTART,3)=(DGRV(3,2,IBOD)-DGRV(3,1,IBOD))/DXFRC1
      PXDDOT(ISTART+1,1)=PXDDOT(NNEQN-N2-6,1)*SCAL
      PXDDOT(ISTART+1,2)=PXDDOT(NNEQN-N2-6,2)*SCAL
      PXDDOT(ISTART+1,3)=PXDDOT(NNEQN-N2-6,3)*SCAL
!
! DECLINATION PARMS
!
!!!      PXDDOT(NEQN-N2-4,1)=EXDB1(1)+EXDB2(1)
!!!      PXDDOT(NEQN-N2-4,2)=EXDB1(2)+EXDB2(2)
!!!      PXDDOT(NEQN-N2-4,3)=EXDB1(3)+EXDB2(3)
!!!      PXDDOT(NEQN-N2-3,1)=EXDBD1(1)+EXDBD2(1)
!!!      PXDDOT(NEQN-N2-3,2)=EXDBD1(2)+EXDBD2(2)
!!!      PXDDOT(NEQN-N2-3,3)=EXDBD1(3)+EXDBD2(3)
!!      PXDDOT(NNEQN-N2-4,1)=(DGRV(1,3,IBOD)-DGRV(1,1,IBOD))/DXFRC1
!!      PXDDOT(NNEQN-N2-4,2)=(DGRV(2,3,IBOD)-DGRV(2,1,IBOD))/DXFRC1
!!      PXDDOT(NNEQN-N2-4,3)=(DGRV(3,3,IBOD)-DGRV(3,1,IBOD))/DXFRC1
!!      PXDDOT(NNEQN-N2-3,1)=PXDDOT(NNEQN-N2-4,1)*SCAL
!!      PXDDOT(NNEQN-N2-3,2)=PXDDOT(NNEQN-N2-4,2)*SCAL
!!      PXDDOT(NNEQN-N2-3,3)=PXDDOT(NNEQN-N2-4,3)*SCAL
      PXDDOT(ISTART+2,1)=(DGRV(1,3,IBOD)-DGRV(1,1,IBOD))/DXFRC1
      PXDDOT(ISTART+2,2)=(DGRV(2,3,IBOD)-DGRV(2,1,IBOD))/DXFRC1
      PXDDOT(ISTART+2,3)=(DGRV(3,3,IBOD)-DGRV(3,1,IBOD))/DXFRC1
      PXDDOT(ISTART+3,1)=PXDDOT(NNEQN-N2-4,1)*SCAL
      PXDDOT(ISTART+3,2)=PXDDOT(NNEQN-N2-4,2)*SCAL
      PXDDOT(ISTART+3,3)=PXDDOT(NNEQN-N2-4,3)*SCAL
!
! ROTATION PARMS
!
!!!      PXDDOT(NEQN-N2-2,1)=EXDW1(1)+EXDW2(1)
!!!      PXDDOT(NEQN-N2-2,2)=EXDW1(2)+EXDW2(2)
!!!      PXDDOT(NEQN-N2-2,3)=EXDW1(3)+EXDW2(3)
!
!!      PXDDOT(NNEQN-N2-2,1)=(DGRV(1,4,IBOD)-DGRV(1,1,IBOD))/DXFRC2
!!      PXDDOT(NNEQN-N2-2,2)=(DGRV(2,4,IBOD)-DGRV(2,1,IBOD))/DXFRC2
!!      PXDDOT(NNEQN-N2-2,3)=(DGRV(3,4,IBOD)-DGRV(3,1,IBOD))/DXFRC2
!!      PXDDOT(NNEQN-N2-1,1)=PXDDOT(NNEQN-N2-2,1)*SCAL
!!      PXDDOT(NNEQN-N2-1,2)=PXDDOT(NNEQN-N2-2,2)*SCAL
!!      PXDDOT(NNEQN-N2-1,3)=PXDDOT(NNEQN-N2-2,3)*SCAL
!!      PXDDOT(NNEQN-N2,1)=PXDDOT(NNEQN-N2-2,1)*SCALSQ
!!      PXDDOT(NNEQN-N2,2)=PXDDOT(NNEQN-N2-2,2)*SCALSQ
!!      PXDDOT(NNEQN-N2,3)=PXDDOT(NNEQN-N2-2,3)*SCALSQ
      PXDDOT(ISTART+4,1)=(DGRV(1,4,IBOD)-DGRV(1,1,IBOD))/DXFRC2
      PXDDOT(ISTART+4,2)=(DGRV(2,4,IBOD)-DGRV(2,1,IBOD))/DXFRC2
      PXDDOT(ISTART+4,3)=(DGRV(3,4,IBOD)-DGRV(3,1,IBOD))/DXFRC2
      PXDDOT(ISTART+5,1)=PXDDOT(NNEQN-N2-2,1)*SCAL
      PXDDOT(ISTART+5,2)=PXDDOT(NNEQN-N2-2,2)*SCAL
      PXDDOT(ISTART+5,3)=PXDDOT(NNEQN-N2-2,3)*SCAL
      PXDDOT(ISTART+6,1)=PXDDOT(NNEQN-N2-2,1)*SCALSQ
      PXDDOT(ISTART+6,2)=PXDDOT(NNEQN-N2-2,2)*SCALSQ
      PXDDOT(ISTART+6,3)=PXDDOT(NNEQN-N2-2,3)*SCALSQ
!
!     IXALLC IS THE NUMBER OF PAIRS FOR PERIODIC TERMS
!!      K=6
      IOFF=0
      DO 30 I=1,IXALLC
      F1=COS(WT(I))
      F2=SIN(WT(I))
!!      PXDDOT(NNEQN-(2*IXALLC-2*I+1),1)=PXDDOT(NNEQN-N2-K,1)*F1
!!      PXDDOT(NNEQN-(2*IXALLC-2*I+1),2)=PXDDOT(NNEQN-N2-K,2)*F1
!!      PXDDOT(NNEQN-(2*IXALLC-2*I+1),3)=PXDDOT(NNEQN-N2-K,3)*F1
!!      PXDDOT(NNEQN-(2*IXALLC-2*I),1)=PXDDOT(NNEQN-N2-K,1)*F2
!!      PXDDOT(NNEQN-(2*IXALLC-2*I),2)=PXDDOT(NNEQN-N2-K,2)*F2
!!      PXDDOT(NNEQN-(2*IXALLC-2*I),3)=PXDDOT(NNEQN-N2-K,3)*F2
!!      K=K-2
!!      IF(K.LT.2) K=6
      PXDDOT(ISTART+7+(I-1)*2,1)=PXDDOT(ISTART+IOFF,1)*F1
      PXDDOT(ISTART+7+(I-1)*2,2)=PXDDOT(ISTART+IOFF,2)*F1
      PXDDOT(ISTART+7+(I-1)*2,3)=PXDDOT(ISTART+IOFF,3)*F1
      PXDDOT(ISTART+8+(I-1)*2,1)=PXDDOT(ISTART+IOFF,1)*F2
      PXDDOT(ISTART+8+(I-1)*2,2)=PXDDOT(ISTART+IOFF,2)*F2
      PXDDOT(ISTART+8+(I-1)*2,3)=PXDDOT(ISTART+IOFF,3)*F2
      IOFF=IOFF+2
      IF(IOFF.GT.4) IOFF=0
   30 END DO
!...  ENDIF FOR ANALYT VS LINTAX
      END IF
!
!!!      VMAT(1,2)=HOLDV1
!!!      VMAT(1,3)=HOLDV2
!!!      VMAT(2,3)=HOLDV3
      RETURN
      END
