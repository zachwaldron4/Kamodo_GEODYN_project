!$SIMREC
      SUBROUTINE SIMREC(ISDWRD,PSBUF,ISAT1,ISAT2,ISAT3,ISTAT1,ISTAT2,   &
     &              ISTAT3,NTYPE,                                       &
     &              MJDS1,MJDS2,FSECS,IEARLY,NPTS,FSELAP,FSCSDM,        &
     &              INDSAT,INDSTA,INDSET,INPSTA,INPSAT,LELEVS,AA,II,LL, &
     &              ILCORR)
!********1*********2*********3*********4*********5*********6*********7**
! SIMREC            87/04/00            0000.0    PGMR - DESPINA PAVLIS
!
! FUNCTION: GENERATES DIRECTORY RECORD FOR AN ACCEPTED PSEUDO-BLOCK
!           LOADS DWORD(100) OF COMMON/COBDIR/
!           GENERATES OBSERVATION BUFFER PSBUF FOR THE ACCEPTED
!           PSEUDO-BLOCK
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   ISDWRD   I    S    NUMBER OF WORDS IN THE PSEUDO-DATA RECORD
!   PSBUF    O    A    PSEUDO BUFFER
!   ISAT1    I    S    FIRST SATELLITE IN THE PRESENT CONFIGURATION
!   ISAT2    I    S    SECOND SATELLITE IN THE PRESENT CONFIGURATION
!   ISAT3    I    S    THIRD SATELLITE IN THE PRESENT CONFIGURATION
!   ISTAT1   I    S    FIRST STATION IN THE PRESENT CONFIGURATION
!   ISTAT2   I    S    SECOND STATION IN THE PRESENT CONFIGURATION
!   ISTAT3   I    S    THIRD STATION IN THE PRESENT CONFIGURATION
!   NTYPE    I    S    MEASUREMENT TYPE IN THE PRESENT PSEUDO BLOCK
!   MJDS1    I    S    START TIME OF THE PRESENT PSEUDO PSEUDO BLOCK
!   MJDS2    I    S    STOP TIME OF THE PRESENT PSEUDO BLOCK
!   FSECS    I    S    REMAINING SECONDS OF MJDS1
!   IEARLY   I    S    INDEX TO THE EARLIEST TIME FOR SCHEDULING ARRAYS
!   NPTS     I    S    NUMBER OF OBSERVATIONS IN THIS PSEUDO BLOCK
!   FSELAP   I    S    ELAPSED SECONDS FROM THE BEGINNING TO THE END OF
!                      THE BLOCK
!   FSCSDM   I    S    REMAINING SECONDS FROM THE SIMULATION CAPABILITY
!                      REFERENCE TIME
!   INDSAT   I    A    FOR A GIVEN INTERNAL SAT NO (1,2,3) INDSAT
!                      GIVES THE ACTUAL LOCATION IN THE SATELLITE
!                      RELATED ARRAYS FOR THIS SATELLITE.
!                      (EG.   SAT ID=ISATNO(INDSAT(1,2,OR 3))
!   INDSTA   I    A    FOR A GIVEN INTERNAL STA NO (1,2,3) INDSTA
!                      GIVES THE ACTUAL LOCATION IN THE STATION
!                      RELATED ARRAYS FOR THIS STATION.
!                      (EG.   STA NO=ISTANO(INDSTA(1,2,OR 3))
!   INDSET   I    A    FOR A GIVEN INTERNAL SATELLITE NUMBER INDSET TELL
!                      WHICH SAT SET THAT THE GIVEN SAT BELONGS TO.
!   INPSTA   I    A    POINTER ARRAY THAT RELATES THE INTERNAL STATION
!                      NUMBER (1,2,3) TO THE STATIONS DEFINED IN THE
!                      DATA HEADER RECORDS (N=1,2,3). (EG.
!                      ISTAP=INPSTA(1) WOULD TELL WHICH OF THE THREE
!                      POSSIBLE STATIONS DEFINED IN THE DATA HEADER
!                      RECORDS PERTAINED TO INTERNAL STATION NO. 1)
!   INPSAT   I    A    POINTER ARRAY THAT RELATES THE INTERNAL SATELLITE
!                      NUMBER (1,2,3) TO THE SATELLITES DEFINED IN THE
!                      DATA HEADER RECORDS (N=1,2,3). (EG.
!                      ISATP=INPSAT(1) WOULD TELL WHICH OF THE THREE
!                      POSSIBLE SATELLITES DEFINED IN THE DATA HEADER
!                      RECORDS PERTAINED TO INTERNAL SATELLITE NO. 1)
!   LELEVS   I    A    LOGICAL ARRAY FOR ELEVATION CUTOFF
!                      .TRUE. = DO ELEVATION CHECK FOR THIS SATELLITE
!                      AND THIS LINK
!                      .FALSE. = SKIP ELEVATION CHECK FOR THIS SATELLITE
!                      AND THIS LINK
!   AA      I/O   A    REAL DYNAMIC ARRAY
!   II      I/O   A    INTEGER DYNAMIC ARRAY
!   LL      I/O   A    LOGICAL DYNAMIC ARRAY
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
      COMMON/COBDIR/DWORD(100),CDIREC,TDIREC
      COMMON/COBGLO/MABIAS,MCBIAS,MPVECT,MINTPL,MPARAM,MSTA,MOBBUF,     &
     &       MNPITR,MWIDTH,MSIZE ,MPART ,MBUF  ,NXCOBG
      COMMON/CORA04/KABIAS,KABSTR,KABSTP,KCBIAS,KCBSTR,KCBSTP,          &
     &       KRNM  ,KRKM  ,KRKJ  ,KRIJ  ,KRKPM ,                        &
     &       KRRNM ,KRRKM ,KRRKJ ,KRRIJ ,KRRKPM,                        &
     &       KURNM ,KURKM ,KURKJ ,KURIJ ,KURKPM,                        &
     &       KPRRNM,KPRRKM,KPRRKJ,KPRRIJ,KPRRKP,                        &
     &       KPMPXI,KPMPXE,KRA   ,KRELV ,KUHAT ,KWORK ,KTMPCR,KU    ,   &
     &       KS0   ,KS1   ,KXTP  ,KPXSXP,KPXDXP,KXUTDT,KRPOLE,KPXPOL,   &
     &       KXDPOL,KOBBUF,KOBSC ,KRESID,KSIGMA,KRATIO,KELEVS,          &
     &       KPMPA ,KPXSLV,KTPRTL,                                      &
     &       KFRQOF,KXYZOF,KFRQST,KFRQSA,KSTDLY,KSADLY,KXYZCG,KSCMRA,   &
     &       KEBVAL,KEBSIG,KEBNAM,KBTWB ,KTBTWA,KBTWD ,KPMPE ,          &
     &       KFSEB1,KFSEB2,KSTAMT,KPXSPA,KDIAGN,KOBOUT,KGRLT1,KGRLT2,   &
     &       KGRLT3,KGRLT4,KGRLT5,KPSTAT,KRSUNS,KCHEMR,KCHMOR,KEPOSR,   &
     &       KCHEMT,KCHMOT,KEPOST,KCHCBS,KCPOSS,KSCRTM,KXSTT ,KXSTR ,   &
     &       KXSS  ,KRANGT,KRANGR,KCHB1 ,KCHB2 ,KCHBV1,KCHBV2,KCHEB ,   &
     &       KSSTFQ,KSSTCC,KSSTSS,KSSTWT,KRLCOR,KWVLBI,KQUINF,KBRTS ,   &
     &       KBRTSV,KLRARC,KXEPBF,KXEPBR,KPRCBD,KPRTBD,KXPMPA,KXL,      &
     &       KXSIG ,KXEDTS,KXALO1,KXALO2,KXYOF2,KDLATF,KDLATS,KDLONF,   &
     &       KDLONS,KPF   ,KPS   ,                                      &
     &       KXOBSV,KXOBSW,KXEDSW,                                      &
     &       KXSIGW,KPSF  ,KDNUM ,KCNUM ,KFCOR ,KCOSAR,KSINAR,KSABIA,   &
     &       KSBTM1,KSBTM2,KYAWBS,KVLOUV,KACMAG,KOBSTR,                 &
     &       KPRL1 ,KPRL2, KRL1  ,KT1SE ,KTCP  ,                        &
     &       KRATDR,KFQT1S,KFQT1E,KT1STR,KFTTSE,KFRSTR,KFRRAT,KSV1  ,   &
     &       KSV2  ,KTSLOV,                                             &
     &       KGLGR1,KGLGR2,KGLFR1,KGLFR2,                               &
     &       KARGR1,KARGR2,KARFR1,KARFR2,                               &
     &       KRDS1L,KFT1AV,KDFQP ,KFREQ1,KFREQ3,KSAVD1,KSAVD2,          &
     &       KANTOU,KFM3CF,KF2CF,KTMG,KLTMG,KX2TIM,KX2OBS,KXRNDX,KX2SCR,&
     &       KALTWV,KXXBM ,KX2PAR,KATIME,KPMPAT,KPMATT,KX2PAT,          &
     &       KPXEXI,KPXEPA,KPV,KPXEP2,KX2COF,KACOF2,KACOF3,KBCOF,KBCOF2,&
     &       KDDDA ,KX2AUX,KX2VPR,KX2VPA,KEXTRA,KVARAY,KATROT,KATPER,   &
     &       KLTAR ,KXHOLD,KANTBL,KPHC  ,KOFDRV,KGNAME,KGRSIZ,KGRCNT,   &
     &       KGRDAT,KACCDT,KCTBTI,KCTBWE,KCTCTM,KANTUV,KANTOR,KW1PU ,   &
     &       KPYSQH,KSIGSP,KXYOF3,KXVTM1,KXDIST,KXDST0,KTMSE ,KDSDP ,   &
     &       KEXCST,KEXCDT,KEXCGX,KEXCGY,KEXCGZ,KIMNDX,KIMOBS,KIMTIM,   &
     &       KIMSAT,KM2VPA,KDCDD ,KDWNWT,KDPOR ,KC2PAR,KBOUNC,KBPART,   &
     &       NXCA04
      COMMON/CORA06/KPRMV ,KPNAME,KPRMV0,KPRMVC,KPRMVP,KPRMSG,KPARVR,   &
     &              KPRML0,KPDLTA,KSATCV,KSTACV,KPOLCV,KTIDCV,KSUM1 ,   &
     &              KSUM2 ,KGPNRA,KGPNRM,KPRSG0,KCONDN,KVELCV,          &
     &              KSL2CV,KSH2CV,KTIEOU,KPRMDF,NXCA06
      COMMON/CORA07/KELEVT,KSRFEL,KTINT,KFSCSD,KXTIM,KFSDM,             &
     & KSGM1,KSGM2,KNOISE,KEPHMS,NXCA07
      COMMON/CORI04/KNMP  ,KINDP ,KNDPAR,KNPVCT,KISATN,KISET ,KIANTO,   &
     &              KISATO,KIANTD,KISATD,KISTAD,KISATC,KMJDCG,KISTAT,   &
     &              KMJDEB,KMJDBN,KNDBIN,KNWTDB,KIXPAR,KNDBUF,KSSTNM,   &
     &              KSSTNA,KMBSAT,KMBSTA,KXKEY ,KXVKEY,KXFLAG,KIPNTF,   &
     &              KIPNTS,KNCON ,KKF   ,KIDATB,KNSTLV,KSLVID,KLLBIA,   &
     &              KTMRA1,KTMRA2,KIND1 ,KTARID,KATARD,KYAWID,KXOBLK,   &
     &              KDSCWV,KATRSQ,KATSAT,KKVLAS,KPARTP,KLTMSC,KLTASC,   &
     &              KCTBST,KSTBST,KANCUT,KANGPS,KANTYP,                 &
     &              KANTOF,                                             &
     &              KYSAT, KMBDEG,                                      &
     &              KMBNOD,KMBSST,KBSPLN,KSSPLN,KXIOBS,KIDLAS,KIAVP ,   &
     &              KXNAVP,KNEXCG,KIDEXC,KNREXC,KTELEO,KIKEY ,KIMKEY,   &
     &              KIMBLK,KIMPRT,KCN110,KCN111,KC110,KC111,KTDSAT,     &
     &              KTDANT,NXCI04
      COMMON/CORI06/KPTRAU,KPTRUA,KNFMG ,KIPTFM,KILNFM,KIGPC ,          &
     &              KIGPS ,KIGPCA,KIGPSA,KIELMT,KMFMG ,KTPGPC,          &
     &              KTPGPS,KTPUC ,KTPUS,                                &
     &              KLINK,KPTFAU,KPTFUA,NXCI06
      COMMON/CORL04/KLEDIT,KLBEDT,KLEDT1,KLEDT2,KNSCID,KEXTOF,KLSDAT,   &
     &              KLRDED,KLAVOI,KLFEDT,KLANTC,NXCL04
      COMMON/CORL06/KLBIAS,KLADEL,NXCL06
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/CSTATS/MSTATS,MTYPES,NXCSTT
      COMMON/CVIEW /IOUT6 ,ILINE6,IPAGE6,MLINE6,                        &
     &              IOUT8 ,ILINE8,IPAGE8,MLINE8,                        &
     &              IOUT9 ,ILINE9,IPAGE9,MLINE9,                        &
     &              IOUT10,ILIN10,IPAG10,MLIN10,                        &
     &              IOUT15,ILIN15,IPAG15,MLIN15,                        &
     &              IOUT16,ILIN16,IPAG16,MLIN16,                        &
     &              IOUT7 ,NXCVUE
      COMMON/DTMGDN/TGTYMD,TMGDN1,TMGDN2,REPDIF,XTMGN
      DIMENSION PSBUF(ISDWRD),ID(4),LMOV(86),ICORR(86),                 &
     &          LOBS(86),FSCSDM(NPTS)
      DIMENSION ISTAAR(3),ISATAR(3),PREPR(3)
      DIMENSION AA(1),II(1),LL(1),INDSTA(3,4),INDSAT(3,4),INDSET(3,4),  &
     &   LELEVS(3,4),INPSTA(3,4),INPSAT(3,4),                           &
     &   ILCORR(5,4)
      DIMENSION ITMBIT(999)
      DIMENSION VLITES(2)
      DIMENSION IPWR(21)
      DIMENSION IHEAD(199),HDR(4),HDRA(2)
!
      DATA HDR/-9000000.,-8000000.,-7000000.,-6000000./
      DATA HDRA/7000000.,2000000./
!
!     MTYPES     1-12, 13-14, 15-30, 31-36, 37-38, 39-42, 43-44, 45-46
      DATA IHEAD/12*2,  2*2,   16*2,  6*0,   2*3,   4*2,   2*3,   2*2,  &
     &            4*3,    2*2,    2*3,    2*3,    2*4,    2*4,    4*3,  &
     &            4*4,    2*3,    4*4,    18*4,   6*0,  2,  2, 98*0, 2/
!     MTYPES     47-50,  51-52,  53-54,  55-56,  57,58,  59-60,  61-64
!     MTYPES     65-68,  69-70,  71-74,  75-92   93-98,99,100,-----,199
!
! MEASUREMENT TYPES 01-10
!      DATA ITMBIT/10*Z000002,
      DATA ITMBIT/10*2,                                                 &
     &   2*2,      2*7,      6*3,                                       &
     &   2*3,      8*15,                                                &
     &   2*3,      2*3,      2*3,      2*3,      2*6,                   &
     &   2*3,      2*6,      2*7,      2*7,      2*14,                  &
     &   4*7,      7,      71,     31,     95,     31,     95,          &
     &   4*195,    2*390,    2*198,    2*195,                           &
     &   2*199,    6*455,    2015,   4095,                              &
     &   2015,   4095,   2015,   4095,   2*1597635,2*798915, 2*815303,  &
     &   2*815303, 2*1864135,8255455,16772215, 2*7,      2*7     ,      &
     &   7,        898*2/
! MEASUREMENT TYPES 11-20
!        2*Z000002,2*Z000007,6*Z000003,
! MEASUREMENT TYPES 21-30
!        2*Z000003,8*Z00000F,
! MEASUREMENT TYPES 31-40
!        2*Z000003,2*Z000003,2*Z000003,2*Z000003,2*Z000006,
! MEASUREMENT TYPES 41-50
!        2*Z000003,2*Z000006,2*Z000007,2*Z000007,2*Z00000E,
! MEASUREMENT TYPES 51-60
!C       4*Z000007,2*Z000007,Z00001F,Z00003F,Z00001F,Z00003F,
!    5   4*7,      2*7,      31,     95,     31,     95,
!        4*Z000007,Z000007,Z      ,Z00001F,Z00003F,Z00001F,Z00003F,
! MEASUREMENT TYPES 61-70
!        4*Z0000C3,2*Z000186,2*Z0000C6,2*Z0000C3,
! MEASUREMENT TYPES 71-80
!        2*Z0000C7,6*Z0001C7,Z0007DF,Z000FFF,
! MEASUREMENT TYPES 81-90
!        Z0007DF,Z000FFF,Z0007DF,Z000FFF,2*Z1860C3,2*Z0C30C3,2*Z0C70C7,
! MEASUREMENT TYPES 91-100
!        2*Z0C70C7,2*Z1C71C7,Z7DF7DF,ZFFFFFF,  2*Z000007,2*Z000007,
! MEASUREMENT TYPES 101-999
!        Z000007,898*Z000002/
!
      DATA ZERO/0.D0/,ONE/1.D0/,TWO/2.D0/,THREE/3.D0/
      DATA IPWR/1,2,4,8,16,32,64,128,256,512,1024,2048,4096,8192,16384, &
     &     32768,65536,131072,262144,524288,1048576/
      DATA PWR31/1073741824.0D0/
      DATA NON/16777215/
      DATA VLITES/2.9979250000D8,2.9979245800D8/
      DATA DRFREQ/5.D14/
      DATA EXPM6/1.D-6/
!
!**********************************************************************
! START OF EXECUTABLE CODE
!**********************************************************************
!
! INITIALIZATIONS
! ZERO OUT PSBUF ARRAY
      DO 900 I=1,ISDWRD
      PSBUF(I)=ZERO
  900 END DO
!
      VLIGHT=VLITES(2)
!
      ISTAAR(1)=ISTAT1
      ISTAAR(2)=ISTAT2
      ISTAAR(3)=ISTAT3
      ISATAR(1)=ISAT1
      ISATAR(2)=ISAT2
      ISATAR(3)=ISAT3
!
! ZERO OUT DIRECTORY RECORD
      DO 1000 I=1,100
      DWORD(I)=ZERO
 1000 END DO
!
! LOAD DW0RD
      DWORD(1)= DBLE(MJDS1) + REPDIF
      DWORD(2)= FSECS
! BUFFER NUMBER OF START OF BLOCK
      DWORD(3)= ONE
! BUFFER NUMBER OF END OF BLOCK
      DWORD(4)= ONE
! WORD LOCATION WITHIN STARTER BUFFER OF WORD
! ZERO OF MASTER BLOCK HEADER RECORD
      DWORD(5)= ONE
! DWORD(6)= NUMBER OF HEADER RECORDS INCLUDING MASTER HEADER RECORD
! THIS WORD CHANGES ACCORDING TO THE MEASUREMENT TYPE
      DWORD(6)=DBLE(IHEAD(NTYPE))*10.D0
! NUMBER OF OBSERVATIONS IN THE BLOCK
      DWORD(7)= DBLE(NPTS)
!     ** LOAD MOVE/CORRECT ARRAY FOR THIS MEASUREMENT TYPE **
      CALL MOVCOR(NTYPE,LMOV,LOBS,ICORR,LOBSCK)
!
!** DEBUG ************************************************************
!     WRITE(IOUT6,74277) LMOV
!74277 FORMAT(1X,'LMOV',1X,40L2,/,1X,4X,1X,40L2,2X,8L2)
!     WRITE(IOUT6,74287) LOBS
!74287 FORMAT(1X,'LOBS',1X,40L2,/,1X,4X,1X,40L2,2X,8L2)
!** DEBUG ************************************************************
!
!     ** STORE LMOV ARRAY AS SWITCHES IN THE INTERNAL OBSERVATION **
!     ** DIRECTORY RECORD                                         **
!
      IOBD11=0
      IOBDR8=0
      DO 3000 IK1=1,4
      ID(IK1)=0
 3000 END DO
      DO 5000 IX=1,20
      DO 4000 IJ=1,4
      IK1=IX+(IJ-1)*20
      IF(.NOT.LMOV(IK1)) GOTO 4000
      IOBDR8=IOBDR8+1
      ID(IJ)=ID(IJ)+IPWR(IX)
 4000 END DO
 5000 END DO
      DWORD(9)=DBLE(ID(1))+DBLE(ID(2))*DBLE(IPWR(21))
      DWORD(10)=DBLE(ID(3))+DBLE(ID(4))*DBLE(IPWR(21))
      DWORD(8)=DBLE(IOBDR8)
      IF(.NOT.LMOV(81)) GOTO 6000
      IOBD11=IOBD11+IPWR(1)
      IF(LOBS(81)) IOBD11=IOBD11+IPWR(2)
      IOBD11=IOBD11+IPWR(3)
 6000 CONTINUE
      IF(LMOV(82)) IOBD11=IOBD11+IPWR(4)
      IF(LMOV(83)) IOBD11=IOBD11+IPWR(5)
      IF(LMOV(84)) IOBD11=IOBD11+IPWR(6)
      IF(.NOT.LMOV(85)) GOTO 7000
      IOBD11=IOBD11+IPWR(7)+IPWR(9)
 7000 CONTINUE
      IF(LOBS(85)) IOBD11=IOBD11+IPWR(8)+IPWR(10)
      DWORD(11)=DBLE(ITMBIT(NTYPE))+DBLE(IOBD11)*PWR31
! DWORD(12)=NUMBER OF LOCATION DATA DESCRIPTION RECORDS ARE PRESENT
! CHANGE FOR ALTIMETRY DATA
      DWORD(12)= ZERO
      IF(NTYPE.EQ.99.OR.NTYPE.EQ.199)DWORD(12)=ONE
! DWORD(13)=TRACKING CONFIGUR/MEAS.TYPE SEQUENCE NUMBER
! DWORD(13)=DFLOAT(MSTATS) OF COMMON CSTATS SET IN BINARY
      DWORD(13)=DBLE(IEARLY)+0.001
      DWORD(14)=THREE*EXPM6
!
! DWORD(15)=MASTER HEADER RECORD PREPRO WORD
! DWORD(16)=HEADER RECORD #1  PREPRO WORD
! DWORD(17)=HEADER RECORD #2  PREPRO WORD
! DWORD(18)=HEADER RECORD #3  PREPRO WORD
!
      DWORD(15)=DBLE(NON)
      DWORD(16)=DBLE(NON)
      DWORD(17)=DBLE(NON)
      DWORD(18)=DBLE(NON)
!
      PREPR(1)=DWORD(16)
      PREPR(2)=DWORD(17)
      PREPR(3)=DWORD(18)
! LOAD PSBUF
      IHEADR=IHEAD(NTYPE)-1
! AT THIS POINT LOAD PSBUF ACCORDING TO MEASUREMENT TYPE
! PSBUF(1)-PSBUF(10) IS THE SAME FOR ALL MEASUREMENT TYPES
      PSBUF(1) =DBLE(MJDS1)
      PSBUF(2) =FSECS
      PSBUF(3) =FSELAP
! PSBUF(4) =SPEED OF LIGHT ASSOCIATED WITH DATA IN THIS BLOCK
      PSBUF(4) =VLIGHT
      PSBUF(5) =DBLE(NTYPE)+DWORD(14)
! PSBUF(6) = TIME SYSTEM INDICATOR
! ATTENTION
      PSBUF(6) =ZERO
      PSBUF(7)=DBLE(NPTS)
! PSBUF(8) =NUMBER OF AUXILIARY RECORDS ASSOCIATED WITH EACH
! OBSERVATION RECORD
      PSBUF(8) =IHEADR
      IF(NTYPE.EQ.99.OR.NTYPE.EQ.199)PSBUF(8)=IHEADR+TWO
      PSBUF(9) =DWORD(15)
      PSBUF(10)=HDR(1)
! PSBUF(10) = RECORD TYPE INDICATOR -9,000,000 NOT NEEDED HERE
!
! IHEADR=THE NUMBER OF HEADER RECORDS WITHOUT THE MASTER HEADER
! RECORD
      IF(IHEAD(NTYPE).EQ.1)GOTO 10000
      INDEX=10
      DO 8000 J=1,6
      PSBUF(INDEX+J)=ZERO
 8000 END DO
! METEOROLOGICAL DATA NOT NEEDED
!     PSBUF(INDEX+1)=SMET
! AMBIGUITY LEVEL NOT NEEDED
!     PSBUF(INDEX+2)=AMBIG
! REFERENCE FREQUENCY
! SST SHORT PATH/LONG PATH DOPPLER FREQUENCY RATIO FOR TRACKED
! REMOTE STATION  GOES ONLY TO HEADERS 2 AND 3
      PSBUF(INDEX+3)=DRFREQ
! COORDINATE SYSTEM REFERENCE DATE MTYPES 1-14
! PASS STANDARD ERROR FOR NORMAL POINT DATA MTYPES 39-99
!     PSBUF(INDEX+5)=RFMJDS
      DO 9000 I=1,IHEADR
      PSBUF(INDEX+7)=DBLE(ISTAAR(I))
      PSBUF(INDEX+8)=DBLE(ISATAR(I))
      PSBUF(INDEX+9)=PREPR(I)
      PSBUF(INDEX+10)=HDR(I+1)
      INDEX=INDEX+10
 9000 END DO
      IF(NTYPE.NE.99.OR.NTYPE.EQ.199) GOTO 10000
      INDEX=INDEX+10
! SEMI-MAJOR AXIS OF REF ELLIPSOID IN METERS
!     PSBUF(INDEX+1) =
! INVERSE FLATTENING OF REF ELLIPSOID
!     PSBUF(INDEX+2) =
! EIGHT CHARACTER REF ELLIPSOID DESCRIPTOR
!     PSBUF(INDEX+3) =
! EIGHT CHARACTER GEOID DESCRIPTOR
!     PSBUF(INDEX+4) =
! EIGHT CHARACTER MEAN SEA SURFACE DESCRIPTOR
!     PSBUF(INDEX+5) =
! EIGHT CHARACTER ORBIT DESCRIPTOR
!     PSBUF(INDEX+6) =
      PSBUF(INDEX+7) =ZERO
      PSBUF(INDEX+8) =ZERO
! UNIQUNESS INDICATOR
!     PSBUF(INDEX+9) =
! RECORD TYPE INDICATOR
!     PSBUF(INDEX+10)=HDRA(1)
10000 CONTINUE
! AT THIS POINT LOAD THE LOCATION DATA DESCRIPTOR RECORD FOR ALTIMETRY
!     DO 9911 IJ=1,40
!     WRITE(6,99111)PSBUF(IJ),IJ
!9911  CONTINUE
!99111 FORMAT(2X,'SIMREC PSBUF',F25.8,I3)
      CALL OBSRD(AA,II,LL,AA(KOBBUF),AA(KPRMVC),LL(KLBIAS),INDSTA,  &
     & INDSAT,INDSET,INPSTA,INPSAT,LELEVS,LEOF,AA(KFSDM),AA(KQUINF),   &
     & II(KPTRAU),II(KPTRUA),AA(KPNAME),ILCORR,II(KTMRA1),II(KTMRA2),  &
     & AA(KFRSTR),AA(KFRRAT),LL(KLAVOI))
      RETURN
      END
