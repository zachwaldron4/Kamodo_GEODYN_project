!$ATPARP
      SUBROUTINE ATPARP(AA,II,LL,MTYPE,INDSAT,NM,MJDSIN,FSECIN,IATSAT,  &
     &                  KVLAS,ATIME)
!*******************************************************************
!
!   FUNCTION -  CAMERA MEASUREMENT TYPES (33& 34) AND ALTIMETER
!               MEASUREMENT TYPES (>99) REQUIRE THAT SPACECRAFT AND
!               LASER (OR CAMERA) ATITUDE PARAMTERS ARE DEFINED
!               IN SETUP DECK AND ON TRACKING DATA. FOR EACH CAMERA
!               AND ALTIMTER MEASUREMENT BLOCK THIS ROUTINE MAKES
!               SURE THAT THE DATA CONECTS UP WITH ATITUDE PARAMETERS.
!               FOR A BLOCK OF DATA, DETERMINE STARTING LOCATIONS
!               IN MEASUREMENT PARTIAL ARRAY OF ATITUDE PARAMETERS
!               FOR SPACECRAFT BODY AND LASER OR CAMERA. THESE POINTERS
!               ARE IN COMMON BLOCK XOVER. IAPLSC IS POINTER FOR
!               SPACECRAFT POINTERS. IAPLL IS POINTER FOR LASER OR
!               CAMERA
!
!  I/O PARAMETERS:
!
!   NAME    A/S    I/O   DESCRIPTION OF I/O PARAMETERS IN ARGUMENT LIST
!   -----  ------ -----  -----------------------------------------------
!   AA       A     I/O   REAL DYNAMIC ARRAY
!   II       A     I/O   INTEGER DYNAMIC ARRAY
!   MTYPE    S      I    MEASUREMENT TYPE
!   INDSAT   S      I    INTERNAL SATELLITE # OF 1ST SAT OF THIS MT
!   NM       S      I    NUMBE OF MEASURENENTS IN A BLOCK
!   MJDSIN   S      I    MJDSEC FOR BLOCK START
!   FSECIN   A      I    FRACTIONAL SECONDS FOR EACH OBSERVATION
!   IATSAT   A      I    ARRAY OF SATELLITES WITH ATITUDE PARAMETERS
!   KVLAS    A      I    ARRAY OF INSTRUMENT IDS
!   ATIME    A      I    TIMES FOR ATTITUDE PARAMETERS
!
!***********************************************************************
!
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
      COMMON/ATTCB /KPAT,MAXAT,MAXLAS,IBLAS,                            &
     &              NASAT,IATCNT,NXATT
      COMMON/CALTOP/LADYNO,LAGEOO,LRGEOT,LRETDT,LROTDT,LRSSTT,LCOTRM,   &
     &              LFILOT,LATCOR,LFIRIT,LX1ALT,LX2ALT,LMSSWG,LATMOD,   &
     &              LG1BOT,LG1B,LONEG1,LXATTD,LXBEAM,NXALTO
      COMMON/CBLOKA/FSECBL,SIGNL ,VLITEC,SECEND,BLKDAT(6,4),DOPSCL(5,4)
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/CORA01/KFSEC0,KFSECB,KFSEC ,KFSECV,KH    ,KHV   ,KCTOL ,   &
     &              KRSQ  ,KVMATX,KCPP  ,KCPV  ,KCCP  ,KCCV  ,KCCPV ,   &
     &              KCCVV ,KXPPPP,KX    ,KPX   ,KSUMX ,KXDDOT,KSUMPX,   &
     &              KPXDDT,KAB   ,KPN   ,KAORN ,KSINLM,KCOSLM,KTANPS,   &
     &              KCRPAR,KVRARY,KXM   ,KXNP1 ,KXPRFL,KXM2  ,KXNNP1,   &
     &              KWRK  ,KFI   ,KGE   ,KB0DRG,KBDRAG,KAPGM ,KAPLM ,   &
     &              KCN   ,KSN   ,KSTID ,KTIDE ,KSTDRG,KSTSRD,KSTACC,   &
     &              KLGRAV,KGM   ,KAE   ,KFPL  ,KFEQ  ,KPLNPO,KPLNVL,   &
     &              KXEPOC,KCD   ,KCDDOT,KCR   ,KGENAC,KACN  ,KASN  ,   &
     &              KTHDRG,KCKEP ,KCKEPN,KXNRMZ,KXNRMC,KFSCEP,KFSCND,   &
     &              KAREA ,KXMASS,KRMSPO,KTCOEF,KTXQQ ,KTIEXP,KTXMM ,   &
     &              KTXLL1,KTXSN1,KTS2QQ,KT2M2H,KT2MHJ,KTXKK ,KTSCRH,   &
     &              KPXPK ,KAESHD,KCSAVE,KSSAVE,KCGRVT,KSGRVT,KXDTMC,   &
     &              KDNLT ,KTXSN2,KTNORM,KTWRK1,KTWRK2,KUNORM,KAERLG,   &
     &              KSINCO,KPARLG,KCONST,KBFNRM,KTDNRM,KCSTHT,KTPSTR,   &
     &              KTPSTP,KTPFYW,KPLMGM,KTPXAT,KEAQAT,KEAFSS,KEAINS,   &
     &              KACS  ,KECS  ,KSOLNA,KSOLNE,KSVECT,KSFLUX,KFACTX,   &
     &              KFACTY,KADIST,KGEOAN,KPALB ,KALBCO,KEMMCO,KCNAUX,   &
     &              KSNAUX,KPPER ,KACOSW,KBSINW,KACOFW,KBCOFW,KANGWT,   &
     &              KWT   ,KPLNDX,KPLANC,KTGACC,KTGDRG,KTGSLR,KWTACC,   &
     &              KWTDRG,KWTSLR,KTMACC,KTMDRG,KTMSLR,KATTUD,KDYACT,   &
     &              KACCBT,KACPER,KXDDNC,KXDDAO,KXNC  ,KXPPNC,KSMXNC,   &
     &              KXDDTH,KPDDTH,KXSSBS,KCPPNC,KEXACT,KXACIN,KXACOB,   &
     &              KPXHDT,KTPXTH,KPACCL,KTXSTA,KDELXS,KSMRNC,KPRX  ,   &
     &              KSMRNP,KDSROT,KXUGRD,KYUGRD,KZUGRD,KSUMRC,KXDDRC,   &
     &              KTMOS0,KTMOS, KTMOSP,KSMXOS,KSGTM1,KSGTM2,KSMPNS,   &
     &              KXGGRD,KYGGRD,KZGGRD,KXEGRD,KYEGRD,KZEGRD,KSSDST,   &
     &              KSDINS,KSDIND,KSSDSR,KSSDDG,KTATHM,KTAINS,KTAFSS,   &
     &              KSRAT ,KTRAT ,KHLDV ,KHLDA1,KHLDA4,KHLDA7,KQAST1,   &
     &              KQAST2,KQAST3,KQAST4,KQAST5,KQAST6,NXCA01
      COMMON/CORA02/KFSCTB,KFSCTC,KFSCTE,KDSECT,                        &
     &              KFSECT,KS    ,KCIP  ,KCIV  ,                        &
     &       KXTN  ,KXSM  ,KXTK  ,KXSJ  ,KXTI  ,KXTKP ,                 &
     &       KVTN  ,KVSM  ,KVTK  ,KVSJ  ,KVTI  ,KVTKP ,                 &
     &       KSATLT,KSATLN,KSATH ,KCOSTH,KSINTH,                        &
     &       KPXPFM,KPXPFK,KPXPFJ,KTRBF ,KFSTRC,                        &
     &       KFSTRE,KDSCTR,KFSCVS,KXSMBF,KXSKBF,KXSJBF,                 &
     &       KRSSV1,KRSSV2,KRSSV3,KTPMES,KACOEF,KACTIM,                 &
     &       KXTNPC,KXSMPC,KXTKPC,KXSJPC,KXTIPC,KXTKPP,                 &
     &       KRLRNG,KASTO,KASTP,NXCA02
      COMMON/CORA06/KPRMV ,KPNAME,KPRMV0,KPRMVC,KPRMVP,KPRMSG,KPARVR,   &
     &              KPRML0,KPDLTA,KSATCV,KSTACV,KPOLCV,KTIDCV,KSUM1 ,   &
     &              KSUM2 ,KGPNRA,KGPNRM,KPRSG0,KCONDN,KVELCV,          &
     &              KSL2CV,KSH2CV,KTIEOU,KPRMDF,NXCA06
      COMMON/CORI01/KMJDS0,KMJDSB,KMJDSC,KMJDSV,KIBACK,KIBAKV,KIORDR,   &
     &              KIORDV,KNOSTP,KNOCOR,KNSAT ,KN3   ,KNEQN ,KNEQN3,   &
     &              KNH   ,KNHV  ,KNSTPS,KNSTPV,KICPP ,KICPV ,KICCP ,   &
     &              KICCV ,KICCPV,KICCVV,KISUMX,KIXDDT,KISMPX,KIPXDD,   &
     &              KNMAX ,KNTOLD,KNTOLO,KICNT ,KISNT ,KMM   ,KKK   ,   &
     &              KJJ   ,KHH   ,KIBDY ,KSIGN1,KSIGN2,KLL   ,KQQ   ,   &
     &              KIORFR,KIPDFR,KITACC,KJSAFR,KJSPFR,KMJDEP,KMJDND,   &
     &              KNVSTP,KNSTRN,KNDARK,KTIPPT,KTJBDY,                 &
     &              KICNTA,KISNTA,KISHDP,KIPTC ,KIPTS ,KIGTSR,KIXTMC,   &
     &              KTIPTT,KTNOSD,KTQNDX,KTLL1 ,KTJJBD,KTITDE,KTCNTR,   &
     &              KTNN  ,KITACX,KNMOVE,KPANEL,KPLPTR,KNADAR,KNADSP,   &
     &              KNADDF,KNADEM,KNADTA,KNADTC,KNADTD,KNADTF,KNADTX,   &
     &              KITPMD,KSCATT,KITPAT,KILTPX,KEASBJ,KEANMP,KEANAN,   &
     &              KEAPMP,KEAPAN,KEAMJS,KEAPPP,KEAAAA,KICNTT,KISNTT,   &
     &              KTPGRC,KTPGRS,KTPC  ,KTPS  ,KALCAP,KEMCAP,KNSEG ,   &
     &              KICNTP,KISNTP,KNRDGA,KNRDDR,KNRDSR,KIRDGA,KIRDRG,   &
     &              KIRSLR,KSTRTA,KSTRTD,KSTRTS,KDYNPE,KACCPE,KIBCKN,   &
     &              KNRAT ,KIXDDN,KISMXN,KDXDDN,KDSMXN,KICPPN,KACSID,   &
     &              KNEQNH,KHRFRC,KPTFBS,KPTFSB,KIPXDA,KIACCP,KXSTAT,   &
     &              KPXST ,KSALST,KMAPLG,KNMBUF,KSTEPS,KSGMNT,KSATIN,   &
     &              KMEMST,KNEQNI,KBUFIN,KWEMGA,KWEMDR,KTPATS,KTANMP,   &
     &              KTAPPP,KTAMJS,KTASID,KGPSID,KNSSVA,KPNALB,KBRAX1,   &
     &              KBRAX2,KBRAX3,NXCI01
      COMMON/CORI02/KNTIME,KMJSTB,KMJSTC,KMJSTE,KISECT,                 &
     &              KINDH ,KNMH  ,KIVSAT,KIPXPF,KNTRTM,KMSTRC,          &
     &              KMSTRE,KISCTR,KISATR,KITRUN,KTRTMB,KTRTMC,          &
     &              KMJDVS,KNTMVM,NXCI02
      COMMON/CORI04/KNMP  ,KINDP ,KNDPAR,KNPVCT,KISATN,KISET ,KIANTO,   &
     &              KISATO,KIANTD,KISATD,KISTAD,KISATC,KMJDCG,KISTAT,   &
     &              KMJDEB,KMJDBN,KNDBIN,KNWTDB,KIXPAR,KNDBUF,KSSTNM,   &
     &              KSSTNA,KMBSAT,KMBSTA,KXKEY ,KXVKEY,KXFLAG,KIPNTF,   &
     &              KIPNTS,KNCON ,KKF   ,KIDATB,KNSTLV,KSLVID,KLLBIA,   &
     &              KTMRA1,KTMRA2,KIND1 ,KTARID,KATARD,KYAWID,KXOBLK,   &
     &              KDSCWV,KATRSQ,KATSAT,KKVLAS,KPARTP,KLTMSC,KLTASC,   &
     &              KCTBST,KSTBST,KANCUT,KANGPS,KANTYP,                 &
     &              KANTOF,                                             &
     &              KYSAT, KMBDEG,                                      &
     &              KMBNOD,KMBSST,KBSPLN,KSSPLN,KXIOBS,KIDLAS,KIAVP ,   &
     &              KXNAVP,KNEXCG,KIDEXC,KNREXC,KTELEO,KIKEY ,KIMKEY,   &
     &              KIMBLK,KIMPRT,KCN110,KCN111,KC110,KC111,KTDSAT,     &
     &              KTDANT,NXCI04
      COMMON/CORL01/KLORBT,KLORBV,KLNDRG,KLBAKW,KLSETS,KLAFRC,KLSTSN,   &
     &              KLSNLT,KLAJDP,KLAJSP,KLAJGP,KLTPAT,KEALQT,KLRDGA,   &
     &              KLRDDR,KLRDSR,KFHIRT,KLSURF,KHRFON,KLTPXH,KSETDN,   &
     &              KTALTA,NXCL01
      COMMON/CORL02/KLNDTT,KLWSTR,KLNDTR,KLEVMF,KLTPMS,NXCL02
      COMMON/IOS/ISTOS1,ISTOS2,ISTOS3,ISTLST,INTSUB(3),JNTSUB(3),      &
     &        ILSTSG(80),INTOSP,MAPSAT(3,4)
      COMMON/NEQINT/NINTOT,MEMTOT,NEQNIM,NXNEQS
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      COMMON/OASAT/IOASAT(100),NOASAT
      COMMON/XEPHMI/IBLKXE,IBLKXL,IBLKXP(2),IXEPRW,IXEPRD,              &
     &              IXEPB1,IXEPB2,IXBFS(2),IXBFE(2),                    &
     &              MJXEPS,IXPSAT(200),NXPSAT,MXPBFR,                   &
     &              NEPPBK,IXEPEF,IUNTXE,NXXEPH
      COMMON/XOVER /KXKNT,KXBST,KXOBL,KXBUP,KXBPA,IAPLSC,IAPLL
      COMMON/XOVER2/KAPSCL
!
      DIMENSION AA(1),II(1),LL(1)
      DIMENSION FSECIN(1)
      DIMENSION IATSAT(NASAT)
      DIMENSION KVLAS(10,NASAT)
      DIMENSION ATIME(NASAT,MAXAT)
      DIMENSION IRETB(2)
      DIMENSION ATPER(1)
      DIMENSION XSAT(6)
!
!!!!! DATA LOA/.TRUE./
!
!
!
!********1*********2*********3*********4*********5*********6*********7**
! START OF EXECUTABLE CODE
!********1*********2*********3*********4*********5*********6*********7**
!
      IAPLSC=0
      IAPLL=0
      LRET=.TRUE.

!
! CHECK FOR MEASUREMENT TYPES THAT CAN CUT ATITUDE PARTIALS
!
      IF(MTYPE.EQ.33.OR.MTYPE.EQ.34.OR.MTYPE.GE.99) LRET=.FALSE.
!
! RADAR ALTIMETRY IN RUNS WITH NO ATITUD PARAMETERS  GETS A PASS
      IF(MTYPE.GE.99.AND..NOT.LXATTD.AND..NOT.LATMOD.AND.NASAT.LE.0)    &
     &LRET=.TRUE.
!
      IF(LRET) RETURN
!
! THIS IS A MEASUREMENT TYPE THAT CAN CUT ATITUDE PARTIALS THEN
! THIS BLOCK OF OBSERVATIONS MUST INVOLVE A SATELLITE WITH
! SPACECRAFT BODY AND LASER/CAMERA ATTITUDE PARAMETERS. WORD 4
! OF THE MASTER HEADER RECORD OF THIS BLOCK OF DATA MUST POINT
! TO A VALID LASER/CAMERA PARAMETER OF THE SATELLITE
!
!
!
      ISATID=II(KISATN-1+INDSAT)
      LOA=.FALSE.
      DO I=1,NOASAT
        IF(ISATID.EQ.IOASAT(I)) THEN
          LOA=.TRUE.
          GO TO 5
        ENDIF
      ENDDO
  5   CONTINUE
!
      DO  I=1,2
       IRETB(I)=0
      ENDDO
!
! NASAT IS THE NUMBER OF SATELLITES THAT HAVE ATTITUD PARAMETERS
! IN A RUN WITH LASER OR CAMERA DATA, NASAT MUST BE GREATER THAN 0
      IF(NASAT.LE.0) THEN
        WRITE(6,6000) MTYPE
        WRITE(6,6001) ISATID
        WRITE(6,6002)
        WRITE(6,6003)
        WRITE(6,6004)
        STOP 69
      ENDIF
!
!  CHECK SATELLITE ID TO SEE IF IT CARRIES ATITUDE PARAMETERS
      CALL FNDNUM(ISATID,IATSAT,NASAT,IRETB(1))
      IF(IRETB(1).EQ.0) THEN
       WRITE(6,6000) MTYPE
       WRITE(6,6001) ISATID
       WRITE(6,6002)
       WRITE(6,6003)
       WRITE(6,6005) ISATID
       STOP 69
      ENDIF
!
! MAKE SURE THE RUN HAS LASER ATITUDE PARAMETERS DEFINED
      IF(MAXLAS.LE.0) THEN
         WRITE(6,6000) MTYPE
         WRITE(6,6001) ISATID
         WRITE(6,6002)
         WRITE(6,6003)
         WRITE(6,6009)
         STOP
      ENDIF
!
! AT THIS POINT THERE ARE LASER ATITUDE PARAMETERS IN THJE RUN
! NOW SEE IF THIS MEASUREMENT HAS A LASER OR CAMERA ATITUDE DEFINED
!
      ILASID=-9999
      JLASID=INT(BLKDAT(4,1)+0.01D0)
      JLASID=MOD(JLASID,10)
      IF(JLASID.GT.0) ILASID=JLASID
      CALL FNDNUM(ILASID,KVLAS(1,IRETB(1)),10,IRETB(2))
      IF(IRETB(2).EQ.0) THEN
        WRITE(6,6000) MTYPE
        WRITE(6,6001) ISATID
        WRITE(6,6002)
        WRITE(6,6003)
        WRITE(6,6006)
        WRITE(6,6007)
        WRITE(6,6008)
        WRITE(6,6019)
        WRITE(6,6020) JLASID
        NQ=0
        DO IQP=1,10
         IF(KVLAS(IQP,IRETB(1)).GT.0) NQ=NQ+1
        ENDDO
        IF(NQ.EQ.0) THEN
          WRITE(6,6021)
        ELSE
          WRITE(6,6022) NQ
          DO IQP=1,NQ
          WRITE(6,6023) KVLAS(IQP,IRETB(1))
          ENDDO
        ENDIF
        STOP 16
      ENDIF
!
! AT THIS POINT WE ARE DEALING WITH A CAMERA OR LASER MEASUREMENT
! AND THE SATELLITE AND LASER OR CAMERA ATITUDE PARAMETERS ARE
! DEFINED AND MATCHED TO THE BLOCK OF TRACKING DATA
!
!  FIND OUT TO WHICH ATITUDE PERIOD IT BELONGS
!
! THE FOLLOWING IS AN APPROXIMATE WAY TO DEAL WITH POINTERS INDEXED BY
! TIME PERIODS, BUT WE DO IT ANYWAY.
! DETERMINE TIME PERIOD USING MID POINT OF BLOCK AND NOT EACH OBS
!
      IMID=(NM/2)+1
      TBEST=DBLE(MJDSIN)+FSECIN(IMID)
!... STARTING EPOCH USED FOR BASE FOR FIRST TIME PERIOD
      EPOCH=DBLE(II(KMJDS0+INDSAT-1))+AA(KFSEC0+INDSAT-1)
!
      IF(.NOT.LOA) THEN
! STANDARD TIME PERIOD APPROACH
        DO J=1,MAXAT
         IF(TBEST.LE.ATIME(IRETB(1),J)) THEN
          INDXX=J
          EXIT
         ENDIF
        END DO
      ELSE
!
! ORBIT ANGLE APPROACH; FOR THIS USE A KEPLER ORBIT TO FIGURE
! WHICH ORBIT ANGLE INTERVAL APPLIES
        ETIME=TBEST-EPOCH
!
! FIRST HAVE TO GET SAT STATE (AT LEAST APPROX)
        LX=.FALSE.
        IF(NXPSAT.GT.0) THEN
          DO I=1,NXPSAT
            IF(ISATID.EQ.IXPSAT(I)) LX=.TRUE.
          ENDDO
        ENDIF
        IF(LX) THEN
          CALL GETAST(AA,ISATID,MJDSIN,FSECIN(IMID),XSAT)
        ELSE
!!!!!     CALL ANORB(AA,INDSAT,ETIME,XSAT)
          IRET1 = 1
          IF (NINTOT > 0) THEN
              CALL FNDNUM(ISATID, II(KSATIN), NINTOT, IRET1)
              IF (IRET1 > 0) THEN
                  KSUMXOS = MAPSAT(INTOSP, 1)
                  KSUMPOS = MAPSAT(INTOSP, 2)
                  KXDDTOS = MAPSAT(INTOSP, 3)
                  KPDDTOS = MAPSAT(INTOSP, 4)
                  KNSTEPS = II(KSTEPS-1 + IRET1)
                  NEQNI = II(KNEQNI-1 + IRET1)
              END IF
          END IF
          CALL ORBSET(II(KNSAT), II(KIVSAT), LL(KLSETS), INDSAT,        &
                      KNSTEPS, NEQNI, II(KSGMNT-1+IRET1),               &
                      AA(KSGTM1-1+IRET1),AA(KSGTM2-1+IRET1),IRET1,      &
                      MJDSIN, FSECIN(IMID), FSECN, 1, AA,II)
          CALL ORBIT(MJDSIN, FSECIN(IMID), AA(KS), 1, II(KINDH),        &
              II(KNMH),II(KMJDSC), AA(KFSEC), II(KMJDSV), AA(KFSECV), &
              LL(KLSETS), II(KIPXPF), II(KIVSAT), 1, II(KNMAX), &
              II(KNTOLD), AA(KXSM), AA(KPXPFM), .FALSE., .FALSE.,       &
              II(KPLPTR),II(KPANEL), II(KNMOVE), AA(KTPMES+4*MINTIM), &
              LL(KLTPMS+6*MINTIM), LL(KSETDN), AA(KTMOS0-1+INTOSP), &
              AA(KTMOS-1+INTOSP), AA(KTMOSP-1+INTOSP), &
              AA(KSMXOS-1+KSUMXOS), AA(KSMXOS-1+KSUMPOS), &
              AA(KSMXOS-1+KXDDTOS), AA(KSMXOS-1+KPDDTOS), KNSTEPS, &
              NEQNI, II(KSGMNT-1+IRET1), AA(KSGTM1-1+IRET1), &
              AA(KSGTM2-1+IRET1), AA, II, LL)
          XSAT(1)=AA(KXSM)
          XSAT(2)=AA(KXSM+MINTIM)
          XSAT(3)=AA(KXSM+2*MINTIM)
          XSAT(4)=AA(KVSM)
          XSAT(5)=AA(KVSM+MINTIM)
          XSAT(6)=AA(KVSM+2*MINTIM)
        ENDIF
!
        CALL OA(TBEST,XSAT(1),XSAT(2),XSAT(3),XSAT(4),XSAT(5),XSAT(6),  &
     &          AA,II,OATS)
        DO J=1,MAXAT
         TC=MOD(ATIME(IRETB(1),J),86400.D0)
         IF(OATS.LE.TC) THEN
          INDXX=J
          EXIT
         ENDIF
        END DO
! ENDIF FOR IF(.NOT.LOA) THEN
      ENDIF
!
! INDXAT IS THE ATITUDE PERIOD NUMBER FOR THIS SATELLITE
! AND THIS BLOCK OF OBSERVATIONS
      INDXAT=INDXX
!
!
! MAXAT IS THE MAXIMUM # OF ATITUDE PERIODS. THE ABOVE TESTS
! SHOW THAT THERE ARE ATITUDE ATITUDE PARAMETRS SO MAXAT
! MUST BE AT LEAST 1 AND IRETB(1) MUST ALSO BE AT LEAST 1
!
! IADD IS THE STARTING POSITION OF THE SPACERAFT BODY IN THE
! ARRAY OF ATTITUDE PARAMETERS
!
      MAXBOD=MAXLAS+1
      IADD=(MAXAT*MAXBOD*15)*(IRETB(1)-1)
!
      IAPLSC=IPVAL0(IXATUD)+IADD+(15*MAXBOD)*(INDXAT-1)
      IAPLL=IAPLSC+15*IRETB(2)
!
      SIG1=0.D0
      SIG2=0.D0
      IF(IAPLSC.GT.0) THEN
         DO I=1,15
           SIGX=AA(KPRSG0-2+IAPLSC+I)
           IF(SIGX.GT.SIG1) SIG1=SIGX
         ENDDO
      ENDIF
      IF(IAPLL.GT.0) THEN
         DO I=1,15
           SIGX=AA(KPRSG0-2+IAPLL+I)
           IF(SIGX.GT.SIG2) SIG2=SIGX
         ENDDO
      ENDIF
      KAPSCL=IAPLSC
      IF(SIG2.GT.SIG1) KAPSCL=IAPLL
!
      RETURN
6000  FORMAT(' TERMINATION IN SUBROUTINE ATPARP FOR MT ',I4)
6001  FORMAT(' AND SATELLITE ID ',I8)
6002  FORMAT(' THIS MEASUREMENT TYPE REQUIRES ATITUD PARAMETERS')
6003  FORMAT(' DESCRIBING A LASER OR CAMERA TRACKING PT')
6004  FORMAT(' NO SATS IN THIS RUN HAVE ATITUDE PARAMETERS')
6005  FORMAT(' SATELLITE ',I8,' HAS NO ATITUD PARAMETERS')
6006  FORMAT(' A BLOCK OF LASER OR CAMERA DATA ASSOCIATED WITH THIS')
6007  FORMAT(' SATELLITE DID NOT HAVE A LASER OR CAMERA ID ON WORD 4')
6008  FORMAT(' THAT MATCHES THE LASER ATTITUDE PARAMETERS FOR THIS ')
6009  FORMAT(' THERE ARE NO LASER ATITUDE PARAMETERS IN THIS RUN')
6019  FORMAT(' SATELLITE')
6020  FORMAT(' LASER ID ON BLOCK HEADER: ',I8)
6021  FORMAT(' NO LASER ATITUDE PARAMETERS FOR THIS SATELLITE')
6022  FORMAT(' THIS SAT HAS ',I4,' LASER ATTITIDE GROUPS:')
6023  FORMAT(' ',I4)
      END
