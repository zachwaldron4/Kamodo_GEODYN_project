!$CHNAT
      SUBROUTINE CHNAT(PXEPAN,PXEPA,NDM1,NDM2,NDM3,LNPNM,NM,IP0AT,TIME, &
     &                 PER,LAVOID)
!********1*********2*********3*********4*********5*********6*********7**
! CHNAT              00/00/00            0000.0    PGMR -DAVE ROWLANDS
!
! FUNCTION:
!              CHAIN AND INSERT PARTIALS OF ECF COORDINATES WRT ROLL PIT
!              INTO THE THE ARRAY OF ARRAY OF PARTIALS OF ECF COORDINATE
!              WRT ALL ADJUSTING PARAMETERS. ROUTINE IS CALLED FOR EACH
!              ECF COORDINATE. PARTIALS WRT ANGLES ARE ALSO EXPANDED FOR
!              LINEAR AND QUADRATIC TERMS
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!
!     PXEPAN        PARTIALS OF ECF COORDINATE WRT ROLL PITCH YAW
!     PXEPA         PARTIALS OF ECF COORDINATE WRT ALL ADJUSTING PARAMTE
!     NDM1          FIRST DIMENSION OF PXEPA ARRAY (NADJST IF LNPNM IS T
!                   NM OTHERWISE)
!     NDM2          SECOND DIMENSION OF PXEPA ARRAY (NM IF LNPNM IS TRUE
!                   NADJST OTHERWISE)
!     NDM3          FIRST DIMENSION OF PXEPAN ARRAY (GREATER THAN OR EQ
!     LNPNM         IF TRUE PARTIALS HAVE NADJST  AS FIRST DIMENSION
!     NM            NUMBER OF TIMES BEING USED
!     IP0AT         STARTING LOCATION OF ATTITUDE PARTIALS IN ADJUSTED P
!                   ARRAY (THIS ROUTINE LOADS 9 PARAMETERS (PARTIALS) AT
!     TIME          TIMES AT WHICH THE ATTITUDE PARTIALS ARE BEING APPLI
!                   REFERENCED FROM START OF ATTITUDE PERIOD
!
!********1*********2*********3*********4*********5*********6*********7**
!
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
      COMMON/CONSTR/PI,TWOPI,DEGRAD,SECRAD,SECDAY
!
      DIMENSION PXEPAN(NDM3,3)
      DIMENSION PXEPA(NDM1,NDM2)
      DIMENSION TIME(NM)
      DIMENSION LAVOID(1)
!
!
!**********************************************************************
! START OF EXECUTABLE CODE ********************************************
!**********************************************************************
!
       DO IQP=1,15
         LAVOID(IP0AT-1+IQP)=.FALSE.
       ENDDO
      IF(LNPNM) GO TO 300
      DO 200 K=1,3
      IPT1=IP0AT+(K-1)*5
      IPT2=IP0AT+(K-1)*5+1
      IPT3=IP0AT+(K-1)*5+2
      IPT4=IP0AT+(K-1)*5+3
      IPT5=IP0AT+(K-1)*5+4
      DO 100 I=1,NM
      IF(PER.GT.0.D0) THEN
      WT=(TWOPI/PER)*TIME(I)
      SINWT=SIN(WT)
      COSWT=COS(WT)
      ELSE
      SINWT=0.D0
      COSWT=0.D0
      ENDIF
      PXEPA(I,IPT1)=PXEPA(I,IPT1)+PXEPAN(I,K)
      PXEPA(I,IPT2)=PXEPA(I,IPT2)+PXEPAN(I,K)*TIME(I)
      PXEPA(I,IPT3)=PXEPA(I,IPT3)+PXEPAN(I,K)*TIME(I)*TIME(I)
      PXEPA(I,IPT4)=PXEPA(I,IPT4)+PXEPAN(I,K)*SINWT
      PXEPA(I,IPT5)=PXEPA(I,IPT5)+PXEPAN(I,K)*COSWT

  100 END DO
  200 END DO
      RETURN
!
  300 CONTINUE
      DO 500 K=1,3
      IPT1=IP0AT+(K-1)*5
      IPT2=IP0AT+(K-1)*5+1
      IPT3=IP0AT+(K-1)*5+2
      IPT4=IP0AT+(K-1)*5+3
      IPT5=IP0AT+(K-1)*5+4
      DO 400 I=1,NM
      IF(PER.GT.0.D0) THEN
      WT=(TWOPI/PER)*TIME(I)
      SINWT=SIN(WT)
      COSWT=COS(WT)
      ELSE
      SINWT=0.D0
      COSWT=0.D0
      ENDIF
      PXEPA(IPT1,I)=PXEPA(IPT1,I)+PXEPAN(I,K)
      PXEPA(IPT2,I)=PXEPA(IPT2,I)+PXEPAN(I,K)*TIME(I)
      PXEPA(IPT3,I)=PXEPA(IPT3,I)+PXEPAN(I,K)*TIME(I)*TIME(I)
      PXEPA(IPT4,I)=PXEPA(IPT4,I)+PXEPAN(I,K)*SINWT
      PXEPA(IPT5,I)=PXEPA(IPT5,I)+PXEPAN(I,K)*COSWT
  400 END DO
  500 END DO
      RETURN
      END
