!$EBSMST
      SUBROUTINE EBSMST(RESIDU,RESID ,OBSSIG,RATIO ,EDTSIG,LEDIT ,      &
     &           WEIGHT,NM    ,PMPE  ,ATWA  ,ATWD  ,ETWE  ,ETWD  ,      &
     &           EBSTAT,INDEXX,NINDEX,SCRTCH)
!********1*********2*********3*********4*********5*********6*********7**
! EBSMST           00/00/00            0000.0    PGMR - ?
!
!
! FUNCTION:
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   RESIDU
!   RESID
!   OBSSIG
!   RATIO
!   EDTSIG
!   LEDIT
!   WEIGHT
!   NM
!   PMPE
!   ATWA
!   ATWD
!   ETWE
!   ETWD
!   EBSTAT
!   INDEXX
!   NINDEX
!   SCRTCH
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
      PARAMETER ( ONE = 1.0D0 )
!
      COMMON/CEBGLB/MEPARM,MEDIM ,MEBIAS,MBIASE,NEBGRP,IEBGRP(4),NXCEBG
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
!
      DIMENSION RESIDU(NM),RESID(NM),OBSSIG(NM),RATIO(NM),EDTSIG(NM),   &
     &   LEDIT(NM),WEIGHT(NM),PMPE(MINTIM,MEPARM),EBSTAT(MEPARM,2),     &
     &   INDEXX(NINDEX),ATWA(MEDIM),ATWD(MEPARM),                       &
     &   SCRTCH(MINTIM),ETWE(MEDIM),ETWD(MEPARM)
!
!**********************************************************************
! START OF EXECUTABLE CODE ********************************************
!**********************************************************************
!
!     PRINT 12345,NM,NINDEX,INDEXX
!12345 FORMAT(' ** EBSMST **  NM,NINDEX,INDEXX =',5I12)
!     PRINT 12346,RESIDU
!12346 FORMAT(' ** EBSMST **  RESIDU ='/(1X,5G24.16))
!     PRINT 12347,((PMPE(I,J),J=1,3),I=1,NM)
!12347 FORMAT(' ** EBSMST **  PMPE ='/(1X,3G24.16))
!
      DO 1000 N=1,NM
      WEIGHT(N)=ONE
 1000 END DO
!
! COMPUTE CORRECTION SUMS FOR RESIDUAL MEAN
      CALL EBSUMR(WEIGHT,PMPE  ,NM    ,INDEXX,NINDEX,EBSTAT(1,1))
!
! COMPUTE CORRECTION SUMS FOR RESIDUAL RMS
      CALL EBSUMS(PMPE,RESIDU,WEIGHT,NM,NINDEX,ATWA,ATWD,SCRTCH)
!
! COMPUTE CORRECTION SUMS FOR WEIGHTED MEAN
      NMWTD=0
      DO 2000 N=1,NM
      IF(LEDIT(N)) GO TO 2000
      NMWTD=NMWTD+1
      RATIO(NMWTD)=ONE/OBSSIG(N)
 2000 END DO
      IF(NMWTD.LE.0) RETURN
      CALL EBSUMR(RATIO ,PMPE  ,NMWTD ,INDEXX,NINDEX,EBSTAT(1,2))
!
! COMPUTE CORRECTION SUMS FOR EDITING RMS
      NMWTD=0
      DO 3000 N=1,NM
      IF(LEDIT(N)) GO TO 3000
      NMWTD=NMWTD+1
      RATIO(NMWTD)=RESID(N)
      WEIGHT(NMWTD)=ONE/EDTSIG(N)**2
 3000 END DO
      CALL EBSUMS(PMPE,RATIO ,WEIGHT,NMWTD,NINDEX,ETWE,ETWD,SCRTCH)
      RETURN
      END
