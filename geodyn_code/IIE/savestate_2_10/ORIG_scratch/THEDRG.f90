!$THEDRG
      SUBROUTINE THEDRG(ACCEL,CKEPLR,MJDS0,FSEC0,MJDSEC,FSEC,XP,PXDDOT, &
     &                  NEQN)
!********1*********2*********3*********4*********5*********6*********7**
! THEDRG           90/06/04            0000.0    PGMR - LUCIA TSAOUSSI
!
! FUNCTION:  COMPUTE THERMAL 'DRAG' ACCELERATION ON LAGEOS
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   ACCEL    O         THERMAL DRAG ACCELERATION
!   CKEPLR   I         KEPLERIAN ELEMENTS AT EPOCH
!   MJDS0    I         DATE & INTEGRAL SECONDS OF INITIAL EPOCH
!   FSEC0    I         FRACTIONAL SECONDS OF INITIAL EPOCH
!   MJDSEC   I         CURRENT DATE AND INTEGRAL SECONDS OF TIME
!   FSEC     I         FRACTIONAL SECONDS OF INITIAL EPOCH
!   XP
!
! COMMENTS:
!     ....modified to compute partials to solve for spin axis direction
!     ....by DDR  11/92
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION(A-H,O-Z),LOGICAL(L)
      SAVE
      DIMENSION ACCEL(3),CKEPLR(6),XP(3,1,2),PKPX(6,6),PXDDOT(NEQN,3)
!
      COMMON/CGRAV/GM,AE,AESQ,FE,FFSQ32,FSQ32,XK2,XK3,XLAM,SIGXK2,      &
     &      SIGXK3,SIGLAM,RATIOM(2),AU,RPRESS
      COMMON/CITER /NINNER,NARC,NGLOBL
      COMMON/CONSTR/PI,TWOPI,DEGRAD,SECRAD,SECDAY
      COMMON/CRMI/RMI(9)
      COMMON/CTHERM/DELTA,SX,SY,SZ,SCALE,THDAEI(6),THDSEC(2)
      COMMON/ITHERM/IDGSTN,NARC0
      COMMON/ITHRMP/ITHPAR
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      COMMON/THERMD/DRGSAT,DTHSC,ZETA,SPAXT,SPAXL,THRMFL,XTHERM
!
      DATA DTMAX/43200.00/,ZERO/0.0/
!
!***********************************************************************
! START OF EXECUTABLE CODE *********************************************
!***********************************************************************
!
!
!  COMPUTE CONSTANTS ONCE PER ARC
!      IF (NARC0.NE.NARC) THEN
!  INITIALIZE THE TIME AND KEPLERIAN ELEMENTS ARRAY
!      IF (MJDSEC.NE.MJDS0.AND.FSEC.NE.FSEC0) GO TO 200
!      DO 100 I=1,6
!  100 THDAEI(I)=CKEPLR(I)
!      THDSEC(1)=MJDS0
!      THDSEC(2)=FSEC0
!  200 CONTINUE
      RADT=SPAXT*DEGRAD
      RADL=SPAXL*DEGRAD
      DELTA=ATAN(ZETA)
      SRADT=SIN(RADT)
      SX=SRADT*COS(RADL)
      SY=SRADT*SIN(RADL)
      SZ=COS(RADT)
      SCALE=-DTHSC/SQRT(1.D0+ZETA**2)
!
      NARC0=NARC
!      ENDIF
!
      DT=MJDSEC+FSEC-THDSEC(1)-THDSEC(2)
!
!      IF (DT.LE.DTMAX) GO TO 300
!  RESET THE KEPLERIAN ELEMENTS EVERY DTMAX SECONDS
      THDSEC(1)=MJDSEC
      THDSEC(2)=FSEC
      CALL ELEM(XP(1,1,1),XP(2,1,1),XP(3,1,1),XP(1,1,2),XP(2,1,2),      &
     &          XP(3,1,2),THDAEI,1,PKPX,GM)
      DT=0.0
  300 CONTINUE
      ETA=SQRT(GM/THDAEI(1)**3)
      RADM=THDAEI(6)+ETA*DT
      COSSUM=COS(THDAEI(5)+RADM-DELTA)
      SINSUM=SIN(THDAEI(5)+RADM-DELTA)
      COSOM=COS(THDAEI(4))
      SINOM=SIN(THDAEI(4))
      COSI=COS(THDAEI(3))
!
      RDX=COSOM*COSSUM-COSI*SINOM*SINSUM
      RDY=SINOM*COSSUM+COSI*COSOM*SINSUM
      RDZ=SIN(THDAEI(3))*SINSUM
      SCAL=SCALE*(SX*RDX+SY*RDY+SZ*RDZ)
      ACCEL(1)=SCAL*SX
      ACCEL(2)=SCAL*SY
      ACCEL(3)=SCAL*SZ
!
      IF(NPVAL0(IXTHDR).EQ.0) RETURN
!
!     ....compute partials to solve for spin axis direction
!
      DSXDTH=SZ*COS(RADL)
      DSYDTH=SZ*SIN(RADL)
      DSZDTH=-SRADT
      DSXDRA=-SY
      DSYDRA=SX
      DSZDRA=ZERO
      DSCDTH=SCALE*(RDX*DSXDTH+RDY*DSYDTH+RDZ*DSZDTH)
      DSCDRA=SCALE*(RDX*DSXDRA+RDY*DSYDRA+RDZ*DSZDRA)
      IPTTH=ITHPAR
      IPTRA=ITHPAR+1
      P1=(SX*DSCDTH+SCAL*DSXDTH)*DEGRAD
      P2=(SY*DSCDTH+SCAL*DSYDTH)*DEGRAD
      P3=(SZ*DSCDTH+SCAL*DSZDTH)*DEGRAD
      PXDDOT(IPTTH,1)=RMI(1)*P1+RMI(2)*P2+RMI(3)*P3
      PXDDOT(IPTTH,2)=RMI(4)*P1+RMI(5)*P2+RMI(6)*P3
      PXDDOT(IPTTH,3)=RMI(7)*P1+RMI(8)*P2+RMI(9)*P3
      P1=(SX*DSCDRA+SCAL*DSXDRA)*DEGRAD
      P2=(SY*DSCDRA+SCAL*DSYDRA)*DEGRAD
      P3=(SZ*DSCDRA+SCAL*DSZDRA)*DEGRAD
      PXDDOT(IPTRA,1)=RMI(1)*P1+RMI(2)*P2+RMI(3)*P3
      PXDDOT(IPTRA,2)=RMI(4)*P1+RMI(5)*P2+RMI(6)*P3
      PXDDOT(IPTRA,3)=RMI(7)*P1+RMI(8)*P2+RMI(9)*P3
      RETURN
      END
