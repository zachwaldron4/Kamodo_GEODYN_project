!$EMTHDR
      SUBROUTINE EMTHDR(IUNT,XHEADR,LPARFI,XTDIM)
!********1*********2*********3*********4*********5*********6*********7**
! EMTHDR           84/07/06            8407.0    PGMR - WFE
!                  86/03/27            8603.0    PGMR - TOM MARTIN
!
! FUNCTION:  OUTPUT E-MATRIX HEADER RECORD OR PARTIAL DERIVATIVE
!            FILE HEADER RECORD
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   IUNT     I    S    UNIT NO. FOR WRITING HEADER RECORD
!   XHEADR   I    A    TEMPORARY ARRAY USED TO STORE HEADER
!                      INFORMATION
!   LPARFI   I    S    LOGICAL SWITCH WHICH INDICATES WHICH TYPE
!                      OF HEADER.
!                      .TRUE.=PARTIAL FILE  .FALSE.=E-MATRIX
!   XTDIM    I    S    DIMENSION OF XTIE INFORMATION (TO BE WRITTEN
!                      ON PARM LABEL RECORDS
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
      COMMON/CITERL/LSTGLB,LSTARC,LSTINR,LNADJ ,LITER1,LSTITR,          &
     &              LOBORB,LRESID,LFREEZ,LSAVEF,LHALT,LADJPI,LADJCI
      COMMON/CLIGHT/VLIGHT,ERRLIM,XCLITE
      COMMON/CNIARC/NSATA,NSATG,NSETA,NEQNG,NMORDR,NMORDV,NSORDR,       &
     &              NSORDV,NSUMX,NXDDOT,NSUMPX,NPXDDT,NXBACK,NXI,       &
     &              NXILIM,NPXPF,NINTIM,NSATOB,NXBCKP,NXTIMB,           &
     &              NOBSBK,NXTPMS,NXCNIA
      COMMON/CSTATA/RMSTOT,RMSEDT,RMSGLB
      COMMON/CSTATI/NOBTOT,NOBWTD,NAPTOT,NCUTOF
      COMMON/CVIEW /IOUT6 ,ILINE6,IPAGE6,MLINE6,                        &
     &              IOUT8 ,ILINE8,IPAGE8,MLINE8,                        &
     &              IOUT9 ,ILINE9,IPAGE9,MLINE9,                        &
     &              IOUT10,ILIN10,IPAG10,MLIN10,                        &
     &              IOUT15,ILIN15,IPAG15,MLIN15,                        &
     &              IOUT16,ILIN16,IPAG16,MLIN16,                        &
     &              IOUT7 ,NXCVUE
      COMMON/DTMGDN/TGTYMD,TMGDN1,TMGDN2,REPDIF,XTMGN
      COMMON/EMAT  /EMTNUM,EMTPRT,EMTCNT,VMATRT,VMATS,VMATFR,FSCVMA,    &
     &              XEMAT
      COMMON/G2EINF/G2EVER,G2EDAT,G2ERTM
      COMMON/G2SINF/G2SVER,G2SDAT,G2SRTM,G2SCOM,TDFVER,TDFRTM,SETCDS,   &
     &              GPCKSM,GPDEG ,GPORD ,XG2SIN
      COMMON/IBODPT/IBDCF(999),IBDSF(999),IBDGM(999),IBDAE(999),    &
     &              IBDPF(999),                                     &
     &              ICBDCF,ICBDSF,ICBDGM,ICBDAE,ICBDPF,             &
     &              ITBDCF,ITBDSF,ITBDGM,ITBDAE,ITBDPF,NXBDPT
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      COMMON/PARFIL/PFSW  ,PFUNT1,PFUNT2,PFNUMB,SEGSIZ,XPARFI
      COMMON/PLNETI/IPLNET(999),IPLNIN(999),MPLNGD(999),MPLNGO(999),   &
     &              IPLNZ(999),NXPLNI
      COMMON/TIEOUT/XSCTIE,XSCTRF,YMDRRF,YMDTRF,XTIE,XTIEOU
      DIMENSION XHEADR(30)
!
      DATA IXH/30/,C0/0.0D0/,CBODY/0300.D0/
!
!**********************************************************************
!* START OF EXECUTABLE CODE *******************************************
!**********************************************************************
      CALL CLEARA(XHEADR,IXH)
      IHDR=0
! NUMBER OF WORDS IN REMAINDER OF RECORD
!     XHEADR(IHDR)=IXH-1
! NEGATIVE OF E-MATRIX NUMBER OR NEGATIVE OF PARTIAL FILE NUMBER
      IHDR=IHDR+1
      XHEADR(IHDR)=-EMTNUM
! NEGATIVE OF E-MATRIX NUMBER  REPEATED AGAIN
      IHDR=IHDR+1
      XHEADR(IHDR)=-EMTNUM
! NUMBER OF ESTIMATED PARAMETERS
      IHDR=IHDR+1
      XHEADR(IHDR)=NPVAL0(IXARC)+NPVAL0(IXGLBL)
! NUMBER OF PARAMETER DESCRIPTOR RECORDS
      IHDR=IHDR+1
      XHEADR(IHDR)=C0
!     IF(LPARFI.AND.LITER1) GO TO 100
! NUMBER OF WEIGHTED OBSERVATIONS
      IHDR=IHDR+1
      XHEADR(IHDR)=NOBWTD
! TOTAL VARIANCE
      RMSTV=RMSTOT*RMSTOT
      RMSTV=RMSTV*(NOBWTD-1-NPVAL0(IXARC))
      IHDR=IHDR+1
      XHEADR(IHDR)=RMSTV
! WEIGHTED VARIANCE
      IHDR=IHDR+1
      XHEADR(IHDR)=RMSTV
! ARC VARIANCE
      IHDR=IHDR+1
      XHEADR(IHDR)=RMSTOT*RMSTOT
! 100 CONTINUE
! NUMBER OF SATELLITES
      IHDR=IHDR+1
      XHEADR(IHDR)=NSATA
! CENTRAL FORCING BODY AND CENTER OF INTEGRATION
      IHDR=IHDR+1
      XHEADR(IHDR)=DBLE(IPLNET(ICBDGM))
! IIS RUN TIME
      IHDR=IHDR+1
      XHEADR(IHDR)=G2SRTM
! IIE RUN TIME
      IHDR=IHDR+1
      XHEADR(IHDR)=G2ERTM
!  SURFACE GRAVITY SWITCH
      IHDR=IHDR+1
      XHEADR(IHDR)=C0
! GEODYN VERSION
      IHDR=IHDR+1
      XHEADR(IHDR)=G2EVER
! NUMBER OF PARAMETER GROUPS
      NGI=0
      IEND=IXTOTL-1
      DO 300 I=2,IEND
      IF(NPVAL0(I).GT.0) NGI=NGI+1
  300 END DO
! SUBTRACT OUT PAIRS SUCH AS E&O TIDE;H2,L2;POLAR MOTION
      NXGEOP=MIN(NPVAL0(IXGPC),1)+MIN(NPVAL0(IXGPS),1)+               &
     &       MIN(NPVAL0(IXGPCT),1)+MIN(NPVAL0(IXGPST),1)-1
      NXGEOP=MAX(NXGEOP,0)
      NGI=NGI-NXGEOP
      IF(NPVAL0(IXETDE).GT.0 .AND. NPVAL0(IXOTDE).GT.0) NGI=NGI-1
      IF(NPVAL0(IXOTPC).GT.0 .AND. NPVAL0(IXOTPS).GT.0) NGI=NGI-1
      IF(NPVAL0(IXH2LV).GT.0 .AND. NPVAL0(IXL2LV).GT.0) NGI=NGI-1
      IF(NPVAL0(IXSSTC).GT.0 .AND. NPVAL0(IXSSTS).GT.0) NGI=NGI-1
      IF(NPVAL0(IXPOLY).GT.0 .AND. NPVAL0(IXUT1 ).GT.0) NGI=NGI-2
      IF(NPVAL0(IXPYDT).GT.0 .AND. NPVAL0(IXUTDT).GT.0) NGI=NGI-2
      IF(NPVAL0(IXGLBL).GT.0) NGI=NGI-1
      IHDR=IHDR+1
      XHEADR(IHDR)=NGI
      IHDR=IHDR+1
      XHEADR(IHDR)=VLIGHT
      IHDR=IHDR+1
      IHDR=IHDR+1
      XHEADR(IHDR)=YMDRRF
      IHDR=IHDR+1
      XHEADR(IHDR)=XTDIM
      IHDR=IHDR+1
      IHDR=IHDR+1
!
!     WORD 20 OF THE EMATRX HEARED RECORD CONTAINS THE AMOUNT BY
!     WHICH ALL THE GLOBAL EMAT LABALS SHOULD MOVE UP.
!
      XHEADR(IHDR)= 1.D+13
      IF(IHDR.GT.IXH) GO TO 61000
      WRITE(IUNT) XHEADR
      RETURN
61000 WRITE(IOUT6,81000) IHDR,IXH
      STOP 16
81000 FORMAT(1X,'ARRAY (XHEADR)  OVERFLOW IN SUBROUTINE EMTHDR',2I5)
      END
