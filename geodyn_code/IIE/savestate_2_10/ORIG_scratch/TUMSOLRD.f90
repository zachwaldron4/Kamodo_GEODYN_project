!$TUMSOLRD.f
      SUBROUTINE TUMSOLRD(MJDSEC,FSEC,ELEM,R,RSQ,APLM,APGM,LORBIT,NEQN, &
     &              ACCSOLRAD,GRPAR,STACC,LAJSP,LSTSUN,NTRANS,NDARKS,   &
     &              AA,II,LL,ISATID,ALAPGM,VMAT,ISATUM,LAVOID)
!********1*********2*********3*********4*********5*********6*********7**
! TUM
!
! FUNCTION:     COMPUTE ACCELERATION DUE TO SOLAR RADIATION
!               FOR GPS SATELLITES USING THE ROCK4 MODEL
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   MJDSEC   I         INTEGER EPHEMERIS SECONDS SINCE GEODYN REF.TIME
!   FSEC     I         FRACTIONAL REMAINING SECONDS
!   ELEM     I         TRUE OF DATE ELEMENTS
!   R        I
!   RSQ      I
!   APLM     I         (AREA/MASS)*(RADIATION PRESSURE AT 1 AU)*(AU**2)
!   APGM     I         (1)CR*APLM,(2)CR DOT*APLM,(3)CR DOUBLE DOT*APLM
!   LORBIT   I         .TRUE. IF ORBGEN RUN
!   NEQN     I         NUMBER OF FORCE MODEL PARAMETERS
!   ACCSOLRADO         TRUE OF DATE ACCELERATION DUE TO SOLAR RAD
!   GRPAR    O         TRUE OF REFERENCE PARTIAL OF ACCELERATION
!                      WRT SOLAR COEFFCIENT
!   STACC    I         START TIMES FOR SOLAR RADIATION PERIODS
!   LAJSP    I         LOGICAL TELLING WHETHER A PARTICULAR PERIOD HAS
!                      BEEN ADJUSTED
!   NTRANS             NUMBER OF LIGHT TO DARK TRANSITIONS BEFORE/AFTER
!                        THIS CALL AS INPUT
!   NDARKS             NUMBER OF STEPS THAT HAVE BEEN IN DARKNESS
!                        BEFORE/AFTER THIS CALL
!   AA      I/O        REAL DYNAMIC ARRAY
!   II      I/O        INTEGER DYNAMIC ARRAY
!   LL      I/O        LOGICAL DYNAMIC ARRAY
!   ISATID             SAT ID ARRAY
!   ALAPGM   O         CORRECT CR*APLM SAVED FOR ALBEDO
!
!
! NOTE:  ALL FLAGS NEEDED IN THIS SUBROUTINE DEALING WITH THE
!        SATELLITE ARE SET IN SUBROUTINE ORBIT OR COWLIN
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION(A-H,O-Z),LOGICAL(L)
      SAVE
!
      LOGICAL LSTSUN,LCRSUN
      character*4 block(5)
!
      COMMON/CITER /NINNER,NARC,NGLOBL
      COMMON/CONSTR/PI,TWOPI,DEGRAD,SECRAD,SECDAY
      COMMON/GPSBET/BETCUT,BETGPS(200)
      COMMON/CBDTRU/BDTRUE(7,999)
      COMMON/CGRAV/GM,AE,AESQ,FE,FFSQ32,FSQ32,XK2,XK3,XLAM,SIGXK2,      &
     &      SIGXK3,SIGLAM,RATIOM(2),AU,RPRESS
      COMMON/CIROCK/IGPSBK,IRKSTN
      COMMON/CIMDST/IDRLTM(200),ITRLTM(200),IRELON,IRLONA,NRLTMC,       &
     & IDRCK4(200),IRKONA,NROCK4,IRKRAD,NXIRTM
      COMMON/CITERL/LSTGLB,LSTARC,LSTINR,LNADJ ,LITER1,LSTITR,          &
     &              LOBORB,LRESID,LFREEZ,LSAVEF,LHALT,LADJPI,LADJCI
      COMMON/CLVIEW/LNPRNT(18),NXCLVI
      COMMON/CORA01/KFSEC0,KFSECB,KFSEC ,KFSECV,KH    ,KHV   ,KCTOL ,   &
     &              KRSQ  ,KVMATX,KCPP  ,KCPV  ,KCCP  ,KCCV  ,KCCPV ,   &
     &              KCCVV ,KXPPPP,KX    ,KPX   ,KSUMX ,KXDDOT,KSUMPX,   &
     &              KPXDDT,KAB   ,KPN   ,KAORN ,KSINLM,KCOSLM,KTANPS,   &
     &              KCRPAR,KVRARY,KXM   ,KXNP1 ,KXPRFL,KXM2  ,KXNNP1,   &
     &              KWRK  ,KFI   ,KGE   ,KB0DRG,KBDRAG,KAPGM ,KAPLM ,   &
     &              KCN   ,KSN   ,KSTID ,KTIDE ,KSTDRG,KSTSRD,KSTACC,   &
     &              KLGRAV,KGM   ,KAE   ,KFPL  ,KFEQ  ,KPLNPO,KPLNVL,   &
     &              KXEPOC,KCD   ,KCDDOT,KCR   ,KGENAC,KACN  ,KASN  ,   &
     &              KTHDRG,KCKEP ,KCKEPN,KXNRMZ,KXNRMC,KFSCEP,KFSCND,   &
     &              KAREA ,KXMASS,KRMSPO,KTCOEF,KTXQQ ,KTIEXP,KTXMM ,   &
     &              KTXLL1,KTXSN1,KTS2QQ,KT2M2H,KT2MHJ,KTXKK ,KTSCRH,   &
     &              KPXPK ,KAESHD,KCSAVE,KSSAVE,KCGRVT,KSGRVT,KXDTMC,   &
     &              KDNLT ,KTXSN2,KTNORM,KTWRK1,KTWRK2,KUNORM,KAERLG,   &
     &              KSINCO,KPARLG,KCONST,KBFNRM,KTDNRM,KCSTHT,KTPSTR,   &
     &              KTPSTP,KTPFYW,KPLMGM,KTPXAT,KEAQAT,KEAFSS,KEAINS,   &
     &              KACS  ,KECS  ,KSOLNA,KSOLNE,KSVECT,KSFLUX,KFACTX,   &
     &              KFACTY,KADIST,KGEOAN,KPALB ,KALBCO,KEMMCO,KCNAUX,   &
     &              KSNAUX,KPPER ,KACOSW,KBSINW,KACOFW,KBCOFW,KANGWT,   &
     &              KWT   ,KPLNDX,KPLANC,KTGACC,KTGDRG,KTGSLR,KWTACC,   &
     &              KWTDRG,KWTSLR,KTMACC,KTMDRG,KTMSLR,KATTUD,KDYACT,   &
     &              KACCBT,KACPER,KXDDNC,KXDDAO,KXNC  ,KXPPNC,KSMXNC,   &
     &              KXDDTH,KPDDTH,KXSSBS,KCPPNC,KEXACT,KXACIN,KXACOB,   &
     &              KPXHDT,KTPXTH,KPACCL,KTXSTA,KDELXS,KSMRNC,KPRX  ,   &
     &              KSMRNP,KDSROT,KXUGRD,KYUGRD,KZUGRD,KSUMRC,KXDDRC,   &
     &              KTMOS0,KTMOS, KTMOSP,KSMXOS,KSGTM1,KSGTM2,KSMPNS,   &
     &              KXGGRD,KYGGRD,KZGGRD,KXEGRD,KYEGRD,KZEGRD,KSSDST,   &
     &              KSDINS,KSDIND,KSSDSR,KSSDDG,KTATHM,KTAINS,KTAFSS,   &
     &              KSRAT ,KTRAT ,KHLDV ,KHLDA1,KHLDA4,KHLDA7,KQAST1,   &
     &              KQAST2,KQAST3,KQAST4,KQAST5,KQAST6,NXCA01
      COMMON/CORA03/KRFMT ,KROTMT,KSRTCH,KCFSC ,KTHG  ,KCOSTG,KSINTG,   &
     &              KDPSI ,KEPST ,KEPSM ,KETA  ,KZTA  ,KTHTA ,KEQN  ,   &
     &              KDPSR ,KSL   ,KH2   ,KL2   ,KXPUT ,KYPUT ,KUT   ,   &
     &              KSPCRD,KSPSIG,KSTAIN,KSXYZ ,KSPWT ,KDXSDP,KDPSDP,   &
     &              KXLOCV,KSTNAM,KA1UT ,KPLTIN,KPLTVL,KPLTDV,KPUTBH,   &
     &              KABCOF,KSPEED,KANGFC,KSCROL,KSTVEL,KSTVDV,KTIMVL,   &
     &              KSTEL2,KSTEH2,KSL2DV,KSH2DV,                        &
     &              KAPRES, KASCAL, KASOFF,KXDOTP,KSAVST,               &
     &              KANGT , KSPDT , KCONAM,KGRDAN,KUANG ,KFAMP ,        &
     &              KOFACT, KOTSGN,KWRKRS,KANFSD,KSPDSD,KPRMFS,KSCRFR,  &
     &              KCOSAS,KSINAS,KDXTID,KALCOF,KSTANF,KNUTIN,KNUTMD,   &
     &              KPDPSI,KPEPST,KDXDNU,KDPSIE,KEPSTE,NXCA03
      COMMON/CORA06/KPRMV ,KPNAME,KPRMV0,KPRMVC,KPRMVP,KPRMSG,KPARVR,   &
     &              KPRML0,KPDLTA,KSATCV,KSTACV,KPOLCV,KTIDCV,KSUM1 ,   &
     &              KSUM2 ,KGPNRA,KGPNRM,KPRSG0,KCONDN,KVELCV,          &
     &              KSL2CV,KSH2CV,KTIEOU,KPRMDF,NXCA06
      COMMON/CORI01/KMJDS0,KMJDSB,KMJDSC,KMJDSV,KIBACK,KIBAKV,KIORDR,   &
     &              KIORDV,KNOSTP,KNOCOR,KNSAT ,KN3   ,KNEQN ,KNEQN3,   &
     &              KNH   ,KNHV  ,KNSTPS,KNSTPV,KICPP ,KICPV ,KICCP ,   &
     &              KICCV ,KICCPV,KICCVV,KISUMX,KIXDDT,KISMPX,KIPXDD,   &
     &              KNMAX ,KNTOLD,KNTOLO,KICNT ,KISNT ,KMM   ,KKK   ,   &
     &              KJJ   ,KHH   ,KIBDY ,KSIGN1,KSIGN2,KLL   ,KQQ   ,   &
     &              KIORFR,KIPDFR,KITACC,KJSAFR,KJSPFR,KMJDEP,KMJDND,   &
     &              KNVSTP,KNSTRN,KNDARK,KTIPPT,KTJBDY,                 &
     &              KICNTA,KISNTA,KISHDP,KIPTC ,KIPTS ,KIGTSR,KIXTMC,   &
     &              KTIPTT,KTNOSD,KTQNDX,KTLL1 ,KTJJBD,KTITDE,KTCNTR,   &
     &              KTNN  ,KITACX,KNMOVE,KPANEL,KPLPTR,KNADAR,KNADSP,   &
     &              KNADDF,KNADEM,KNADTA,KNADTC,KNADTD,KNADTF,KNADTX,   &
     &              KITPMD,KSCATT,KITPAT,KILTPX,KEASBJ,KEANMP,KEANAN,   &
     &              KEAPMP,KEAPAN,KEAMJS,KEAPPP,KEAAAA,KICNTT,KISNTT,   &
     &              KTPGRC,KTPGRS,KTPC  ,KTPS  ,KALCAP,KEMCAP,KNSEG ,   &
     &              KICNTP,KISNTP,KNRDGA,KNRDDR,KNRDSR,KIRDGA,KIRDRG,   &
     &              KIRSLR,KSTRTA,KSTRTD,KSTRTS,KDYNPE,KACCPE,KIBCKN,   &
     &              KNRAT ,KIXDDN,KISMXN,KDXDDN,KDSMXN,KICPPN,KACSID,   &
     &              KNEQNH,KHRFRC,KPTFBS,KPTFSB,KIPXDA,KIACCP,KXSTAT,   &
     &              KPXST ,KSALST,KMAPLG,KNMBUF,KSTEPS,KSGMNT,KSATIN,   &
     &              KMEMST,KNEQNI,KBUFIN,KWEMGA,KWEMDR,KTPATS,KTANMP,   &
     &              KTAPPP,KTAMJS,KTASID,KGPSID,KNSSVA,KPNALB,KBRAX1,   &
     &              KBRAX2,KBRAX3,NXCI01
      COMMON/CORI04/KNMP  ,KINDP ,KNDPAR,KNPVCT,KISATN,KISET ,KIANTO,   &
     &              KISATO,KIANTD,KISATD,KISTAD,KISATC,KMJDCG,KISTAT,   &
     &              KMJDEB,KMJDBN,KNDBIN,KNWTDB,KIXPAR,KNDBUF,KSSTNM,   &
     &              KSSTNA,KMBSAT,KMBSTA,KXKEY ,KXVKEY,KXFLAG,KIPNTF,   &
     &              KIPNTS,KNCON ,KKF   ,KIDATB,KNSTLV,KSLVID,KLLBIA,   &
     &              KTMRA1,KTMRA2,KIND1 ,KTARID,KATARD,KYAWID,KXOBLK,   &
     &              KDSCWV,KATRSQ,KATSAT,KKVLAS,KPARTP,KLTMSC,KLTASC,   &
     &              KCTBST,KSTBST,KANCUT,KANGPS,KANTYP,                 &
     &              KANTOF,                                             &
     &              KYSAT, KMBDEG,                                      &
     &              KMBNOD,KMBSST,KBSPLN,KSSPLN,KXIOBS,KIDLAS,KIAVP ,   &
     &              KXNAVP,KNEXCG,KIDEXC,KNREXC,KTELEO,KIKEY ,KIMKEY,   &
     &              KIMBLK,KIMPRT,KCN110,KCN111,KC110,KC111,KTDSAT,     &
     &              KTDANT,NXCI04
      COMMON/CORL04/KLEDIT,KLBEDT,KLEDT1,KLEDT2,KNSCID,KEXTOF,KLSDAT,   &
     &              KLRDED,KLAVOI,KLFEDT,KLANTC,NXCL04
      COMMON/CRMI/RMI(9)
      COMMON/GPSINT/IGPSBW,NGPSBW
      COMMON/GPSSHD/LGPSHD,LGPSHO,LSHADS
      COMMON/LSTRT/LSTART
      COMMON/NEQINT/NINTOT,MEMTOT,NEQNIM,NXNEQS
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      COMMON/SETADJ/LSADRG(4),LSASRD(4),LSAGA(4),LSAGP,LSATID,LSAGM,    &
     &              LSADPM,LSAKF,LSADNX,LSADJ2,LSAPGM
      COMMON/SETAPT/                                                    &
     &       JSADRG(1),JSASRD(1),JSAGA(1),JFAADJ,JTHDRG,JACBIA,JATITD,  &
     &       JDSTAT,JDTUM ,                                             &
     &       JSACS, JSATID,JSALG,JSAGM,JSAKF,JSAXYP,JSADJ2,JSAPGM,      &
     &       JFGADJ,JLTPMU,JLTPAL,JL2CCO,JL2SCO,JL2GM,JLRELT,           &
     &       JLJ2SN,JLGMSN,JLPLFM,JL2AE,JSAXTO,JSABRN
      COMMON/SETIOR/IORDRG,IORSRD,IORGA,IPDDRG,IPDSRD,IPDGA
      COMMON/SETOPT/LSDRG,LSSRD,LSGA,LSORB,LTHDRG,LROCK4
      COMMON/SOLTUM/INDTUM,NDTUM,ITUMSC(32),IFLAG1,IFLAG3,NXSOLT
      COMMON/STARTT/ESSTRT,FSSTRT
      COMMON/YAWNFO/YAWRP(200),YAWR(200),YAWRR(200),YAWBTP(200),        &
     &              YAWBID(200)
      DIMENSION XHELIO(3),ACCSOLRAD(3),ELEM(6),ZPOS(3),UVECT(3,3),USUN(3)
      DIMENSION GRPAR(NEQN,3),APGM(1),STACC(1),TM(3),PART(3),LAJSP(1)
      DIMENSION AA(1),II(1),LL(1)
      DIMENSION ISATID(*)
      DIMENSION VMAT(3,6)
      DIMENSION XAXIS(3),YAXIS(3),ZAXIS(3)
      DIMENSION DXAXIS(3,3),DYAXIS(3,3),DZAXIS(3,3),DBDX(3)
      DIMENSION OXYZ(3,3),FSECE(1),FSECU(1),IYMD(1),IHM(1)
      DIMENSION HELIOS(3)
      DIMENSION IBLOCKS(5)
      DIMENSION ISATUM(1)
      DIMENSION LAVOID(1)
!  helios: Geocenter -> heliocenter vector, in meters.
      DIMENSION PSOLRAD(3,9)
! psolrad  :  Solar panel solrad acceleration and partials
!             (the only output when iflag1 = 0).
      DATA ZERO/0.0D0/,ONE/1.0D0/,TWO/2.0D0/,THREE/3.0D0/,FOUR/4.0D0/
      DATA FIVE/5.0D0/,SEVN/7.0D0/
      DATA IBLOCKS/5,1,2,3,4/
      DATA BLOCK/'   I',' II ',' IIA',' IIR',' IIF'/
!
!
!**********************************************************************
! START OF EXECUTABLE CODE
!**********************************************************************
!
!     write(6,*)' dbg enter TUMSOLRD '

      ALAPGM = 0.0D0

!   FIND THE CURRENT SATELLITE IN THE SATELLITE ID FOR ADJUSTMENTS
        IF(NPVAL0(IXGPSBW).GT.0) THEN
      IDM=IGPSBW/9
!        do iij = 1,idm
!        write(6,*)' dbg ISATUM ',ISATUM(IIJ),IIJ
!        enddo
        ENDIF
      CALL FNDNUM(ISATID(1),ISATUM,IDM,IRET)
!   FIND THE CURRENT SATELLITE IN THE LIST OF SATELLITES
      CALL FNDNUM(ISATID(1),II(KISATN),31,IRET2)
!
!   Iniialize adjustments flag (Adjust Box Wing Prms)
        LABWP=.FALSE.
!
!  EXTRACT IPRN IBLK
       CALL GPSBLOCK(ISATID,ISVN,IPRN,IBLK)

!     if(.NOT.LSTART.AND.IRET2.GT.0) write(6,82828),ISATID(1),IRET,IBLK
!82828  format('DBG SAT SEQ BLK',3I8)

        HELIOS(1)=BDTRUE(1,8)
        HELIOS(2)=BDTRUE(2,8)
        HELIOS(3)=BDTRUE(3,8)

        IF(NPVAL0(IXGPSBW).GT.0.AND..NOT.LSTART) THEN
        LABWP=.TRUE.
        ENDIF
        IF (NPVAL0(IXGPSBW) > 0) THEN
            LBOXWING_PRESENT = .TRUE.
        ELSE
            LBOXWING_PRESENT = .FALSE.
        END IF
      CALL SOLARTUM(MJDSEC,FSEC,HELIOS,ELEM,IFLAG1,NINNER,IBLK,1,  &
     &AA(KPRMV0),AA(KPRMVC),ACCSOLRAD,PSOLRAD,IFLAG3,ISATID,AA,    &
     &LABWP,IRET,IRET2,IPRN,LBOXWING_PRESENT)
!     write(6,*)' dbg ACCEL ',ACCSOLRAD


!    FILL PARTIALS
!    TAKE INTO ACCOUNT THE SATELLITE ORDER BELOW

      IF(IRET.EQ.0) GOTO 90000
      IF(LABWP) THEN

!     PARAMETER INDEX
      INDX   = IPVAL0(IXGPSBW)+9*(IRET-1)
!     PARTIAL INDEX
!     KPART=JDTUM+(IRET-1)*9
      KPART=JDTUM

       DO JJ=1,9
       DO KK=1,3
        GRPAR(KPART-1+JJ,KK)=ZERO
       ENDDO
       ENDDO

       DO JJ=1,9
       LAVOID(INDX-1+JJ)=.FALSE.

        DO KK=1,3
        GRPAR(KPART-1+JJ,KK)=PSOLRAD(KK,JJ)
        ENDDO

       ENDDO

      ENDIF  ! LABWP

!      DO JJ=1,9 print ONLY 3 from the 9
!      DO JJ=1,3
!      DO KK=1,3
!       write(6,*)' dbg GRPAR ',GRPAR(KPART-1+JJ,KK),KPART-1+JJ,KK
!      ENDDO
!      ENDDO

90000 CONTINUE
      RETURN
      END
