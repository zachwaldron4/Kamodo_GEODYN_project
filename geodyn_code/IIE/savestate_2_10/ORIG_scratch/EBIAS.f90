!$EBIAS
      SUBROUTINE EBIAS (PMPA  ,PMPE  ,RESID ,RESIDU,EDTSIG,RATIO ,      &
     &           OBSSIG,LEDIT ,NTYPE ,ISTATS,BTWB  ,TBTWA ,BTWD  ,      &
     &           RESCAL,LSCALE, EDFLAG, AA    ,II    ,LL    )
!********1*********2*********3*********4*********5*********6*********7**
! EBIAS            00/00/00            0000.0    PGMR - ?
!                      3/90            90??.0    PGMR - W. EDDY
!                      3/90            90??.0    PGMR - J. MCCARTHY
!
! FUNCTION:
!
!
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   PMPA     I    A    MATRIX OF PARTIALS OF MEASUREMENTS WRT PARAMETERS
!   PMPE          A    Matrix of partials of measurements wrt E-biases
!   RESID    I    A    MEASUREMENT RESIDUALS
!   RESIDU        A    MEASUREMENT RESIDUALS SCALED FOR PRINTOUT
!   EDTSIG        S    EDITING SIGMA
!   RATIO         A    RATIO OF RESIDUAL TO MEASUREMENT SIGMA
!   OBSSIG        A    MEASUREMENT SIGMA
!   LEDIT   I/O   A    LOGICAL ARRAY OF EDITING FLAGS -- .TRUE. IF POINT
!                      IS TO BE EDITED
!   NTYPE    I    S    Measurement type
!   ISTATS   I    S    NUMBER OF UNIQUE TRACKING/MTYPE CONFIGURATIONS
!   BTWB          A    NORMAL MATRIX OF E-BIAS PARAMETERS
!   TBTWA         A    TRANSPOSE MATRIX OF CROSS TERMS BETWEEN
!                        E-BIAS AND OTHER PARAMETERS
!   BTWD          A    Right Hand Side of E-bias solution
!   RESCAL   I    A    FACTORS TO RE-SCALE RESIDUALS FOR PRINTOUT
!   LSCALE
!   AA      I/O   A    DYNAMIC ARRAY FOR REAL VARIABLES.
!   II      I/O   A    DYNAMIC ARRAY FOR INTEGER VARIABLES
!   LL      I/O   A    DYNAMIC ARRAY FOR LOGICAL VARIABLES
!
! COMMENTS:
!
!
!********1*********2*********3*********4*********5*********6*********7**
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
      PARAMETER ( METRIX = 37 )
      PARAMETER ( ZERO   = 0.0D0 )
      PARAMETER ( ONE    = 1.0D0 )
      PARAMETER ( IEBMOD = 10000 )
!
      COMMON/CBIASI/IEBIAS(4),IMBIAS(2),IBSCAL(1)  ,ITBIAS(1),          &
     &              IBTROP(3),IBIONO(3),KLKSTA(4,2),KLKSAT(4,2),        &
     &              KLKSTS(2,2),ITRPZE(2,2),ITRPGR(2,4),IBSBIA(1)
      COMMON/CBLOKA/FSECBL,SIGNL ,VLITEC,SECEND,BLKDAT(6,4),DOPSCL(5,4)
      COMMON/CBLOKI/MJDSBL,MTYPE ,NM    ,JSTATS,NPSEG ,JSATNO(3),ITSYS ,&
     &       NHEADB,NELEVS,ISTAEL(12),INDELV(3,4),JSTANO(3),ITARNO,     &
     &       KTARNO
      COMMON/CEBARC/NEBIAS,NBIASE,NXCEBA
      COMMON/CEBGLB/MEPARM,MEDIM ,MEBIAS,MBIASE,NEBGRP,IEBGRP(4),NXCEBG
! /CEDIT / EDITING MULTIPLIER, EDITING RMS, AND EDIT LEVEL
      COMMON/CEDIT /EDITX ,EDTRMS,EDLEVL,CONVRG,GLBCNV,EBLEVL,EDITSW,   &
     &              ENPX  ,ENPRMS,ENPCNV,EDBOUN,FREEZI,FREEZG,FREEZA,   &
     &              XCEDIT
!                   EDITX  - EDIT MULTIPLIER (D=3.5)
!                   EDTRMS - RMS FOR FIRST ITERATION EDITING(D=200.)
!                   EDLEVL - EDITX*EDTRMS(SET BY IIE)
!                   CONVRG - INNER ITERATION CONVERGENCE CRITERIA(D=.02)
!                   GLBCNV - GLOBAL ITERATION CONVERGENCE (D=.02)
      COMMON/CESTIM/MPARM,MAPARM,MAXDIM,MAXFMG,ICLINK,IPROCS,NXCEST
      COMMON/CESTML/LNPNM ,NXCSTL
      COMMON/CITERL/LSTGLB,LSTARC,LSTINR,LNADJ ,LITER1,LSTITR,          &
     &              LOBORB,LRESID,LFREEZ,LSAVEF,LHALT,LADJPI,LADJCI
      COMMON/CNIGLO/MINTIM,MSATG3,MEQNG ,MEQNG3,MSATG ,MSATOB,MSATA ,   &
     &              MSATA3,MSETA ,MINTVL,MSORDR,MSORDV,NMXORD,          &
     &       MCIPV ,MXBACK,MXI   ,MPXPF ,MAXAB ,MSETDG,MXSATD,          &
     &       MXDEGS,MXDRP ,MXDRPA,MXSRP ,MXSRPA,MXGAP ,MSATDR,          &
     &       MSATSR,MSATGA,MXDRPD,MXSRPD,MXGAPD,MXBCKP,MXTPMS,          &
     &       NSTAIN,NXCNIG
      COMMON/COBBUF/IOBSBF,IBUF1 ,IBUF2 ,IWORD1,NHEADR,NWORDM
      COMMON/CORA02/KFSCTB,KFSCTC,KFSCTE,KDSECT,                        &
     &              KFSECT,KS    ,KCIP  ,KCIV  ,                        &
     &       KXTN  ,KXSM  ,KXTK  ,KXSJ  ,KXTI  ,KXTKP ,                 &
     &       KVTN  ,KVSM  ,KVTK  ,KVSJ  ,KVTI  ,KVTKP ,                 &
     &       KSATLT,KSATLN,KSATH ,KCOSTH,KSINTH,                        &
     &       KPXPFM,KPXPFK,KPXPFJ,KTRBF ,KFSTRC,                        &
     &       KFSTRE,KDSCTR,KFSCVS,KXSMBF,KXSKBF,KXSJBF,                 &
     &       KRSSV1,KRSSV2,KRSSV3,KTPMES,KACOEF,KACTIM,                 &
     &       KXTNPC,KXSMPC,KXTKPC,KXSJPC,KXTIPC,KXTKPP,                 &
     &       KRLRNG,KASTO,KASTP,NXCA02
      COMMON/CORA03/KRFMT ,KROTMT,KSRTCH,KCFSC ,KTHG  ,KCOSTG,KSINTG,   &
     &              KDPSI ,KEPST ,KEPSM ,KETA  ,KZTA  ,KTHTA ,KEQN  ,   &
     &              KDPSR ,KSL   ,KH2   ,KL2   ,KXPUT ,KYPUT ,KUT   ,   &
     &              KSPCRD,KSPSIG,KSTAIN,KSXYZ ,KSPWT ,KDXSDP,KDPSDP,   &
     &              KXLOCV,KSTNAM,KA1UT ,KPLTIN,KPLTVL,KPLTDV,KPUTBH,   &
     &              KABCOF,KSPEED,KANGFC,KSCROL,KSTVEL,KSTVDV,KTIMVL,   &
     &              KSTEL2,KSTEH2,KSL2DV,KSH2DV,                        &
     &              KAPRES, KASCAL, KASOFF,KXDOTP,KSAVST,               &
     &              KANGT , KSPDT , KCONAM,KGRDAN,KUANG ,KFAMP ,        &
     &              KOFACT, KOTSGN,KWRKRS,KANFSD,KSPDSD,KPRMFS,KSCRFR,  &
     &              KCOSAS,KSINAS,KDXTID,KALCOF,KSTANF,KNUTIN,KNUTMD,   &
     &              KPDPSI,KPEPST,KDXDNU,KDPSIE,KEPSTE,NXCA03
      COMMON/CORA04/KABIAS,KABSTR,KABSTP,KCBIAS,KCBSTR,KCBSTP,          &
     &       KRNM  ,KRKM  ,KRKJ  ,KRIJ  ,KRKPM ,                        &
     &       KRRNM ,KRRKM ,KRRKJ ,KRRIJ ,KRRKPM,                        &
     &       KURNM ,KURKM ,KURKJ ,KURIJ ,KURKPM,                        &
     &       KPRRNM,KPRRKM,KPRRKJ,KPRRIJ,KPRRKP,                        &
     &       KPMPXI,KPMPXE,KRA   ,KRELV ,KUHAT ,KWORK ,KTMPCR,KU    ,   &
     &       KS0   ,KS1   ,KXTP  ,KPXSXP,KPXDXP,KXUTDT,KRPOLE,KPXPOL,   &
     &       KXDPOL,KOBBUF,KOBSC ,KRESID,KSIGMA,KRATIO,KELEVS,          &
     &       KPMPA ,KPXSLV,KTPRTL,                                      &
     &       KFRQOF,KXYZOF,KFRQST,KFRQSA,KSTDLY,KSADLY,KXYZCG,KSCMRA,   &
     &       KEBVAL,KEBSIG,KEBNAM,KBTWB ,KTBTWA,KBTWD ,KPMPE ,          &
     &       KFSEB1,KFSEB2,KSTAMT,KPXSPA,KDIAGN,KOBOUT,KGRLT1,KGRLT2,   &
     &       KGRLT3,KGRLT4,KGRLT5,KPSTAT,KRSUNS,KCHEMR,KCHMOR,KEPOSR,   &
     &       KCHEMT,KCHMOT,KEPOST,KCHCBS,KCPOSS,KSCRTM,KXSTT ,KXSTR ,   &
     &       KXSS  ,KRANGT,KRANGR,KCHB1 ,KCHB2 ,KCHBV1,KCHBV2,KCHEB ,   &
     &       KSSTFQ,KSSTCC,KSSTSS,KSSTWT,KRLCOR,KWVLBI,KQUINF,KBRTS ,   &
     &       KBRTSV,KLRARC,KXEPBF,KXEPBR,KPRCBD,KPRTBD,KXPMPA,KXL,      &
     &       KXSIG ,KXEDTS,KXALO1,KXALO2,KXYOF2,KDLATF,KDLATS,KDLONF,   &
     &       KDLONS,KPF   ,KPS   ,                                      &
     &       KXOBSV,KXOBSW,KXEDSW,                                      &
     &       KXSIGW,KPSF  ,KDNUM ,KCNUM ,KFCOR ,KCOSAR,KSINAR,KSABIA,   &
     &       KSBTM1,KSBTM2,KYAWBS,KVLOUV,KACMAG,KOBSTR,                 &
     &       KPRL1 ,KPRL2, KRL1  ,KT1SE ,KTCP  ,                        &
     &       KRATDR,KFQT1S,KFQT1E,KT1STR,KFTTSE,KFRSTR,KFRRAT,KSV1  ,   &
     &       KSV2  ,KTSLOV,                                             &
     &       KGLGR1,KGLGR2,KGLFR1,KGLFR2,                               &
     &       KARGR1,KARGR2,KARFR1,KARFR2,                               &
     &       KRDS1L,KFT1AV,KDFQP ,KFREQ1,KFREQ3,KSAVD1,KSAVD2,          &
     &       KANTOU,KFM3CF,KF2CF,KTMG,KLTMG,KX2TIM,KX2OBS,KXRNDX,KX2SCR,&
     &       KALTWV,KXXBM ,KX2PAR,KATIME,KPMPAT,KPMATT,KX2PAT,          &
     &       KPXEXI,KPXEPA,KPV,KPXEP2,KX2COF,KACOF2,KACOF3,KBCOF,KBCOF2,&
     &       KDDDA ,KX2AUX,KX2VPR,KX2VPA,KEXTRA,KVARAY,KATROT,KATPER,   &
     &       KLTAR ,KXHOLD,KANTBL,KPHC  ,KOFDRV,KGNAME,KGRSIZ,KGRCNT,   &
     &       KGRDAT,KACCDT,KCTBTI,KCTBWE,KCTCTM,KANTUV,KANTOR,KW1PU ,   &
     &       KPYSQH,KSIGSP,KXYOF3,KXVTM1,KXDIST,KXDST0,KTMSE ,KDSDP ,   &
     &       KEXCST,KEXCDT,KEXCGX,KEXCGY,KEXCGZ,KIMNDX,KIMOBS,KIMTIM,   &
     &       KIMSAT,KM2VPA,KDCDD ,KDWNWT,KDPOR ,KC2PAR,KBOUNC,KBPART,   &
     &       NXCA04
      COMMON/CORA05/KOBTYP,KDSCRP,KGMEAN,KGLRMS,KWGMEA,KWGRMS,KTYMEA,   &
     &       KTYRMS,KWTMTY,KWTYRM,KTMEAN,KTRMS ,KWMEAN,KWTRMS,KWTRND,   &
     &       KPRVRT,KEBSTT,KVLOPT,NXCA05
      COMMON/CORA06/KPRMV ,KPNAME,KPRMV0,KPRMVC,KPRMVP,KPRMSG,KPARVR,   &
     &              KPRML0,KPDLTA,KSATCV,KSTACV,KPOLCV,KTIDCV,KSUM1 ,   &
     &              KSUM2 ,KGPNRA,KGPNRM,KPRSG0,KCONDN,KVELCV,          &
     &              KSL2CV,KSH2CV,KTIEOU,KPRMDF,NXCA06
      COMMON/CORI04/KNMP  ,KINDP ,KNDPAR,KNPVCT,KISATN,KISET ,KIANTO,   &
     &              KISATO,KIANTD,KISATD,KISTAD,KISATC,KMJDCG,KISTAT,   &
     &              KMJDEB,KMJDBN,KNDBIN,KNWTDB,KIXPAR,KNDBUF,KSSTNM,   &
     &              KSSTNA,KMBSAT,KMBSTA,KXKEY ,KXVKEY,KXFLAG,KIPNTF,   &
     &              KIPNTS,KNCON ,KKF   ,KIDATB,KNSTLV,KSLVID,KLLBIA,   &
     &              KTMRA1,KTMRA2,KIND1 ,KTARID,KATARD,KYAWID,KXOBLK,   &
     &              KDSCWV,KATRSQ,KATSAT,KKVLAS,KPARTP,KLTMSC,KLTASC,   &
     &              KCTBST,KSTBST,KANCUT,KANGPS,KANTYP,                 &
     &              KANTOF,                                             &
     &              KYSAT, KMBDEG,                                      &
     &              KMBNOD,KMBSST,KBSPLN,KSSPLN,KXIOBS,KIDLAS,KIAVP ,   &
     &              KXNAVP,KNEXCG,KIDEXC,KNREXC,KTELEO,KIKEY ,KIMKEY,   &
     &              KIMBLK,KIMPRT,KCN110,KCN111,KC110,KC111,KTDSAT,     &
     &              KTDANT,NXCI04
      COMMON/CORI05/KNOBGL,KNOBWG,KNOBTY,KNOBWY,KNOBST,KNOBWT,KNEBOB,   &
     &              KJSTAT,NXCI05
      COMMON/CPMPA /KTMPAR(3)    ,KMBPAR(2)    ,KRFPAR(2)    ,          &
     &              KAEPAR,KFEPAR,KFPPAR,KVLPAR,KETPAR(2,2)  ,          &
     &              KPMPAR,KUTPAR,KSTPAR(3,4)  ,NADJST       ,          &
     &              NDIM1 ,NDIM2 ,NXDIM1,NXDIM2
      COMMON/CVIEW /IOUT6 ,ILINE6,IPAGE6,MLINE6,                        &
     &              IOUT8 ,ILINE8,IPAGE8,MLINE8,                        &
     &              IOUT9 ,ILINE9,IPAGE9,MLINE9,                        &
     &              IOUT10,ILIN10,IPAG10,MLIN10,                        &
     &              IOUT15,ILIN15,IPAG15,MLIN15,                        &
     &              IOUT16,ILIN16,IPAG16,MLIN16,                        &
     &              IOUT7 ,NXCVUE
!
      DIMENSION PMPA  (NDIM1 ,NDIM2 ),RESID (NM),OBSSIG(NM),RATIO (NM), &
     &   EDTSIG(NM),LEDIT(NM),PMPE(MINTIM,MEPARM),AA(1),II(1),LL(1)
!
! INDEXX,ATWB,DIFCOR,BPARTL & BDELTA ARE DIMENS. BY THE MAXIMUM NO. OF
!        BIAS PARAMETERS APPLICABLE TO A SINGLE MEASUREMENT (MEPARM).
!        ATWA IS DIMENSIONED BY MEDIM=(MEPARM*(MEPARM-1))/2+MEPARM
!
      DIMENSION BTWB(MEDIM,3,MEBIAS+1),TBTWA(MAPARM,MEPARM,MEBIAS+1),   &
     &   BTWD(MEPARM,3,MEBIAS+1),RESIDU(NM)
      DIMENSION INDEXX( 4),BDELTA( 4),BTWBSV(10),BTWDSV(4),EBSSIG(4)
!      CHARACTER(8)      :: EDFLAG
      DIMENSION EDFLAG(NM)
!
      CHARACTER*1      EDTFLG, EDTE, EDTL
      DATA EDTFLG/'B'/
      DATA EDTE  /'E'/
      DATA EDTL  /'L'/
      CHARACTER*4      QMEAS, QTROP
      DATA QMEAS/'MEAS'/
      DATA QTROP/'TROP'/

      CHARACTER*8      TMP_CHAR
      equivalence ( TMP_CHAR, TMP_DP )
!
!**********************************************************************
! START OF EXECUTABLE CODE ********************************************
!**********************************************************************
!
!
! INITIAL CLEARING OF SUMMATION ARRAYS DONE EACH ITERATION BY CALL
!         FROM INITI TO EBINIT
!
! COUNT NUMBER OF E-BIASES ASSOCIATED WITH THIS BLOCK OF DATA
!
!CCC      PRINT *,'NEW (3/22/90) +WFE CHANGES IN THIS RUN '
      NINDEX=0
      DO 1000 I=1,MEPARM
      INDEXB=MOD(IEBIAS(I),IEBMOD)
      IF(INDEXB.LE.0) GO TO 1000
      NINDEX=NINDEX+1
      INDEXX(NINDEX)=I
      K0=INDEXB-1
      K=K0+KJSTAT
      II(K)=ISTATS
 1000 END DO
!
! IF NO BIAS PARAMETERS FOR THIS OBSERVATION BLOCK, RETURN
!
      IF(NINDEX.LE.0) RETURN
!
! LOCATE INDEX OF SUMMATION ARRAYS
!
      ISTATE=NUMLOC(ISTATS,II(KISTAT),NEBIAS)
      IF(ISTATE.GT.0) GO TO 1100
      II(KISTAT+NEBIAS)=ISTATS
      NEBIAS=NEBIAS+1
      ISTATE=NEBIAS
 1100 CONTINUE
!
! SUM INTO NORMAL EQUATIONS FOR ELECTRONIC BIASES
!
      CALL CLEARA(RATIO,NM)
      NMWTD=0
      DO 1600 N=1,NM
      IF(LEDIT(N)) GO TO 1600
      NMWTD=NMWTD+1
      RATIO(N)=ONE/OBSSIG(N)**2
 1600 END DO
!
      JSTL1 =ISTATE-1
!CCC     PRINT *,'EBIAS: ISTATE  ',ISTATE
      JEBSTT=KEBSTT+JSTL1*MEPARM*2
      JNEBOB=KNEBOB+JSTL1*2
      II(JNEBOB)=II(JNEBOB)+NM
!CCC     PRINT *,'EBIAS: JNEBOB, II(JNEBOB) ',JNEBOB, II(JNEBOB)
      INEBOB=JNEBOB+1
!CCC     PRINT *,'EBIAS: NM, NMWTD ',NM, NMWTD
!CCC     PRINT *,'EBIAS: INEBOB, II(INEBOB) ',INEBOB, II(INEBOB)
      II(INEBOB)=II(INEBOB)+NMWTD
!CCC     PRINT *,'EBIAS: INEBOB, II(INEBOB) ',INEBOB, II(INEBOB)
      IF(LNPNM) THEN
         CALL EBSUMP(PMPA  ,PMPE  ,RESID ,RATIO ,NM,NADJST,             &
     &   NINDEX,BTWB(1,1,ISTATE),TBTWA(1,1,ISTATE),BTWD(1,1,ISTATE),    &
     &   BDELTA)
      ELSE
         CALL EBSUMM(PMPA  ,PMPE  ,RESID ,RATIO ,NM,NADJST,             &
     &   NINDEX,BTWB(1,1,ISTATE),TBTWA(1,1,ISTATE),BTWD(1,1,ISTATE),    &
     &   AA(KSRTCH))
      ENDIF
!
      IPASS=ITSYS/10000
!         PRINT *,'EBIAS: IPASS = ',IPASS
      LWHOLE=IPASS.EQ.0
      IF(LWHOLE) GO TO 2500
      IF(IPASS.NE.1) GO TO 2200
!
! LOAD PASS START MJDSEC & FSEC AND LOAD EBIAS TYPE & STATION NUMBER
!
      DO 2100 I=1,NINDEX
      J=INDEXX(I)
      K0=MOD(IEBIAS(J),IEBMOD)-1
!
!--------------------------------------------------------------------
!     ....MODIFY THE EBNAM ARRAY TO PRINT THE TYPE OF EBIAS
!     ....IN THE EBIAS SUMMARY PRINTOUT
!
!     PRINT *, 'EBIAS: 2100 I, INDEXX(I) ',I, J
!     PRINT *, 'EBIAS: 2100 IEBIAS(J), K0 ', IEBIAS(J), K0
!     PRINT 7993, 'EBIAS: 2100 AA(KEBNAM)', AA(KEBNAM)
!CCC7993  FORMAT(A,3X,A)
      K = 2*K0 + KEBNAM + 1
      IQ = IEBIAS(J) / IEBMOD
      IF( IQ .LT. 100 ) THEN
!         AA(K) = QMEAS
         TMP_CHAR = QMEAS
         AA(K) = TMP_DP
      ELSEIF( IQ .GE. 500 .AND. IQ .LT. 600 ) THEN
!         AA(K) = QTROP
         TMP_CHAR = QTROP
         AA(K) = TMP_DP
      ENDIF
!     PRINT 7994, 'EBIAS: 2100 AA(K-1), AA(K)', AA(K-1), AA(K)
!CCC7994  FORMAT(A,3X,A,3X, A)
!--------------------------------------------------------------------
!
      K=K0+KMJDEB
      II(K)=MJDSBL
!     MJDEB (MOD(IEBIAS(J),IEBMOD))=MJDSBL
      K=K0+KFSEB1
      AA(K)=FSECBL
!     FSEB1 (MOD(IEBIAS(J),IEBMOD))=FSECBL
!
! NO LIMIT FOR MEASUREMENT TYPE ANYMORE
      MTYPEB=IEBIAS(J)/IEBMOD
      K=K0+KSTAMT
      AA(K)= MTYPEB*1D8+AA(KOBBUF+IWORD1+15)
!     STAMT (MOD(IEBIAS(J),IEBMOD)= FLOAT(MTYPEB*100000000)
!                             +AA(KOBBUF+IWORD1+15)
 2100 END DO
 2200 CONTINUE
!
! THIS BLOCK IS NOT AN ENTIRE PASS, SAVE SUMS OF STATISTICAL INFORMATION
!
      DO 2000 N=1,NM
      RESIDU(N)=RESID(N)*RESCAL
 2000 END DO
      LSCALE=.TRUE.
!
      CALL EBSMST(RESIDU,RESID ,OBSSIG,RATIO ,EDTSIG,LEDIT ,AA(KS),     &
     &     NM    ,PMPE  ,BTWB(1,2,ISTATE)    ,BTWD(1,2,ISTATE)    ,     &
     &                   BTWB(1,3,ISTATE)    ,BTWD(1,3,ISTATE)    ,     &
     &            AA   (JEBSTT),INDEXX,NINDEX,AA(KSRTCH))
!
      IF(IPASS.NE.3) RETURN
!
! LOAD PASS STOP FSEC
!
      DO 2300 I=1,NINDEX
      J=INDEXX(I)
      K0=MOD(IEBIAS(J),IEBMOD)-1
      K=K0+KFSEB2
      KK=K0+KMJDEB
      AA(K)=SECEND+FSECBL+ DBLE(MJDSBL-II(KK))
!     FSEB2 (MOD(IEBIAS(J),IEBMOD)=SECEND+FSECBL+ FLOAT(MJDSBL-MJDEB)
 2300 END DO
      GO TO 3000
 2500 CONTINUE
!
!
! LOAD PASS START MJDSEC & START, AND STOP FSEC,
!      AND LOAD EBIAS TYPE & STATION NUMBER
!
      DO 2600 I=1,NINDEX
      J=INDEXX(I)
      K0=MOD(IEBIAS(J),IEBMOD)-1
!
!--------------------------------------------------------------------
!     ....MODIFY THE EBNAM ARRAY TO PRINT THE TYPE OF EBIAS
!     ....IN THE EBIAS SUMMARY PRINTOUT
!
!     PRINT *, 'EBIAS: 2600 I, INDEXX(I) ',I, J
!     PRINT *, 'EBIAS: 2600 IEBIAS(J), K0 ', IEBIAS(J), K0
!     PRINT 8993, 'EBIAS: 2600 AA(KEBNAM)', AA(KEBNAM)
!CCC8993  FORMAT(A,3X,A)
      K = 2*K0 + KEBNAM + 1
      IQ = IEBIAS(J) / IEBMOD
      IF( IQ .LT. 100 ) THEN
!         AA(K) = QMEAS
         TMP_CHAR = QMEAS
         AA(K) = TMP_DP
      ELSEIF( IQ .GE. 500 .AND. IQ .LT. 600 ) THEN
!         AA(K) = QTROP
         TMP_CHAR = QTROP
         AA(K) = TMP_DP
      ENDIF
!     PRINT 8994, 'EBIAS: 2600 AA(K-1), AA(K)', AA(K-1), AA(K)
!CCC8994  FORMAT(A,3X,A,3X,A)
!--------------------------------------------------------------------
!
      K=K0+KMJDEB
      II(K)=MJDSBL
!     MJDEB (MOD(IEBIAS(J),IEBMOD))=MJDSBL
      K=K0+KFSEB1
      AA(K)=FSECBL
!     FSEB1 (MOD(IEBIAS(J),IEBMOD))=FSECBL
      K=K0+KFSEB2
      AA(K)=SECEND+FSECBL
!     FSEB2 (MOD(IEBIAS(J),IEBMOD))=SECEND+FSECBL
!
! NO LIMIT FOR MEASUREMENT TYPE ANYMORE
      MTYPEB=IEBIAS(J)/IEBMOD
      K=K0+KSTAMT
      AA(K)= MTYPEB*1D8+AA(KOBBUF+IWORD1+15)
!     STAMT (MOD(IEBIAS(J),IEBMOD)= FLOAT(MTYPEB*100000000)
!                             +AA(KOBBUF+IWORD1+15)
 2600 END DO
      GO TO 3600
 3000 CONTINUE
!
! IF STATISTICS REQUIRE CORRECTION SAVE E-BIAS NORMAL MATRIX
!    AND R.H. SIDE BEFORE SOLUTION
!
      DO 3200 I=1,MEDIM
      BTWBSV(I)=BTWB(I,1,ISTATE)
 3200 END DO
      DO 3400 I=1,MEPARM
      BTWDSV(I)=BTWD(I,1,ISTATE)
 3400 END DO
 3600 CONTINUE
      NWTOBS=II(INEBOB)
!     PRINT *,'EBIAS: INEBOB, II(INEBOB), NWTOBS ',INEBOB, II(INEBOB),
!    1        NWTOBS
!
!     ....3/22/90 FIX FOR EBIAS
!CCCC IF(NWTOBS.LT.NINDEX) GO TO 9000
      IF(NWTOBS .LT. (NINDEX+1) ) THEN
!     ....3/22/90 FIX FOR EBIAS
!
!--------------------------------------------------------------
!
!        ....CLEAR E-BIAS SOLUTION ARRAYS  3/22/90 CHANGE
!
         NCLEAR=MEPARM*MAPARM
         CALL CLEARA(TBTWA(1,1,ISTATE),NCLEAR)
         DO 19500 I=1,MEPARM
            BTWD(I,1,ISTATE)=ZERO
19500    CONTINUE
         DO 19600 I=1,MEDIM
            BTWB(I,1,ISTATE)=ZERO
19600    CONTINUE
!
!        ....SINCE YOU CAN NOT SOLVE FOR THE EBIAS FOR THIS PASS,
!        ....BECAUSE OF TOO FEW POINTS, EDIT OUT THESE POINTS
!
         DO 19700 I=1,NM
            LEDIT(I) = .TRUE.
!            IF( .NOT. ( EDFLAG(I) .EQ. EDTL .OR.
!     1          EDFLAG(I) .EQ. EDTE ) )   EDFLAG(I) = EDTFLG
            TMP_DP = EDFLAG(I)
            IF( .NOT. ( TMP_CHAR .EQ. EDTL .OR.                         &
     &                  TMP_CHAR .EQ. EDTE )       )  THEN
              TMP_CHAR = EDTFLG
              EDFLAG(I) = TMP_DP
            ENDIF

19700    CONTINUE
!
!            PRINT *,'EBIAS: CLEARED BTWB '
         GO TO 9000
!
!--------------------------------------------------------------
!
      ELSE
!
!
! SOLVE FOR BIAS VALUES AND BACK-SUBSTITUTE FROM NORMAL EQUATIONS
!
      CALL EBSOLV(BTWB(1,1,ISTATE),TBTWA(1,1,ISTATE),BTWD(1,1,ISTATE),  &
     &   AA(KPDLTA),BDELTA,EBSSIG,AA(KSUM1),AA(KSUM2),NADJST,NINDEX,    &
     &   LWHOLE)
!
      ENDIF
!
!
      IF(.NOT.LWHOLE) GO TO 6000
!
! THIS BLOCK CONSTITUTES ENTIRE PASS, REMOVE BIAS CORRECTIONS
!    FROM RESIDUALS
!
      DO 5000 I=1,NINDEX
      DO 4000 N=1,NM
      RESID (N)=RESID (N)-PMPE(N,I)*BDELTA(I)
 4000 END DO
 5000 END DO
      GO TO 7000
 6000 CONTINUE
!
! CORRECT STATISTICAL SUMMATIONS ONLY IF THIS BLOCK NOT ENTIRE PASS
!
!        PRINT*,'EBIAS: SUM E-BIAS STATISTICS ON MULTI-BLOCK PASS '
!
      CALL EBSTAT  (AA(KTMEAN),AA(KTRMS ),AA(KWMEAN),AA(KWTRMS),        &
     &              AA(KTYMEA),AA(KTYRMS),AA(KWTMTY),AA(KWTYRM),        &
     &              AA(JEBSTT),BDELTA    ,                              &
     &              BTWB(1,2,ISTATE)     ,BTWD(1,2,ISTATE)     ,        &
     &              BTWBSV               ,BTWDSV               ,        &
     &              BTWB(1,3,ISTATE)     ,BTWD(1,3,ISTATE)     ,        &
     &              INDEXX    ,NINDEX    ,NTYPE     ,ISTATS    )
 7000 CONTINUE
!
! UPDATE E-BIAS VALUES
!
!          PRINT*,'EBIAS: UPDATE E-BIAS VALUES '
!
      DO 8000 I=1,NINDEX
      J=INDEXX(I)
      K0=MOD(IEBIAS(J),IEBMOD)-1
      K=K0+KEBVAL
      AA(K)=AA(K)+BDELTA(I)
!     EBVALU(IEBIAS(J))=EBVALU(IEBIAS(J))+BDELTA(I)
      K=K0+KEBSIG
      AA(K)=EBSSIG(I)
!     EBSIG (MOD(IEBIAS(J),IEBMOD))=EBSSIG(I)
      K=K0+KJSTAT
      II(K)=ISTATS
!     JSTATE(MOD(IEBIAS(J),IEBMOD))=ISTATS
 8000 END DO
      II(JNEBOB)=0
      II(INEBOB)=0
      RETURN
!
 9000 CONTINUE
!
!     ....GET HERE IF NOT ENOUGH POINTS TO CALCULATE AN EBIAS
!
      IF( LRESID ) WRITE(IOUT6,90000) NWTOBS,NINDEX
!
      DO 9500 I=1,NINDEX
      J=INDEXX(I)
      K0=MOD(IEBIAS(J),IEBMOD)-1
      K=K0+KEBSIG
      AA(K)=ZERO
!     EBSIG (K)=ZERO
 9500 END DO
      II(JNEBOB)=0
      II(INEBOB)=0
      RETURN
90000 FORMAT(' ** EBIAS **  NO. OF WTD. OBS. (=',I5,') FEWER THAN ',    &
     &   'NO. OF E-BIAS PARAMETERS (=',I1,').')
      END
