!$TOPTHM
      SUBROUTINE TOPTHM(XSAT,TDNRM1,TDNRM2,TDNRM3,                      &
     &                 AREA,EMISS,TEMPA,TEMPC,TIMED,TIMEF,              &
     &                 THTX,ACCEL,PXDDT,JARADJ,JEMADJ,JTAADJ,JTCADJ,    &
     &                 JTDADJ,JTFADJ,JTXADJ,IMAPAR,IMAPEM,IMAPTA,IMAPTC,&
     &                 IMAPTD,IMAPTF,IMAPTX,COSTHT,NFACE,NEQN,LORBIT)
!***********************************************************************
!                                  05/23/91      PGMR:  ANDREW MARSHALL
!
!  FUNCTION:  COMPUTE THE THERMAL EMMISSION ACCELERATION ON A BOX WING
!             MODEL OF THE TOPEX SATELLITE
!
!     ACCEL = -2/3*STEFBL*AREA/C/MASS*EMISS*TEMP**4 * NORMVEC
!  WHERE
!     SUNLIGHT
!           TEMP = A+C*(1-EXP(-T1/F))*COS(THETA/X)
!     SHADOW
!           TEMP = A+C*EXP(-T2/D)*(1-EXP(-T1/F))*COS(THETA_SHD/X)
!  AND
!     X- SINUSOIDAL SUNLIGHT
!           TEMP = A+C*COS(THETA/X)*(1-EXP(-T1/F)+EXP(-T1/F)*EXP(-T2/D)*
!                  COS(THETA_SHD/X)/COS(THETA_SUN)/X))
!     X- SINUSOIDAL SHADOW
!           TEMP = A+C*EXP(-T2/D)*COS(THETA_SHD/X)
!  AND
!     SA SUNLIGHT
!           TEMP = A+C*(1-EXP(-T1/F)+EXP(-T1/F)*EXP(-T2/D))
!     SA SHADOW
!           TEMP = A+C*EXP(-T2/D)
!  WHERE T IS TIME SINCE OCCULTATION FOR EACH FACE
!
!  I/O PARAMETERS:
!
!   NAME    A/S    I/O   DESCRIPTION OF I/O PARAMETERS IN ARGUMENT LIST
!   -----  ------ -----  -----------------------------------------------
!   XSAT     A      I    SPACECRAFT POSITION IN TRUE OF DATE SYSTEM (M)
!   TDNRM1   A      I    SPACECRAFT FLAT PLATE NORMAL VECTORS IN TRUE OF
!                        DATE SYSTEM (X COMP.)
!   TDNRM2   A      I    SPACECRAFT FLAT PLATE NORMAL VECTORS IN TRUE OF
!                        DATE SYSTEM (Y COMP.)
!   TDNRM3   A      I    SPACECRAFT FLAT PLATE NORMAL VECTORS IN TRUE OF
!                        DATE SYSTEM (Z COMP.)
!   AREA     A      I    ARRAY OF BOX-WING AREAS, MUST BE ARRANGED IN
!                        THIS ORDER:   (X+,X-,Y+,Y-,Z+,Z-,SA+,SA-)(M**2)
!   EMISS    A      I    ARRAY OF PANEL EMISSIVITIES
!   TEMPA    A      I    ARRAY OF PANEL COLD EQUILIBRIUM TEMPS. (KELVIN)
!   TEMPC    A      I    ARRAY OF PANEL DELTA HOT-COLD EQUIL.TEMPS.(KEL)
!   TEMPD    A      I    ARRAY OF PANEL TRANSISTION TIMES FROM HOT
!                        TO COLD EQUILIBIRUM TEMPS (SEC)
!   TEMPF    A      I    ARRAY OF PANEL TRANSISTION TIMES FROM COLD
!                        TO HOT EQUILIBIRUM TEMPS (SEC)
!   THTX     A      I    ARRAY OF PANEL ROTATION RATE/THERMAL INERTIA
!                        CONSTANTS
!   ACCEL    A      O    TRUE OF DATE THERMAL IMBALANCE ACCELERATION
!   PXNQT    A      O    PARTIAL OF ACCEL. WRT PLATE PARAMETERS
!   JARADJ   S      I    POINTER TO PLATE AREA PARTIAL IN PXDDT
!   JEMADJ   S      I    POINTER TO PLATE EMISSIVITY PARTIAL IN PXDDT
!   JTAADJ   S      I    POINTER TO PLATE TEMP A PARTIAL IN PXDDT
!   JTCADJ   S      I    POINTER TO PLATE TEMP C PARTIAL IN PXDDT
!   JTDADJ   S      I    POINTER TO PLATE TIME D PARTIAL IN PXDDT
!   JTFADJ   S      I    POINTER TO PLATE TIME F PARTIAL IN PXDDT
!   JTXADJ   S      I    POINTER TO PLATE THETAX PARTIAL IN PXDDT
!   IMAPAR   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE AREA
!   IMAPEM   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE EMISSIVITY
!   IMAPTA   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE TEMPA
!   IMAPTC   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE TEMPC
!   IMAPTD   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE TIMED
!   IMAPTF   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE TIMED
!   IMAPTX   A      I    MAP FROM UNADJUSTED TO ADJUSTED POINTERS FOR
!                        PLATE THTX
!   COSTHT   A      I    COS OF ANGLE BETWEEN TOD PLATE NORMAL AND
!                        SATELLITE-SUN VECTOR
!   NFACE    S      I    NUMBER OF FLAT PLATES USED TO MODEL SATELLITE
!   BETAFX       BETAPRIME ANGLE AT WHICH SATELLITE GOES INTO FIXED YAW
!   BETAP        BETAPRIME SUN ANGLE
!   BETAMX       BETAP ANGLE WHERE SATELLITE IS IN CONTINUOUS SUN(56DEG)
!   SGAMMA       SOLAR ARRAY PITCH ANGLE
!   SCMASS       SPACECRAFT MASS
!   BWMEAN       SPACECRAFT MEAN MOTION (a**3/GM)**0.5
!   STEFBL       STEFAN-BOLTZMAN CONSTANT
!   TDIF         TIME SINCE SHADOW CROSSING
!   SHADOW       SHADOW CROSSING LOCATIONS.
!                1=EXIT, 2=ENTRY
!   THETA        ANGLE BETWEEN SUN AND SURFACE NORMAL VECTORS
!
! ASSUMPTIONS:
!    1)  ALL ARRAYS CONTAINING PANEL INFO MUST BE ORDERED AS IN
!        THIS ORDER:   (X+,X-,Y+,Y-,Z+,Z-,SA+,SA-)
!    2)  MODEL IS TOPEX SPECIFIC AND MUST HAVE 8 FACES ORIENTED
!        ALONG COORDINATE AXES AS DESCRIBED IN REFERENCES
!    3)  SHADOW MODEL, AS COMPUTED IN SOLRAT, IS CYLINDRICAL WITH
!        BOUNDARY CROSSING APPROXIMATED BY SATELLITE POSITION
!        AT THE NEXT INTEGRATION STEP AFTER BOUNDARY CROSSING
!        AND ASSUMES CIRCULAR ORBIT
!    4)  A MEAN MOTION APPROXIMATION IS MADE TO COMPUTE TIME
!        BETWEEN TWO ORBIT ANGLES
!    5)  THE ACTUAL ANGLES (THETA) BETWEEN PANEL NORMAL AND SUN
!        VECTOR WILL BE USED IN TEMP. CALCULATIONS EXCEPT FOR THOSE
!        VALUES NEEDED AT SHADOW ENTERY AND EXIT.  AT THESE POINTS
!        NOMINAL YAW STEERING PROFILES, PANEL ORIENTATIONS, AND
!        SHADOW BOUNDARIES AS DESCRIBED IN #3 WILL BE ASSUMED.
!    6)  MODEL COMPUTES TIMES FROM SOLAR ILLUMINATION BOUNDARIES
!        AND, THEREFORE, DIRECT ALBEDO & IR EFFECTS ARE NEGLECTED.
!        HOWEVER, A GOOD PORTION OF THEIR EFFECT IS ABSORBED INDIRECTLY
!        IN THE TEMPERATURE COMPUTATIONS
!    7)  NEGLECT RAMP AND FLIP YAW MANUEVERS, TREAT AS FIXED YAW.
!    8)  NEGLECT FIX YAW AT HIGH ORBIT ANGLES, TREAT AS SINUSOIDAL
!    9)  TIME-OF FLIGHT IS COMPUTED BY MULTPILYING THE MEAN MOTION
!        BY THE ANGULAR SEPARATION OF THE POINTS.  THIS ASSUMES A
!        CIRCULAR ORBIT
!
!
! REFERENCES:
!    "MODELING THE THERMAL IMBALANCE ACCELERATION IN POD:  THE BOX-
!     WING APPROACH-TOPEX/POSEIDON," ANDREW MARSHALL, APRIL 2,1991.
!
!    "MODELING SPACECRAFT FOR NON-CONSERVATIVE FORCES IN POD: ALGORITHM
!     DEFINITION-TOPEX/POSEIDON," ANDREW MARSHALL, APRIL 2,1991.
!***********************************************************************
!
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      SAVE
!
!
      DIMENSION TDNRM1(NFACE),TDNRM2(NFACE),TDNRM3(NFACE)
      DIMENSION ACCEL(3),XSAT(3),DERIV(3),PART(3)
      DIMENSION AREA(NFACE),EMISS(NFACE),TEMPA(NFACE),                  &
     &          TEMPC(NFACE),TIMED(NFACE),TIMEF(NFACE),THTX(NFACE),     &
     &          COSTHT(NFACE)
      DIMENSION IMAPAR(NFACE),IMAPEM(NFACE),IMAPTA(NFACE),IMAPTC(NFACE),&
     &          IMAPTD(NFACE),IMAPTF(NFACE),IMAPTX(NFACE)
      DIMENSION PXDDT(NEQN,3)
!
      COMMON/BWREAL/SHADOW(2),SUNPCT,SCAREA,SCMASS,BWMEAN
      COMMON/CBDTRU/BDTRUE(7,999)
      COMMON/CLIGHT/VLIGHT,ERRLIM,XCLITE
      COMMON/CONSTR/PI,TWOPI,DEGRAD,SECRAD,SECDAY
      COMMON/LSTRT/LSTART
      COMMON/TOPEXA/BETAP,PRVBET,SOMEGA,PRVOMG,YAWANG,SGAMMA,           &
     &              BETAMX,TDLOUV(8,3)
      COMMON/TOPEXL/LTOPX1,LRAMP,LRDOWN,LRUP,LFIX0,LFIX90,LSIN,LTXPRT
!
      DATA ZERO/0.0D0/,ONE/1.0D0/,TWO/2.0D0/,THREE/3.0D0/,FOUR/4.0D0/
!***********************************************************************
!  START OF EXECUTABLE CODE
!***********************************************************************
! INITIALIZE
      IF(SOMEGA.LT.ZERO) THEN
         XOMEGA=SOMEGA+TWOPI
      ELSE
         XOMEGA=SOMEGA
      ENDIF
!     STEFAN-BOLTZMANN CONSTANT IN W/M**2*K**4
      STEFBL=5.66D-08
      HALFPI=PI/TWO
      PI3ON2=THREE*HALFPI
      COEF  = -TWO/THREE*STEFBL/VLIGHT/SCMASS
      ICNTAR = JARADJ-1
      ICNTEM = JEMADJ-1
      ICNTTA = JTAADJ-1
      ICNTTC = JTCADJ-1
      ICNTTD = JTDADJ-1
      ICNTTF = JTFADJ-1
      ICNTTX = JTXADJ-1
! INITIALIZE ACCELERATION ARRAY
      DO 100 J=1,3
  100 ACCEL(J) = ZERO
! COMPUTE APPROPRIATE TRIG FUNCTIONS OF BETAP,OMEGA,YAWANG,SGAMMA
      ABETAP=ABS(BETAP)
      AOMEGA=ABS(XOMEGA)
      CBETAP=COS(BETAP)
      SBETAP=SIN(BETAP)
!     COSOMG=COS(XOMEGA)
!     SINOMG=SIN(XOMEGA)
!     CBCO=CBETAP*COSOMG
!     CBSO=CBETAP*SINOMG
!     CYAW=COS(YAWANG)
!     SYAW=SIN(YAWANG)
!     SBSY=SBETAP*SYAW
!     CSGAMMA=COS(SGAMMA)
!     SSGAMMA=SIN(SGAMMA)
!     CYCG=CYAW*CSGAMMA
!     SYCG=SYAW*CSGAMMA
! DETERMINE IF THE SPACECRAFT IS IN SUNLIGHT (50% ILLUMINATION BOUNDARY)
! SUNPCT COMPUTED IN SUBROUTINE SOLRAT
      IF(SUNPCT .LT. ZERO) THEN
        LIGHT=.FALSE.
      ELSE
        LIGHT=.TRUE.
      ENDIF
! LOOP THROUGH FACES, COMPUTING THE FACE ACCEL ALONG NORMAL VECTOR
!
! X+ FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!
!.....IN SINUSOIDAL YAW, X+ ALWAYS IN SHADOW
      IF(LSIN .OR. LFIX90) THEN
!        print*,' x+ opt 1'
         LVIS=.FALSE.
         TEMP=TEMPA(1)
         EXPSUN=ZERO
         EXPSHD=ZERO
         CTHETA = COSTHT(1)
!
      ELSE
      IF(BETAP.GT.ZERO) THEN
!.....IN FIXED YAW, X+ IN SUN FROM SHADOW EXIT TO 90 DEGREES ORB. ANG
!.....SHADOW1<=OMEGA<=360 or 0<=OMEGA<90
      IF(XOMEGA.LT.HALFPI   .AND.XOMEGA.GE.ZERO .OR.                    &
     &   XOMEGA.GE.SHADOW(1).AND.XOMEGA.LE.TWOPI) THEN
!        print*,' x+ opt 2'
        LVIS=.TRUE.
!.......COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
        THETA  = ACOS(COSTHT(1))
        THETAX = THETA/THTX(1)
        CTHETA = COS(THETAX)
        STHETA = SIN(THETAX)
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(1))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(1)+TEMPC(1)*(ONE-EXPSUN)*CTHETA
!
      ELSE
!.....IN FIXED YAW, X+ IN SHD FROM 90 DEG ORB. ANG TO SHADOW EXIT
!.....90<=OMEGA<SHADOW1
!        print*,' x+ opt 3'
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRANCE(TSHD)
        OMGDIF=XOMEGA-HALFPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(1))
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW EXIT TO 90 DEG WITH SIGN CORRECTED.
        OMGDIF=2.5D0*PI-SHADOW(1)
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(1))
!.......DIVIDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS X+ GOES
!.......INTO SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA =HALFPI
        THETAX=THETA/THTX(1)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(1)+TEMPC(1)*CTHETA*EXPSHD*(ONE-EXPSUN)
      ENDIF
!
! ....NEGATIVE BETAP
      ELSE
!.....IN FIXED YAW, X+ IN SHADOW FROM SHADOW ENTRANCE TO 90 DEG. ORB. AN
!.....SHADOW2<=OMEGA<=360 or 0<=OMEGA<90
      IF(XOMEGA.LT.HALFPI   .AND.XOMEGA.GE.ZERO .OR.                    &
     &   XOMEGA.GE.SHADOW(2).AND.XOMEGA.LE.TWOPI) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRANCE(TSHD)
        OMGDIF=XOMEGA-SHADOW(2)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(1))
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......90 DEG TO SHADOW ENTRANCE WITH SIGN CORRECTED.
        OMGDIF=SHADOW(2)-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(1))
!.......DIVIDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS X+ GOES
!.......INTO SHADOW (SHADOW(2)) BY ROTATION SCALING FACT (THTX)
!.......(NOTE THAT IN FIXED YAW, YAW = 180, SIMPLIFYING THIS CALC.)
        CSHADW=COS(SHADOW(2))
        THETA=ACOS(-CBETAP*CSHADW)
        THETAX =THETA/THTX(1)
        CTHETA =COS(THETAX)
        STHETA =SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(1)+TEMPC(1)*CTHETA*EXPSHD*(ONE-EXPSUN)
!
      ELSE
!.....IN FIXED YAW, X+ IN SHD FROM 90 DEG ORB. ANG TO SHADOW EXIT
!.....90<=OMEGA<SHADOW1
        LVIS=.TRUE.
!.......COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
        THETA  = ACOS(COSTHT(1))
        THETAX = THETA/THTX(1)
        CTHETA = COS(THETAX)
        STHETA = SIN(THETAX)
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(1))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(1)+TEMPC(1)*(ONE-EXPSUN)*CTHETA
      ENDIF
      ENDIF
      ENDIF
!       print*,' x+ ',lvis,ctheta,omgdif,tdif,temp
!
! COMPUTE TRUE OF DATE THERMAL ACCEL FOR X+ FACE
      TEMPXP = TEMP
      TERM1 = COEF*AREA(1)*EMISS(1)*TEMP**4
!        write(11,*) 'x+ ',betap,XOMEGA,temp
      ACCEL(1)= TERM1*TDNRM1(1)
      ACCEL(2)= TERM1*TDNRM2(1)
      ACCEL(3)= TERM1*TDNRM3(1)
!      if(lsblpt) write(66,*) 'accelx+: ',accel(1),accel(2),accel(3)
      IF(LORBIT) GOTO 200
! INITIALIZE DERIV,OMEXTC TO SAVE CALCULATIONS
         DERIV(1)= ACCEL(1)/TEMP*FOUR
         DERIV(2)= ACCEL(2)/TEMP*FOUR
         DERIV(3)= ACCEL(3)/TEMP*FOUR
         OMEXTC  = (ONE-EXPSUN)*CTHETA
! AREA PARTIAL
      IF(IMAPAR(1).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCEL(1)/AREA(1)
         PART(2) = ACCEL(2)/AREA(1)
         PART(3) = ACCEL(3)/AREA(1)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(1).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCEL(1)/EMISS(1)
         PART(2) = ACCEL(2)/EMISS(1)
         PART(3) = ACCEL(3)/EMISS(1)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(1).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
      IF(LVIS) THEN
! TEMPERATURE C PARTIALS
        IF(IMAPTC(1).GT.0) THEN
         ICNTTC=ICNTTC+1
         PART(1)=DERIV(1)*OMEXTC
         PART(2)=DERIV(2)*OMEXTC
         PART(3)=DERIV(3)*OMEXTC
!........ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
         PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
         PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
        ENDIF
!
! TIME F PARTIALS
        IF(IMAPTF(1).GT.0) THEN
         ICNTTF=ICNTTF+1
         VSTORE =-TEMPC(1)/TIMEF(1)**2*TSUN*EXPSUN*CTHETA
         PART(1)= DERIV(1)*VSTORE
         PART(2)= DERIV(2)*VSTORE
         PART(3)= DERIV(3)*VSTORE
!........ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
         PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
         PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
        ENDIF
!
! THTX PARTIALS
        IF(IMAPTX(1).GT.0) THEN
         ICNTTX=ICNTTX+1
         VSTORE =TEMPC(1)/THTX(1)**2*THETA*(ONE-EXPSUN)*STHETA
         PART(1)=DERIV(1)*VSTORE
         PART(2)=DERIV(2)*VSTORE
         PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
         PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
         PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
        ENDIF
!
          ELSE
! TEMPERATURE C PARTIALS
        IF(IMAPTC(1).GT.0) THEN
         ICNTTC=ICNTTC+1
         VSTORE = OMEXTC*EXPSHD
         PART(1)=DERIV(1)*VSTORE
         PART(2)=DERIV(2)*VSTORE
         PART(3)=DERIV(3)*VSTORE
!........ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
         PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
         PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
        ENDIF
!
! TIME F PARTIALS
        IF(IMAPTF(1).GT.0) THEN
         ICNTTF=ICNTTF+1
         VSTORE =-TEMPC(1)/TIMEF(1)**2*TSUN*EXPSUN*EXPSHD*CTHETA
         PART(1)= DERIV(1)*VSTORE
         PART(2)= DERIV(2)*VSTORE
         PART(3)= DERIV(3)*VSTORE
!........ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
         PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
         PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
        ENDIF
! TIME D PARTIALS
        IF(IMAPTD(1).GT.0) THEN
         ICNTTD=ICNTTD+1
         VSTORE = TEMPC(1)/TIMED(1)**2*TSHD*EXPSHD*OMEXTC
         PART(1)= DERIV(1)*VSTORE
         PART(2)= DERIV(2)*VSTORE
         PART(3)= DERIV(3)*VSTORE
!........ADD TO TIMED PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
         PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
         PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
        ENDIF
! THTX PARTIALS
        IF(IMAPTX(1).GT.0) THEN
         ICNTTX=ICNTTX+1
         VSTORE =TEMPC(1)/THTX(1)**2*THETA*(ONE-EXPSUN)*EXPSHD*STHETA
         PART(1)=DERIV(1)*VSTORE
         PART(2)=DERIV(2)*VSTORE
         PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
         PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
         PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
        ENDIF
!
      ENDIF
!
  200 CONTINUE
! COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON NEGATIVE
! X- FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!.....COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
      THETA  =ACOS(COSTHT(2))
      THETAX =THETA/THTX(2)
      CTHETA =COS(THETAX)
      STHETA =SIN(THETAX)
!      if(lsblpt) write(66,*) 'x- theta,thetax: ',theta,thetax
!      if(lsblpt) write(66,*) 'x- ctheta,stheta: ',ctheta,stheta
!      if(lsblpt) write(66,*) 'x- betap,abetap: ',betap,abetap
!      if(lsblpt) write(66,*) 'x- lfix0,lramp: ',lfix0,lramp
!      if(lsblpt) write(66,*) 'x- xomega: ',xomega
!      if(lsblpt) write(66,*) 'x- shadow1&2: ',shadow(1),shadow(2)
!
!.....HIGH BETAP (X- ALWAYS IN SUNLIGHT)
      IF(ABETAP.GT.BETAMX) THEN
         TEMP=TEMPA(2)+TEMPC(2)*CTHETA
         EXPSUN=ZERO
         EXPSHD=ZERO
         LVIS=.TRUE.
         GOTO 400
      ENDIF
!
!.....FIXED YAW
      IF(LFIX0.OR.LRAMP) THEN
      IF(BETAP.GE.ZERO) THEN
!.....90<=OMGEGA<SHADOW2 (X- IN SUN 90 DEG ORB ANG TO SHADOW ENTRY)
       IF(XOMEGA.GE.HALFPI .AND. XOMEGA.LT.SHADOW(2)) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(2))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(2)+TEMPC(2)*CTHETA*(ONE-EXPSUN)
!
       ELSE
!.....SHADOW2<=OMEGA<=360 OR 0<=OMEGA<90
!.....90<=OMGEGA<SHADOW2 (X- IN SHADOW SHADOW ENTRY TO 90 DEG ORB ANG)
        LVIS=.FALSE.
        OMGDIF=XOMEGA-SHADOW(2)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
!.......COMPUTE TIME IN SHADOW (TSHD)
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(2))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......90 DEG TO SHADOW ENTRANCE.
        OMGDIF=SHADOW(2)-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(2))
!.......DIVIDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS X- GOES INT
!.......SHADOW (SHADOW(2)) BY ROTATION SCALING FACT (THTX)
!.......(NOTE THAT IN FIXED YAW, YAW = 0, SIMPLIFYING THIS CALC.)
        CSHADW=COS(SHADOW(2))
        THETA=ACOS(-CBETAP*CSHADW)
        THETAX =THETA/THTX(2)
        CTHETA =COS(THETAX)
        STHETA =SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(2)+TEMPC(2)*CTHETA*EXPSHD*(ONE-EXPSUN)
      ENDIF
!
! NEGATIVE BETAP
      ELSE
!.....IN FIXED YAW, X- IN SUN FROM SHADOW EXIT TO 90 DEGREES ORB. ANG
!.....SHADOW1<=OMEGA<=360 or 0<=OMEGA<90
      IF(XOMEGA.LT.HALFPI   .AND.XOMEGA.GE.ZERO .OR.                    &
     &   XOMEGA.GE.SHADOW(1).AND.XOMEGA.LE.TWOPI) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(2))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(2)+TEMPC(2)*(ONE-EXPSUN)*CTHETA
!
      ELSE
!.....IN FIXED YAW, X- IN SHD FROM 90 DEG ORB. ANG TO SHADOW EXIT
!.....90<=OMEGA<SHADOW1
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRANCE(TSHD)
        OMGDIF=XOMEGA-HALFPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(2))
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW EXIT TO 90 DEG WITH SIGN CORRECTED.
        OMGDIF=2.5D0*PI-SHADOW(1)
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(2))
!.......DIVIDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS X- GOES
!.......INTO SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA =HALFPI
        THETAX=THETA/THTX(2)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(2)+TEMPC(2)*CTHETA*EXPSHD*(ONE-EXPSUN)
      ENDIF
!
      ENDIF
        GOTO 400
      ENDIF
!
! SINUSOIDAL YAW (X- ONLY OCCULTED BY EARTH, NEVER BY EARTH)
! SHADOW2<=OMEGA<SHADOW(1)
      IF(XOMEGA.GE.SHADOW(2) .AND.                                      &
     &   XOMEGA.LT.SHADOW(1)) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME IN SHADOW (TSHD)
        OMGDIF=XOMEGA-SHADOW(2)
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(2))
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......ENTRANCE FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW BETAP
!.......          2) X- PLATE ORIENTED ALONG S/C X- AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
!
        CSHADW=COS(SHADOW(2))
        IF(BETAP.GT.ZERO) THEN
           YAWSHD=(HALFPI-BETAP)*CSHADW+HALFPI
        ELSE
           YAWSHD=(-HALFPI-BETAP)*CSHADW-HALFPI
        ENDIF
        THTSD=ACOS(-CBETAP*CSHADW*COS(YAWSHD)+SBETAP*SIN(YAWSHD))
        THTSDX =THTSD/THTX(2)
        CTHTSD =COS(THTSDX)
        STHTSD =SIN(THTSDX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(2)+TEMPC(2)*EXPSHD*CTHTSD
!      if(lsblpt) write(66,*) 'x+ lvis,thtsd: ',lvis,thtsd
!      if(lsblpt) write(66,*) 'x+ thtsdx,cthtsd: ',thtsdx,cthtsd
!      if(lsblpt) write(66,*) 'x+ sthtsd,expshd: ',sthtsd,expshd
!      if(lsblpt) write(66,*) 'x+ tempa,tempc: ',tempa(2),tempc(2)
      ELSE
! SHADOW1<=OMEGA<360 or 0<=OMEGA<SHADOW(2)
        LVIS=.TRUE.
!.......COMPUTE TIME IN SUN (TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(2))
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......EXIT FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW EXIT BETAP
!.......          2) X- PLATE ORIENTED ALONG S/C X- AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
        CSUN=COS(SHADOW(1))
        IF(BETAP.GT.ZERO) THEN
           YAWSUN=(HALFPI-BETAP)*CSUN+HALFPI
        ELSE
           YAWSUN=(-HALFPI-BETAP)*CSUN-HALFPI
        ENDIF
        THTSN=ACOS(-CBETAP*CSUN*COS(YAWSUN)+SBETAP*SIN(YAWSUN))
        THTSNX =THTSN/THTX(2)
        CTHTSN =COS(THTSNX)
        STHTSN =COS(THTSNX)
!
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......ENTRANCE FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW EXIT BETAP
!.......          2) X- PLATE ORIENTED ALONG S/C X- AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
        OMGDIF=SHADOW(1)-SHADOW(2)
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(2))
        CSHADW=COS(SHADOW(2))
        IF(BETAP.GT.ZERO) THEN
           YAWSHD=(HALFPI-BETAP)*CSHADW+HALFPI
        ELSE
           YAWSHD=(-HALFPI-BETAP)*CSHADW-HALFPI
        ENDIF
        THTSD=ACOS(-CBETAP*CSHADW*COS(YAWSHD)+SBETAP*SIN(YAWSHD))
        THTSDX =THTSD/THTX(2)
        CTHTSD =COS(THTSDX)
        STHTSD =SIN(THTSDX)
!.......COMPUTE SUN TEMPERATURE
        TEMP=TEMPA(2)+TEMPC(2)*CTHETA*(ONE-EXPSUN+EXPSUN*EXPSHD*        &
     &       CTHTSD/CTHTSN)
!      if(lsblpt) write(66,*) 'x+ lvis,thtsd: ',lvis,thtsd
!      if(lsblpt) write(66,*) 'x+ thtsdx,cthtsd: ',thtsdx,cthtsd
!      if(lsblpt) write(66,*) 'x+ sthtsd,expshd: ',sthtsd,expshd
!      if(lsblpt) write(66,*) 'x+ tempa,tempc: ',tempa(2),tempc(2)
!      if(lsblpt) write(66,*) 'x+ ctheta,expsun: ',ctheta,expsun
!      if(lsblpt) write(66,*) 'x+ cthtsn: ',cthtsn
      ENDIF
!       print*,' x- ',lvis,ctheta,omgdif,tdif,temp
!
  400 CONTINUE
!        write(12,*) 'x- ',betap,XOMEGA,temp
         TEMPXM = TEMP
         TERM1 = COEF*AREA(2)*EMISS(2)*TEMP**4
!      if(lsblpt) write(66,*) 'x- term1,temp: ',term1,temp
!      if(lsblpt) write(66,*) 'x- tdnrm#(2): ',tdnrm1(2),tdnrm2(2),
!     . tdnrm3(2)
         ACCX    = TERM1*TDNRM1(2)
         ACCY    = TERM1*TDNRM2(2)
         ACCZ    = TERM1*TDNRM3(2)
!        write(6,*) XOMEGA,ACCX
         ACCEL(1)= ACCEL(1)+ACCX
         ACCEL(2)= ACCEL(2)+ACCY
         ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accelx-: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO Y+ FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(2).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(2)
         PART(2) = ACCY/AREA(2)
         PART(3) = ACCZ/AREA(2)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(2).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(2)
         PART(2) = ACCY/EMISS(2)
         PART(3) = ACCZ/EMISS(2)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(2).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
         IF(LVIS) THEN
            IF(LFIX0.OR. LRAMP                                          &
     &         .OR. (ABETAP.GT.BETAMX)) THEN
!...........FIXED YAW OR WHEN ABOVE 56 DEGREES X- ALWAYS IN SUNLIGHT
!...........TEMPERATURE C PARTIALS
            IF(IMAPTC(2).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
!...........TIME F PARTIAL
            IF(IMAPTF(2).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(2)/TIMEF(2)**2*TSUN*EXPSUN*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
!...........THTX PARTIALS
            IF(IMAPTX(2).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(2)/THTX(2)**2*THETA*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
            ELSE
!.......... SINUSOIDAL YAW BELOW 56 DEGREES
            EXCDCN=EXPSHD*CTHTSD/CTHTSN
!...........TEMPERATURE C PARTIALS
            IF(IMAPTC(2).GT.0) THEN
             ICNTTC=ICNTTC+1
             VSTORE=CTHETA*(ONE-EXPSUN+EXPSUN*EXCDCN)
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
!   TIME F PARTIAL
            IF(IMAPTF(2).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE = TEMPC(2)/TIMEF(2)**2*TSUN*EXPSUN*CTHETA*          &
     &                (EXCDCN-ONE)
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!...........TIME D PARTIAL
            IF(IMAPTD(2).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(2)/TIMED(2)**2*TSHD*EXPSUN*EXCDCN
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!...........THTX PARTIALS
            IF(IMAPTX(2).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(2)*(CTHETA*                                  &
     &               EXPSUN*EXPSHD*(STHTSD/CTHTSN*THTSD/THTX(2)**2-     &
     &               CTHTSD*STHTSN/CTHTSN**2*THTSN/THTX(2)**2)+         &
     &               (ONE-EXPSUN+EXPSUN*EXCDCN)*                        &
     &               STHETA*THETA/THTX(2)**2)
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!...........ENDIF FOR FIXED VERSUS SINUSOIDAL
            ENDIF
!........ELSE FOR LVIS=.FALSE.
         ELSE
            IF(LFIX0.OR. LRAMP) THEN
!...........FIXED YAW
!...........TEMPERATURE C PARTIALS
            IF(IMAPTC(2).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*EXPSHD*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
!...........TIME F PARTIAL
            IF(IMAPTF(2).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(2)/TIMEF(2)**2*TSUN*EXPSUN*EXPSHD*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
!...........TIME D PARTIAL
            IF(IMAPTD(2).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(2)/TIMED(2)**2*TSHD*(ONE-EXPSUN)*EXPSHD     &
     &               *CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!...........THTX PARTIALS
            IF(IMAPTX(2).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE=TEMPC(2)/THTX(2)**2*THETA*EXPSHD*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
            ELSE
!.......... SINUSOIDAL YAW
!...........TEMPERATURE C PARTIALS
            IF(IMAPTC(2).GT.0) THEN
             ICNTTC=ICNTTC+1
             VSTORE=CTHTSD*EXPSHD
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
!...........TIME D PARTIAL
            IF(IMAPTD(2).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(2)/TIMED(2)**2*TSHD*EXPSHD*CTHTSD
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!...........THTX PARTIALS
            IF(IMAPTX(2).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(2)*STHTSD/THTX(2)**2*THTSD*EXPSHD
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!..........ENDIF FOR FIX VERSUS SINUSOIDAL
           ENDIF
!.........ENDIF FOR LVIS=.T. VERSUS LVIS=.F.
          ENDIF
!.....ENDIF FOR LORBIT
      ENDIF
!C
! COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON POSITIVE
! Y+ FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!.....COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
      THETA =ACOS(COSTHT(3))
      THETAX=THETA/THTX(3)
      CTHETA=COS(THETAX)
      STHETA=SIN(THETAX)
!.... FIXED YAW (Y+ ALWAYS IN SHADOW)
      IF(LFIX0.OR. LRAMP) THEN
         TEMP=TEMPA(3)
         EXPSUN=ZERO
         EXPSHD=ZERO
         LVIS=.FALSE.
         GOTO 450
      ENDIF
!
!.... HIGH BETAP (LSIN OR LFIX90 = TRUE)
      IF(ABETAP.GT.BETAMX) THEN
      IF(BETAP.GT.ZERO) THEN
! 90<=OMEGA<270 (Y+ IN SUN)
      IF(XOMEGA.GE.HALFPI .AND. XOMEGA.LT.PI3ON2) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*(ONE-EXPSUN)*CTHETA
!
!....(LSIN = TRUE AND BETAP<BETAMX)
      ELSE
! 270<=OMEGA<=360 OR 0<=OMEGA<90 (Y+ IN SHADOW)
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-PI3ON2
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(3))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......90 DEG TO 270 DEG.
        OMGDIF=PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y+ GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(3)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*CTHETA*EXPSHD*(ONE-EXPSUN)
      ENDIF
!
! NEGATIVE BETAP
      ELSE
!.... 90<=OMEGA<270
      IF(XOMEGA.GE.HALFPI .AND. XOMEGA.LT.PI3ON2) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-HALFPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(3))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......270 DEG TO 90 DEG.
        OMGDIF=PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y+ GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(3)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*EXPSHD*(ONE-EXPSUN)*CTHETA
!
      ELSE
!....HIGH BETAP, 270<=OMEGA<=360 OR 0<=OMEGA<90
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-PI3ON2
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!......COMPUTE SUN TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*(ONE-EXPSUN)*CTHETA
      ENDIF
!
! ENDIF BETAP SIGN
      ENDIF
      GOTO 450
! ENDIF BETAMX
      ENDIF
!
!.... SINUSOIDAL YAW (LSIN = TRUE, BETAP<BETAMX)
      IF(BETAP.GT.ZERO) THEN
!.... 90<=OMEGA<SHADOW2
      IF(XOMEGA.GE.HALFPI.AND. XOMEGA.LT.SHADOW(2)) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*(ONE-EXPSUN)*CTHETA
      ELSE
!.....SHADOW2<=OMEGA<=360 OR 0<=OMEGA<90
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRANCE (TSHD)
        OMGDIF=XOMEGA-SHADOW(2)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(3))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......90 DEG TO SHADOW ENTRANCE.
        OMGDIF=SHADOW(2)-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......ENTRANCE FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW BETAP
!.......          2) Y+ PLATE ORIENTED ALONG S/C Y+ AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
!
        CSHADW=COS(SHADOW(2))
        IF(BETAP.GT.ZERO) THEN
           YAWSHD=(HALFPI-BETAP)*CSHADW+HALFPI
        ELSE
           YAWSHD=(-HALFPI-BETAP)*CSHADW-HALFPI
        ENDIF
        THETA=ACOS(-CBETAP*CSHADW*SIN(YAWSHD)-SBETAP*COS(YAWSHD))
        THETAX=THETA/THTX(3)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*EXPSHD*(ONE-EXPSUN)*CTHETA
      ENDIF
!
      ELSE
!     NEGATIVE BETAP
!.....0<=OMEGA<90 OR SHADOW1<=OMEGA<=0
      IF(XOMEGA.LT.HALFPI.AND.XOMEGA.GE.ZERO .OR.                       &
     &   XOMEGA.GE.SHADOW(1).AND.XOMEGA.LE.TWOPI) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*(ONE-EXPSUN)*CTHETA
!
      ELSE
!.....90<=OMEGA<SHADOW1
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-HALFPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(3))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW(1) TO 90 DEG.
        OMGDIF=HALFPI-SHADOW(1)+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(3))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y+ GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(3)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(3)+TEMPC(3)*EXPSHD*(ONE-EXPSUN)*CTHETA
      ENDIF
!
! BETAP SIGN ENDIF
      ENDIF
!       print*,' y+- ',lvis,ctheta,omgdif,tdif,temp
!
  450 CONTINUE
!        write(13,*) 'Y+ ',betap,XOMEGA,temp
          TEMPYP = TEMP
          TERM1 = COEF*AREA(3)*EMISS(3)*TEMP**4
          ACCX  =  TERM1*TDNRM1(3)
          ACCY  =  TERM1*TDNRM2(3)
          ACCZ  =  TERM1*TDNRM3(3)
          ACCEL(1)= ACCEL(1)+ACCX
          ACCEL(2)= ACCEL(2)+ACCY
          ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accely+: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO Y- FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(3).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(3)
         PART(2) = ACCY/AREA(3)
         PART(3) = ACCZ/AREA(3)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(3).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(3)
         PART(2) = ACCY/EMISS(3)
         PART(3) = ACCZ/EMISS(3)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(3).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
          IF(LVIS) THEN
! TEMPERATURE C PARTIALS
            IF(IMAPTC(3).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIAL
            IF(IMAPTF(3).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(3)/TIMEF(3)**2*TSUN*EXPSUN*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! THTX PARTIAL
            IF(IMAPTX(3).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(3)/THTX(3)**2*THETA*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
          ELSE
! TEMPERATURE C PARTIALS
            IF(IMAPTC(3).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*EXPSHD*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIAL
            IF(IMAPTF(3).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(3)/TIMEF(3)**2*TSUN*EXPSUN*EXPSHD*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! TIME D PARTIAL
            IF(IMAPTD(3).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(3)/TIMED(3)**2*TSHD*(ONE-EXPSUN)*EXPSHD*    &
     &                CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
! THTX PARTIAL
            IF(IMAPTX(3).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE=TEMPC(3)/THTX(3)**2*THETA*EXPSHD*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!........LVIS ENDIF
          ENDIF
!........LORBIT ENDIF
         ENDIF
!C
! COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON NEGATIVE
! Y- FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!.....COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
      THETA=ACOS(COSTHT(4))
      THETAX=THETA/THTX(4)
      CTHETA=COS(THETAX)
      STHETA=SIN(THETAX)
!
! FIXED YAW (ONLY OCCULTED BY EARTH)
      IF(LFIX0.OR. LRAMP) THEN
!.....SHADOW(2)<=OMEGA<SHADOW(1)
      IF(XOMEGA.LT.SHADOW(1) .AND.                                      &
     &   XOMEGA.GE.SHADOW(2)) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-SHADOW(2)
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(4))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW(1) TO SHADOW(2)
        OMGDIF=SHADOW(2)-SHADOW(1)+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......ENTRANCE FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW EXIT BETAP
!.......          2) Y- PLATE ORIENTED ALONG S/C Y- AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
        CSHADW=COS(SHADOW(2))
        IF(BETAP.GT.ZERO) THEN
           YAWSHD=ZERO
        ELSE
           YAWSHD=PI
        ENDIF
        THETA= ACOS(SBETAP*COS(YAWSHD))
        THETAX=THETA/THTX(4)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*EXPSHD*(ONE-EXPSUN)*CTHETA
!
      ELSE
!...(FIXED YAW, IN SUN SHADOW(1) TO SHADOW(2))
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*(ONE-EXPSUN)*CTHETA
      ENDIF
        GOTO 500
      ENDIF
!
! HIGH BETAP (LSIN OR LFIX90)
      IF(ABETAP.GT.BETAMX) THEN
      IF(BETAP.GT.ZERO) THEN
!.... 90<=OMEGA<270
      IF(XOMEGA.GE.HALFPI .AND. XOMEGA.LT.PI3ON2) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-HALFPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(4))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......270 DEG TO 90 DEG.
        OMGDIF=PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y- GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(4)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*EXPSHD*(ONE-EXPSUN)*CTHETA
!
      ELSE
!....HIGH BETAP, 270<=OMEGA<=360 OR 0<=OMEGA<90
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-PI3ON2
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!......COMPUTE SUN TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*(ONE-EXPSUN)*CTHETA
      ENDIF
!
      ELSE
! NEGATIVE BETAP
! 90<=OMEGA<270 (Y- IN SUN)
      IF(XOMEGA.GE.HALFPI .AND. XOMEGA.LT.PI3ON2) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*(ONE-EXPSUN)*CTHETA
!
!....(LSIN = TRUE AND BETAP<BETAMX)
      ELSE
! 270<=OMEGA<=360 OR 0<=OMEGA<90 (Y- IN SHADOW)
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-PI3ON2
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(4))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......90 DEG TO 270 DEG.
        OMGDIF=PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y- GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(4)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*CTHETA*EXPSHD*(ONE-EXPSUN)
      ENDIF
!
! BETAP SIGN ENDIF
      ENDIF
       GOTO 500
      ENDIF
!
! SINUSOIDAL YAW (LSIN FOR BETAP<BETMX)
      IF(BETAP.GT. ZERO) THEN
!.....0<=OMEGA<90 OR SHADOW1<=OMEGA<=0
      IF(XOMEGA.LT.HALFPI.AND.XOMEGA.GE.ZERO .OR.                       &
     &   XOMEGA.GE.SHADOW(1).AND.XOMEGA.LE.TWOPI) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*(ONE-EXPSUN)*CTHETA
!
      ELSE
!.....90<=OMEGA<SHADOW1
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-HALFPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(4))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW(1) TO 90 DEG.
        OMGDIF=HALFPI-SHADOW(1)+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y- GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(4)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*EXPSHD*(ONE-EXPSUN)*CTHETA
      ENDIF
!
      ELSE
! NEGATIVE BETAP
!.... 90<=OMEGA<SHADOW2
      IF(XOMEGA.GE.HALFPI.AND. XOMEGA.LT.SHADOW(2)) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......COMPUTE SUNLIGHT TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*(ONE-EXPSUN)*CTHETA
      ELSE
!.....SHADOW2<=OMEGA<=360 OR 0<=OMEGA<90
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRANCE (TSHD)
        OMGDIF=XOMEGA-SHADOW(2)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(4))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......90 DEG TO SHADOW ENTRANCE.
        OMGDIF=SHADOW(2)-HALFPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(4))
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......ENTRANCE FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW BETAP
!.......          2) Y- PLATE ORIENTED ALONG S/C Y- AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
!
        CSHADW=COS(SHADOW(2))
        IF(BETAP.GT.ZERO) THEN
           YAWSHD=(HALFPI-BETAP)*CSHADW+HALFPI
        ELSE
           YAWSHD=(-HALFPI-BETAP)*CSHADW-HALFPI
        ENDIF
        THETA=ACOS(CBETAP*CSHADW*SIN(YAWSHD)+SBETAP*COS(YAWSHD))
        THETAX=THETA/THTX(4)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(4)+TEMPC(4)*EXPSHD*(ONE-EXPSUN)*CTHETA
      ENDIF
!
!
! BETAP SIGN ENDIF
      ENDIF
!       print*,' y- ',lvis,ctheta,omgdif,tdif,temp
!
  500 CONTINUE
!        write(14,*) 'Y- ',betap,XOMEGA,temp
          TEMPYM = TEMP
          TERM1 = COEF*AREA(4)*EMISS(4)*TEMP**4
          ACCX  =  TERM1*TDNRM1(4)
          ACCY  =  TERM1*TDNRM2(4)
          ACCZ  =  TERM1*TDNRM3(4)
          ACCEL(1)= ACCEL(1)+ACCX
          ACCEL(2)= ACCEL(2)+ACCY
          ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accely-: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO Z+ FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(4).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(4)
         PART(2) = ACCY/AREA(4)
         PART(3) = ACCZ/AREA(4)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(4).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(4)
         PART(2) = ACCY/EMISS(4)
         PART(3) = ACCZ/EMISS(4)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(4).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
          IF(LVIS) THEN
! TEMPERATURE C PARTIALS
            IF(IMAPTC(4).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIALS
            IF(IMAPTF(4).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(4)/TIMEF(4)**2*TSUN*EXPSUN*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! THTX PARTIALS
            IF(IMAPTX(4).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(4)/THTX(4)**2*THETA*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!.........LVIS=FALSE
          ELSE
! TEMPERATURE C PARTIALS
            IF(IMAPTC(4).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*EXPSHD*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIALS
            IF(IMAPTF(4).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(4)/TIMEF(4)**2*TSUN*EXPSUN*EXPSHD*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! TIME D PARTIALS
            IF(IMAPTD(4).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(4)/TIMED(4)**2*TSHD*(ONE-EXPSUN)*EXPSHD*    &
     &                CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
! THTX PARTIALS
            IF(IMAPTX(4).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE=TEMPC(4)/THTX(4)**2*THETA*EXPSHD*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!........LVIS ENDIF
          ENDIF
!........LORBIT ENDIF
         ENDIF
!
!C COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON POSITIVE
! Z+ FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!.....COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
      THETA=ACOS(COSTHT(5))
      THETAX=THETA/THTX(5)
      CTHETA=COS(THETAX)
      STHETA=SIN(THETAX)
!
!.....FIXED OR SINUSOIDAL YAW EXPERIENCING EARTH OCCULTATION
      IF(ABETAP.LE.BETAMX) THEN
! 0<=OMEGA<180 (OCCULTED DUE TO S/C ORIENTATION)
      IF(XOMEGA.LT.PI .AND. XOMEGA.GE.ZERO) THEN
        LVIS=.FALSE.
        OMGDIF=XOMEGA
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(5))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW(1) TO 0 DEG
        OMGDIF=TWOPI-SHADOW(1)
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(5))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y- GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(5)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(5)+TEMPC(5)*EXPSHD*(ONE-EXPSUN)*CTHETA
!
!... SHADOW2<=OMEGA<SHADOW1 (OCCULTED DUE TO EARTH SHADOW)
      ELSEIF(XOMEGA.GE.SHADOW(2).AND.                                   &
     &       XOMEGA.LT.SHADOW(1)) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-SHADOW(2)
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(5))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......180 DEG TO SHADOW(2).
        OMGDIF=SHADOW(2)-PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(5))
!.......COMPUTE ANGLE BETWEEN PLATE NORMAL AND SUN VECTORS AT SHADOW
!.......ENTRANCE FOR USE IN CONTINUITY PARAMTER.  THIS CALCULATION
!.......ASSUMES : 1) CURRENT BETAP IS THE SAME AS SHADOW EXIT BETAP
!.......          2) Z+ PLATE ORIENTED ALONG S/C Z+ AXIS
!.......          3) S/C FOLLOWS NOMINAL YAW STEERING ALGORITHM
        THETA=ACOS(-CBETAP*SIN(SHADOW(2)))
        THETAX=THETA/THTX(5)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(5)+TEMPC(5)*EXPSHD*(ONE-EXPSUN)*CTHETA
!
!       write(6,*) 'z+ ',XOMEGA,expshd,expsun,ctheta
!... SHADOW1<=OMEGA<0 (ILLUMINATED BRIEFLY)
      ELSEIF(XOMEGA.GE.SHADOW(1).AND.                                   &
     &       XOMEGA.LE.TWOPI) THEN
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(5))
!.......COMPUTE SUN TEMPERATURE
        TEMP=TEMPA(5)+TEMPC(5)*(ONE-EXPSUN)*CTHETA
!
! 180<=OMEGA<SHADOW2 (ILLUMINATED BRIEFLY)
      ELSE
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-PI
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(5))
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        TEMP=TEMPA(5)+TEMPC(5)*(ONE-EXPSUN)*CTHETA
      ENDIF
!
      ELSE
!... HIGH BETAP (NO EARTH OCCULTATION)
! ...0<=OMEGA<180 (SHADOWED BY SPACECRAFT)
      IF(XOMEGA.LT.PI .AND.                                             &
     &   XOMEGA.GE.ZERO) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(5))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......180 DEG TO 360 DEG.
        OMGDIF=PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(5))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y- GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(5)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(5)+TEMPC(5)*EXPSHD*(ONE-EXPSUN)*CTHETA
!
      ELSE
! 180<=OMEGA<360
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA-PI
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
        IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(5))
!.......COMPUTE SUN TEMPERATURE
        TEMP=TEMPA(5)+TEMPC(5)*(ONE-EXPSUN)*CTHETA
      ENDIF
      ENDIF
!
!        write(15,*) 'Z+ ',betap,XOMEGA,temp
!     write(6,*) betap,XOMEGA,cbso,theta,thetax
!     write(6,*) theta,thetax,ctheta,stheta,lvis
          TEMPZP =TEMP
          TERM1 = COEF*AREA(5)*EMISS(5)*TEMP**4
          ACCX  =  TERM1*TDNRM1(5)
          ACCY  =  TERM1*TDNRM2(5)
          ACCZ  =  TERM1*TDNRM3(5)
          ACCEL(1)= ACCEL(1)+ACCX
          ACCEL(2)= ACCEL(2)+ACCY
          ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accelz+: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO Z- FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(5).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(5)
         PART(2) = ACCY/AREA(5)
         PART(3) = ACCZ/AREA(5)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
!    EMISSIVITY PARTIAL
      IF(IMAPEM(5).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(5)
         PART(2) = ACCY/EMISS(5)
         PART(3) = ACCZ/EMISS(5)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(5).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
          IF(LVIS) THEN
! TEMPERATURE C PARTIALS
            IF(IMAPTC(5).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIAL
            IF(IMAPTF(5).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(5)/TIMEF(5)**2*TSUN*EXPSUN*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! THTX PARTIAL
            IF(IMAPTX(5).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(5)/THTX(5)**2*THETA*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!.........LVIS=FALSE
          ELSE
! TEMPERATURE C PARTIALS
            IF(IMAPTC(5).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*EXPSHD*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIAL
            IF(IMAPTF(5).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(5)/TIMEF(5)**2*TSUN*EXPSUN*EXPSHD*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! TIME D PARTIAL
            IF(IMAPTD(5).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(5)/TIMED(5)**2*TSHD*(ONE-EXPSUN)*EXPSHD*    &
     &                CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
! THTX PARTIAL
            IF(IMAPTX(5).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE=TEMPC(5)/THTX(5)**2*THETA*EXPSHD*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!........LVIS ENDIF
          ENDIF
!........LORBIT ENDIF
         ENDIF
!
!C COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON NEGATIVE
! Z- FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!.....COMPUTE ANGLE BETWEEN PANEL NORMAL AND SUN VECTORS(THETA)
       THETA=ACOS(COSTHT(6))
       THETAX=THETA/THTX(6)
       CTHETA=COS(THETAX)
       STHETA=SIN(THETAX)
!.....FIXED OR SINUSOIDAL YAW EXPERIENCING EARTH OCCULTATION
! 180<=OMEGA<0
      IF(XOMEGA.LE.TWOPI .AND.                                          &
     &   XOMEGA.GE.PI) THEN
        LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
        OMGDIF=XOMEGA-PI
        TSHD = BWMEAN*OMGDIF
        EXPSHD=EXP(-TSHD/TIMED(6))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SUN(TSUN) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......0 TO 180 DEG.
        OMGDIF=PI
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(6))
!.......DIVDE ANGLE BETWEEN PLATE NORMAL AND SUN VECTOR AS Y- GOES INTO
!.......SHADOW (90 DEG) BY ROTATION SCALING FACT (THTX)
        THETA=HALFPI
        THETAX=THETA/THTX(6)
        CTHETA=COS(THETAX)
        STHETA=SIN(THETAX)
!.......COMPUTE SHADOW TEMPERATURE
        TEMP=TEMPA(6)+TEMPC(6)*EXPSHD*(ONE-EXPSUN)*CTHETA
!       write(6,*) XOMEGA,expshd,expsun,ctheta,temp
      ELSE
! 0<=OMEGA<180
        LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
        OMGDIF=XOMEGA
        TSUN = BWMEAN*OMGDIF
        EXPSUN=EXP(-TSUN/TIMEF(6))
!.......COMPUTE SUN TEMPERATURE
        TEMP=TEMPA(6)+TEMPC(6)*(ONE-EXPSUN)*CTHETA
!       write(6,*) XOMEGA,expsun,ctheta,temp
      ENDIF
!
!        write(16,*) 'Z- ',betap,XOMEGA,temp
          TEMPZM = TEMP
          TERM1 = COEF*AREA(6)*EMISS(6)*TEMP**4
!         write(6,*) 'Z- ',coef,area(6),emiss(6),temp,term1
          ACCX  =  TERM1*TDNRM1(6)
          ACCY  =  TERM1*TDNRM2(6)
          ACCZ  =  TERM1*TDNRM3(6)
          ACCEL(1)= ACCEL(1)+ACCX
          ACCEL(2)= ACCEL(2)+ACCY
          ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accelz-: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO SA+ FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(6).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(6)
         PART(2) = ACCY/AREA(6)
         PART(3) = ACCZ/AREA(6)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(6).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(6)
         PART(2) = ACCY/EMISS(6)
         PART(3) = ACCZ/EMISS(6)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(6).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
          IF(LVIS) THEN
! TEMPERATURE C PARTIALS
            IF(IMAPTC(6).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIALS
            IF(IMAPTF(6).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(6)/TIMEF(6)**2*TSUN*EXPSUN*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! THTX  PARTIALS
            IF(IMAPTX(6).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE =TEMPC(6)/THTX(6)**2*THETA*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!.........LVIS=FALSE
          ELSE
! TEMPERATURE C PARTIALS
            IF(IMAPTC(6).GT.0) THEN
             ICNTTC=ICNTTC+1
             OMEXTC  = (ONE-EXPSUN)*EXPSHD*CTHETA
             PART(1)=DERIV(1)*OMEXTC
             PART(2)=DERIV(2)*OMEXTC
             PART(3)=DERIV(3)*OMEXTC
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIALS
            IF(IMAPTF(6).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE =-TEMPC(6)/TIMEF(6)**2*TSUN*EXPSUN*EXPSHD*CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! TIME D PARTIALS
            IF(IMAPTD(6).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(6)/TIMED(6)**2*TSHD*(ONE-EXPSUN)*EXPSHD*    &
     &                CTHETA
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
! THTX  PARTIALS
            IF(IMAPTX(6).GT.0) THEN
             ICNTTX=ICNTTX+1
             VSTORE=TEMPC(6)/THTX(6)**2*THETA*EXPSHD*(ONE-EXPSUN)*STHETA
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!........ADD TO THTX PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTX,1) = PXDDT(ICNTTX,1)+PART(1)
             PXDDT(ICNTTX,2) = PXDDT(ICNTTX,2)+PART(2)
             PXDDT(ICNTTX,3) = PXDDT(ICNTTX,3)+PART(3)
            ENDIF
!
!........LVIS ENDIF
          ENDIF
!........LORBIT ENDIF
         ENDIF
!
! COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON POSITIVE
! SA+ FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!....HIGH BETAPRIME MEANS ARRAY FRONT IS CONTINUALLY EXPOSED TO SUN
         IF(ABETAP.GT.BETAMX) THEN
            LVIS=.TRUE.
            EXPSUN=ZERO
            EXPSHD=ZERO
!.......COMPUTE SUN TEMPERATURE
            TEMP=TEMPA(7)+TEMPC(7)
            GOTO 600
         ENDIF
!
         IF(LIGHT) THEN
! ARRAY ILLUMINATED
            LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
            OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
            IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
            TSUN = BWMEAN*OMGDIF
            EXPSUN=EXP(-TSUN/TIMEF(7))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SHD(TSHD) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW ENTRY TO SHADOW EXIT.
            OMGDIF=SHADOW(1)-SHADOW(2)
            TSHD = BWMEAN*OMGDIF
            EXPSHD=EXP(-TSHD/TIMED(7))
!
!.......COMPUTE SUN TEMPERATURE
            TEMP=TEMPA(7)+TEMPC(7)*(ONE-EXPSUN+EXPSUN*EXPSHD)
         ELSE
! ARRAY SHADOWED BY EARTH
            LVIS=.FALSE.
!.......COMPUTE TIME SINCE SHADOW ENTRY(TSHD)
            OMGDIF=XOMEGA-SHADOW(2)
            TSHD = BWMEAN*OMGDIF
            EXPSHD=EXP(-TSHD/TIMED(7))
!.......COMPUTE SHADOW TEMPERATURE
            TEMP=TEMPA(7)+TEMPC(7)*EXPSHD
         ENDIF
!
  600 CONTINUE
!        write(17,*) 'SA+ ',betap,XOMEGA,temp
         TMPSAP = TEMP
         TERM1 = COEF*AREA(7)*EMISS(7)*TEMP**4
          ACCX  =  TERM1*TDNRM1(7)
          ACCY  =  TERM1*TDNRM2(7)
          ACCZ  =  TERM1*TDNRM3(7)
          ACCEL(1)= ACCEL(1)+ACCX
          ACCEL(2)= ACCEL(2)+ACCY
          ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accelsa+: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO SA- FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(7).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(7)
         PART(2) = ACCY/AREA(7)
         PART(3) = ACCZ/AREA(7)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(7).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(7)
         PART(2) = ACCY/EMISS(7)
         PART(3) = ACCZ/EMISS(7)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(7).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
          IF(LIGHT) THEN
! TEMPERATURE C PARTIALS
            IF(IMAPTC(7).GT.0) THEN
             ICNTTC=ICNTTC+1
             VSTORE  = ONE-EXPSUN+EXPSUN*EXPSHD
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIALS
            IF(IMAPTF(7).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE = TEMPC(7)/TIMEF(7)**2*TSUN*EXPSUN*(EXPSHD-ONE)
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
!
! TIME D PARTIALS
            IF(IMAPTD(7).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(7)/TIMED(7)**2*TSHD*EXPSUN*EXPSHD
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!
!....SATELLITE IN SHADOW
          ELSE
! TEMPERATURE C PARTIALS
            IF(IMAPTC(7).GT.0) THEN
             ICNTTC=ICNTTC+1
             VSTORE  = EXPSHD
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME D PARTIALS
            IF(IMAPTD(7).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(7)/TIMED(7)**2*TSHD*EXPSHD
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!
!........LVIS ENDIF
          ENDIF
!........LORBIT ENDIF
         ENDIF
!
! COMPUTE ALONGTRACK, CROSSTRACK, AND RADIAL ACCELERATIONS ON NEGATIVE
! SA- FACE
!   DETERMINE SURFACE TEMP BASED ON BETAPRIME, ORBIT ANGLE, AND
!   YAW STEERING MODE
!   NOTE:  SA- IS NOT DIRECTLY ILLUMINATED BY SUN.  HOWEVER, SINCE
!          THE SA MATERIAL IS SO THIN AND CONDUCTIVE, BEGIN HEATING AND
!          COOLING WHEN SATELLITE ENTERS/EXITS SUN
!C
! HIGH BETAPRIME
         IF(ABETAP.GT.BETAMX) THEN
            LVIS=.TRUE.
            EXPSUN=ZERO
            EXPSHD=ZERO
!.......COMPUTE SUN TEMPERATURE
            TEMP=TEMPA(8)+TEMPC(8)
            GOTO 700
         ENDIF
!
         IF(LIGHT) THEN
! ARRAY ILLUMINATED
            LVIS=.TRUE.
!.......COMPUTE TIME SINCE SHADOW EXIT(TSUN)
            OMGDIF=XOMEGA-SHADOW(1)
!.......CORRECT FOR NEG. OMGDIF (SAT. HAS CROSS OMEGA=0 POINT)
            IF(OMGDIF.LT.ZERO) OMGDIF=OMGDIF+TWOPI
            TSUN = BWMEAN*OMGDIF
            EXPSUN=EXP(-TSUN/TIMEF(8))
!
!.......COMPUTE TOTAL TIME S/C WAS IN SHD(TSHD) AND USE TO INSURE
!.......CONTINUITY BEWTEEN T_sun AND T_shd.  OMGDIF IS TIME FROM
!.......SHADOW ENTRY TO SHADOW EXIT.
            OMGDIF=SHADOW(1)-SHADOW(2)
            TSHD = BWMEAN*OMGDIF
            EXPSHD=EXP(-TSHD/TIMED(8))
!
!.......COMPUTE SUN TEMPERATURE
            TEMP=TEMPA(8)+TEMPC(8)*(ONE-EXPSUN+EXPSUN*EXPSHD)
         ELSE
! ARRAY SHADOWED BY EARTH
            LVIS=.FALSE.
            OMGDIF=XOMEGA-SHADOW(2)
            TSHD = BWMEAN*OMGDIF
            EXPSHD=EXP(-TSHD/TIMED(8))
!.......COMPUTE SHD TEMPERATURE
            TEMP=TEMPA(8)+TEMPC(8)*EXPSHD
         ENDIF
!
  700 CONTINUE
!        write(18,*) 'SA- ',betap,XOMEGA,temp
         TMPSAM = TEMP
         TERM1 = COEF*AREA(8)*EMISS(8)*TEMP**4
          ACCX  =  TERM1*TDNRM1(8)
          ACCY  =  TERM1*TDNRM2(8)
          ACCZ  =  TERM1*TDNRM3(8)
          ACCEL(1)= ACCEL(1)+ACCX
          ACCEL(2)= ACCEL(2)+ACCY
          ACCEL(3)= ACCEL(3)+ACCZ
!      if(lsblpt) write(66,*) 'accelsa-: ',accel(1),accel(2),accel(3)
!.....IF NO PARTIALS ARE REQUIRED GO ON TO SA- FACE
      IF(.NOT.LORBIT) THEN
! INITIALIZE DERIV TO SAVE CALCULATIONS
         DERIV(1)= ACCX/TEMP*FOUR
         DERIV(2)= ACCY/TEMP*FOUR
         DERIV(3)= ACCZ/TEMP*FOUR
! AREA PARTIAL
      IF(IMAPAR(8).GT.0) THEN
         ICNTAR=ICNTAR+1
         PART(1) = ACCX/AREA(8)
         PART(2) = ACCY/AREA(8)
         PART(3) = ACCZ/AREA(8)
!........ADD TO AREA PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTAR,1) = PXDDT(ICNTAR,1)+PART(1)
         PXDDT(ICNTAR,2) = PXDDT(ICNTAR,2)+PART(2)
         PXDDT(ICNTAR,3) = PXDDT(ICNTAR,3)+PART(3)
      ENDIF
! EMISSIVITY PARTIAL
      IF(IMAPEM(8).GT.0) THEN
         ICNTEM=ICNTEM+1
         PART(1) = ACCX/EMISS(8)
         PART(2) = ACCY/EMISS(8)
         PART(3) = ACCZ/EMISS(8)
!........ADD TO EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTEM,1) = PXDDT(ICNTEM,1)+PART(1)
         PXDDT(ICNTEM,2) = PXDDT(ICNTEM,2)+PART(2)
         PXDDT(ICNTEM,3) = PXDDT(ICNTEM,3)+PART(3)
      ENDIF
! TEMPERATURE A PARTIALS
      IF(IMAPTA(8).GT.0) THEN
         ICNTTA=ICNTTA+1
         PART(1)=DERIV(1)
         PART(2)=DERIV(2)
         PART(3)=DERIV(3)
!........ADD TO TEMPA EMIS PARTIALS COMPUTED IN OTHER ROUTINES
         PXDDT(ICNTTA,1) = PXDDT(ICNTTA,1)+PART(1)
         PXDDT(ICNTTA,2) = PXDDT(ICNTTA,2)+PART(2)
         PXDDT(ICNTTA,3) = PXDDT(ICNTTA,3)+PART(3)
      ENDIF
!
          IF(LIGHT) THEN
! TEMPERATURE C PARTIALS
            IF(IMAPTC(8).GT.0) THEN
             ICNTTC=ICNTTC+1
             VSTORE  = ONE-EXPSUN+EXPSUN*EXPSHD
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME F PARTIALS
            IF(IMAPTF(8).GT.0) THEN
             ICNTTF=ICNTTF+1
             VSTORE = TEMPC(8)/TIMEF(8)**2*TSUN*EXPSUN*(EXPSHD-ONE)
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTF,1) = PXDDT(ICNTTF,1)+PART(1)
             PXDDT(ICNTTF,2) = PXDDT(ICNTTF,2)+PART(2)
             PXDDT(ICNTTF,3) = PXDDT(ICNTTF,3)+PART(3)
            ENDIF
! TIME D PARTIALS
            IF(IMAPTD(8).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(8)/TIMED(8)**2*TSHD*EXPSUN*EXPSHD
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!
          ELSE
            IF(IMAPTC(8).GT.0) THEN
             ICNTTC=ICNTTC+1
             VSTORE  = EXPSHD
             PART(1)=DERIV(1)*VSTORE
             PART(2)=DERIV(2)*VSTORE
             PART(3)=DERIV(3)*VSTORE
!............ADD TO TEMPC PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTC,1) = PXDDT(ICNTTC,1)+PART(1)
             PXDDT(ICNTTC,2) = PXDDT(ICNTTC,2)+PART(2)
             PXDDT(ICNTTC,3) = PXDDT(ICNTTC,3)+PART(3)
            ENDIF
! TIME D PARTIALS
            IF(IMAPTD(8).GT.0) THEN
             ICNTTD=ICNTTD+1
             VSTORE = TEMPC(8)/TIMED(8)**2*TSHD*EXPSHD
             PART(1)= DERIV(1)*VSTORE
             PART(2)= DERIV(2)*VSTORE
             PART(3)= DERIV(3)*VSTORE
!............ADD TO TIMEF PARTIALS COMPUTED IN OTHER ROUTINES
             PXDDT(ICNTTD,1) = PXDDT(ICNTTD,1)+PART(1)
             PXDDT(ICNTTD,2) = PXDDT(ICNTTD,2)+PART(2)
             PXDDT(ICNTTD,3) = PXDDT(ICNTTD,3)+PART(3)
            ENDIF
!
!........LVIS ENDIF
          ENDIF
!........LORBIT ENDIF
         ENDIF
!
!
  800 CONTINUE
! OUTPUT TOPEX TELEM FILE INFORMATION
      IF(LTXPRT .AND. .NOT. LSTART) THEN
!....WRITE PANEL TEMPERATURES
         WRITE(97) TEMPXP,TEMPXM,TEMPYP,TEMPYM, &
     &             TEMPZP,TEMPZM,TMPSAP,TMPSAM
      ENDIF
      RETURN
!
      END
