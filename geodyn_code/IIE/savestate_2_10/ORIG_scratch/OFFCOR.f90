      SUBROUTINE OFFCOR(LNPNM,NP,NM,RESID,PARMV0,PARMVC,PMPA1,PMPA2)
      IMPLICIT DOUBLE PRECISION (A-H,O-Z),LOGICAL(L)
      DIMENSION RESID(NM),PARMV0(NP),PARMVC(NP)
      DIMENSION PMPA1(NP,NM),PMPA2(NM,NP)
      COMMON/BIAOR/NAMBB,NCYCB,NAMBBH
      COMMON/NPCOM /NPNAME,NPVAL(92),NPVAL0(92),IPVAL(92),IPVAL0(92),   &
     &              MPVAL(28),MPVAL0(28),NXNPCM
      COMMON/NPCOMX/IXARC ,IXSATP,IXDRAG,IXSLRD,IXACCL,IXGPCA,IXGPSA,   &
     &              IXAREA,IXSPRF,IXDFRF,IXEMIS,IXTMPA,IXTMPC,IXTIMD,   &
     &              IXTIMF,IXTHTX,IXTHDR,IXOFFS,IXBISA,IXFAGM,IXFAFM,   &
     &              IXATUD,IXRSEP,IXACCB,IXDXYZ,IXGPSBW,IXCAME,IXBURN,  &
     &              IXGLBL,IXGPC ,IXGPS, IXTGPC,IXTGPS,IXGPCT,IXGPST,   &
     &              IXTIDE,IXETDE,IXOTDE,IXOTPC,IXOTPS,IXLOCG,IXKF  ,   &
     &              IXGM  ,IXSMA ,IXFLTP,IXFLTE,IXPLTP,IXPLTV,IXPMGM,   &
     &              IXPMJ2,IXVLIT,IXEPHC,IXEPHT,IXH2LV,IXL2LV,IXOLOD,   &
     &              IXPOLX,IXPOLY,IXUT1 ,IXPXDT,IXPYDT,IXUTDT,IXVLBI,   &
     &              IXVLBV,IXXTRO,IXBISG,IXSSTF,IXFGGM,IXFGFM,IXLNTM,   &
     &              IXLNTA,IX2CCO,IX2SCO,IX2GM ,IX2BDA,IXRELP,IXJ2SN,   &
     &              IXGMSN,IXPLNF,IXPSRF,IXANTD,IXTARG,                 &
     &              IXSTAP,IXSSTC,IXSSTS,IXSTAV,IXSTL2,                 &
     &              IXSTH2,IXDPSI,IXEPST,IXCOFF,IXTOTL,NXNPCX
      IF(NPVAL0(IXOFFS).LE.0) RETURN
      IPT0=IPVAL0(IXOFFS)+NAMBB-1
      JPT0=IPVAL0(IXOFFS)-1
      NO=NPVAL0(IXOFFS)
      IF(LNPNM) THEN
       DO 20 J=1,NO
       DO 10 I=1,NM
       RESID(I)=RESID(I)-PMPA1(IPT0+J,I)*(PARMVC(J+JPT0)-PARMV0(J+JPT0))
   10  CONTINUE
   20  CONTINUE
      ELSE
       DO 40 J=1,NO
       DO 30 I=1,NM
       RESID(I)=RESID(I)-PMPA2(I,IPT0+J)*(PARMVC(J+JPT0)-PARMV0(J+JPT0))
   30  CONTINUE
   40  CONTINUE
      ENDIF
      RETURN
      END
