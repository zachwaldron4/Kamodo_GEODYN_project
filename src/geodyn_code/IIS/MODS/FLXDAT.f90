!$FLXDAT
      SUBROUTINE FLXDAT(MJDFLX,DFLXS,DFLXAV,DFLXM,FLXS,FLXAVG,          &
     &                  FLXM)
!********1*********2*********3*********4*********5*********6*********7**
! FLXDAT           07/18/83            0000.0    PGMR - DIANE SEVITSKI
!                  01/27/84                      PGMR - BILL EDDY
!
!
! FUNCTION:  LOAD THE 36 FLUX VALUES THAT START 3 DAYS PRIOR TO THE
!            START OF THE 32 DAY EPHEMERIS BUFFER
!
!
! I/O PARAMETERS:
!
!   NAME    I/O  A/S   DESCRIPTION OF PARAMETERS
!   ------  ---  ---   ------------------------------------------------
!   MJDFLX  I/O        START DATE OF 32 DAY EPHEMERIS BUFFER/
!                      START DATE OF 36 DAY FLUX INFORMATION
!   DFLXS    I         DYNAMIC ARRAY CONTAINING SOLAR FLUX DATA
!   DFLXAV   I         DYNAMIC ARRAY CONTAINING SOLAR FLUX AVERAGE
!   DFLXM    I         DYNAMIC ARRAY CONTAINING MAGNETIC FLUX DATA
!   FLXS     O         ARRAY CONTAINING 36 SOLAR FLUX VALUES
!   FLXAVG   O         ARRAY CONTAINING 36 SOLAR FLUX AVERAGES
!   FLXM     O         ARRAY CONTAINING 288 MAGNETIC FLUX VALUES
!
! COMMENTS:
!             ON INPUT MJDFLX IS THE START DATE FOR THE EPHEMERIS BLOCK,
!             AND ON OUTPUT MJDFLX IS THREE DAYS EARLIER.
!
!*********1*********2*********3*********4*********5*********6*********7*
      IMPLICIT DOUBLE PRECISION (A-H,O-Z), LOGICAL(L)
      SAVE
!
      COMMON/ARCPAR/MAXSEL,NSEL,MAXDEL,NDEL,MAXMET,NMETDT,NSATID,       &
     &              IATDEN,ISATEQ,ITRMAX,ITRMIN,ITRMX2,                 &
     &              MJDSRF,MREFSY,NTDDR,NBTOTL,IDRAGM,IMRNUT,           &
     &              NXARCP
      COMMON/BIHTBL/IA1UTC,JA1UTC,IPOLA1,JPOLA1,IFLUXS,JFLUXS,IFLXAP,   &
     &              JFLXAP,IFLXKP,JFLXKP,IIONO,JIONO,                   &
     &              NVR(6),NUTC  ,IBIH  ,JBIH  ,                        &
     &              IFLUX ,JFLUX ,IBHSYS,IBHDAT,IBHTIM,IFLXSF,          &
     &              IBIHTL(2),IBIHHR,JBIHHR,NXBIHT
      COMMON/LICASE/LINT(2),LCASE(18),NXLCAS
      COMMON/UNITS /IUNT01,IUNT02,IUNT03,IUNT05,IUNT06,IUNT07,IUNT11,   &
     &              IUNT12,IUNT15,IUNT16,                               &
     &              IUNT30,IUNT31,IUNT39,IUNT40,IUNT41,IUNT42,IUNT43,   &
     &              IUNT50,IUNT52,IUNT53,IUNT60,IUNT90,IUNT91,IUNT99,   &
     &              ILINE(2),IPAGE(2),MLINEP(2),MAXCOL(2),IUNT17,       &
     &              IUNT70,IUNT71,                                      &
     &              IUNT88,NXUNIT
!
      DIMENSION FLXS(1) ,FLXAVG(1),FLXM(8,1)
      DIMENSION DFLXS(1),DFLXAV(1),DFLXM(1)
!
      DATA C10P0/10.0D0/,C100P0/100.0D0/,ZERO/0.0D0/
!
!**********************************************************************
! START OF EXECUTABLE CODE
!**********************************************************************
!
! LDRG=.TRUE. IN CASE WE USE DTM FOR THE INTERCOMPARISON
! SINCE WE REDUCE THE TIME FOR STORAGE OF THE 3-HOURLY KP
! VALUES WE SKIP THE TEST DONE IN THIS SUBROUTINE IN 350
!
      LDRG=.FALSE.
      IF(LINT(1).AND.LCASE(15))LDRG=.TRUE.
      IF(LINT(1).AND.LCASE(16))LDRG=.TRUE.
      CALL ZEROR(FLXM,288)
      CALL MJDYMD(MJDB,IFLUX,IDUM,2)
      CALL MJDYMD(MJDE,JFLUX,IDUM,2)
      MJDFLX=MJDFLX-3
      IF(LDRG) THEN
      GO TO 85
      ENDIF
      IF(MJDB.GT.MJDFLX.OR.MJDFLX.GT.MJDE) GOTO 350
   85 CONTINUE
!
      JBEG=MJDFLX-MJDB+1
      JEND=JBEG+35
      JCHK=MJDFLX+35
      IF(JCHK.GT.MJDE) JEND=JEND-(JCHK-MJDE)
      JX=0
! IDYFLX=1 FOR JACCHIA MODEL; IDYFLX=8 FOR FRENCH MODEL
      IDYFLX=1
      IF((IATDEN.EQ.41).OR.(IATDEN.EQ.42).OR.(IATDEN.EQ.43)) IDYFLX=8
      IF((IATDEN.EQ.51).OR.(IATDEN.EQ.52).OR.(IATDEN.EQ.53)) IDYFLX=8
      IF((IATDEN.EQ.61).OR.(IATDEN.EQ.62).OR.(IATDEN.EQ.63)) IDYFLX=8
      DO 100 J=JBEG,JEND
         JX=JX+1
         FLXS(JX)  =DFLXS(J) /C10P0
         FLXAVG(JX)=DFLXAV(J)/C10P0
         M1=(J-1)*IDYFLX
      DO 90 K1=1,IDYFLX
         FLXM(K1,JX)  =DFLXM(M1+K1)/C100P0
   90 END DO
  100 END DO
      IF(JX.GE.36) GOTO 300
      M2=(JEND-1)*IDYFLX
      DO 200 I=JX,36
      FLXS(I)  =DFLXS(JEND) /C10P0
      FLXAVG(I)=DFLXAV(JEND)/C10P0
      DO 150 K2=1,IDYFLX
      FLXM(K2,I)  =DFLXM(M2+K2)/C100P0
  150 END DO
  200 END DO
  300 CONTINUE
      RETURN
!
  350 CONTINUE
      CALL MJDYMD(MJDFLX,JDERR,IDUM,1)
      WRITE(IUNT06,71000) JDERR,IFLUX,JFLUX
      WRITE(IUNT06,78000)
      STOP
!
!     ** FORMATS **
!
71000 FORMAT(' ','SUBROUTINE FLXDAT HAS START DATE OF',2X,I6,2X,'AND ', &
     &       'FLUXES RANGE FROM DAY',2X,I6,'THROUGH',2X,I6)
78000 FORMAT(' ','STOP PROGRAM IN SUBROUTINE FLXDAT')
      END
